import{a as xs,c as f_,d as m_,e as An,f as Sn,h as Ce,i as qc,j as p_,k as g_,m as __,n as Yr,o as Jr,p as Xr,q as Zr}from"./chunk-DHWZOWGV.js";import{a as Uc,b as Bc}from"./chunk-IQQILWT5.js";import{$ as Mc,A as l_,B as u_,C as _t,D as In,E as Fa,F as Ps,G as Vc,H as c_,K as h_,M as $,N as at,O as Me,P as Oc,Q as d_,R as Ns,T as ne,U as Mt,V as Ma,W as Fc,X as yt,Y as Hr,_ as La,a as O,b as Qr,ba as Ua,c as n_,d as r_,da as Lc,f as i_,fa as Tn,ga as Lt,h as xc,j as et,k as Va,l as Rs,m as kc,p as s_,r as Ft,s as Dc,t as o_,w as a_,y as Oa,z as xe}from"./chunk-DRGJOWSF.js";import{a as Da}from"./chunk-3R3HMUER.js";import{r as ka}from"./chunk-2D6DNJWQ.js";import{A as bs,Fa as $r,H as Ra,J as Yg,M as Pa,N as ar,O as Jg,P as Pc,Q as Xg,R as Na,S as rn,T as Nc,W as Zg,Z as Ot,aa as Ge,c as sr,ca as z,f as Hg,fa as xa,g as or,i as Ca,l as Ss,m as ba,ma as e_,n as gt,o as Vt,s as he,wa as t_,z as Cs,za as En}from"./chunk-LPSFCYGT.js";import{a as Dt,b as As,h as Rc,i as k}from"./chunk-66YHNWRR.js";var ks=new Ge("angularfire2.auth.use-emulator"),Ds=new Ge("angularfire2.auth.settings"),Vs=new Ge("angularfire2.auth.tenant-id"),Os=new Ge("angularfire2.auth.langugage-code"),Fs=new Ge("angularfire2.auth.use-device-language"),Ms=new Ge("angularfire.auth.persistence"),Ls=(n,e,t,r,i,s,o,a)=>Zr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,d]of Object.entries(o))u.settings[c]=d;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),ei=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,c,d,m,p,y){let S=new Hg,N=Vt(void 0).pipe(Ss(o.outsideAngular),rn(()=>s.runOutsideAngular(()=>import("./chunk-2MXWPHA2.js"))),he(()=>Xr(t,s,r)),he(x=>Ls(x,s,a,c,d,m,u,p)),Pc({bufferSize:1,refCount:!1}));if(ka(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Vt(null);else{N.pipe(Yg()).subscribe();let x=N.pipe(rn(F=>F.getRedirectResult().then(K=>K,()=>null)),Ce,Pc({bufferSize:1,refCount:!1})),q=N.pipe(rn(F=>new sr(K=>({unsubscribe:s.runOutsideAngular(()=>F.onAuthStateChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))})))),j=N.pipe(rn(F=>new sr(K=>({unsubscribe:s.runOutsideAngular(()=>F.onIdTokenChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))}))));this.authState=x.pipe(Nc(q),ba(o.outsideAngular),Ss(o.insideAngular)),this.user=x.pipe(Nc(j),ba(o.outsideAngular),Ss(o.insideAngular)),this.idToken=this.user.pipe(rn(F=>F?gt(F.getIdToken()):Vt(null))),this.idTokenResult=this.user.pipe(rn(F=>F?gt(F.getIdTokenResult()):Vt(null))),this.credential=Cs(x,S,this.authState.pipe(bs(F=>!F))).pipe(he(F=>F?.user?F:null),ba(o.outsideAngular),Ss(o.insideAngular))}return __(this,N,s,{spy:{apply:(x,q,j)=>{(x.startsWith("signIn")||x.startsWith("createUser"))&&j.then(F=>S.next(F))}}})}static \u0275fac=function(r){return new(r||n)(z(Yr),z(Jr,8),z($r),z(En),z(Sn),z(ks,8),z(Ds,8),z(Vs,8),z(Os,8),z(Fs,8),z(Ms,8),z(An,8))};static \u0275prov=Ot({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var I_="@firebase/database",T_="1.0.7";var ed="";function td(n){ed=n}var Yc=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),xe(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Oa(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Jc=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return _t(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var ey=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Yc(e)}}catch{}return new Jc},ur=ey("localStorage"),Xc=ey("sessionStorage");var ii=new Hr("@firebase/database"),ty=function(){let n=1;return function(){return n++}}(),ny=function(n){let e=d_(n),t=new h_;t.update(e);let r=t.digest();return n_.encodeByteArray(r)},lo=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=lo.apply(null,r):typeof r=="object"?e+=xe(r):e+=r,e+=" "}return e},cr=null,A_=!0,ry=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(ii.logLevel=yt.VERBOSE,cr=ii.log.bind(ii),e&&Xc.set("logging_enabled",!0)):typeof n=="function"?cr=n:(cr=null,Xc.remove("logging_enabled"))},Be=function(...n){if(A_===!0&&(A_=!1,cr===null&&Xc.get("logging_enabled")===!0&&ry(!0)),cr){let e=lo.apply(null,n);cr(e)}},uo=function(n){return function(...e){Be(n,...e)}},Zc=function(...n){let e="FIREBASE INTERNAL ERROR: "+lo(...n);ii.error(e)},qt=function(...n){let e=`FIREBASE FATAL ERROR: ${lo(...n)}`;throw ii.error(e),new Error(e)},He=function(...n){let e="FIREBASE WARNING: "+lo(...n);ii.warn(e)},lA=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&He("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ml=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},uA=function(n){if(Ft()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Pn="[MIN_NAME]",sn="[MAX_NAME]",dr=function(n,e){if(n===e)return 0;if(n===Pn||e===sn)return-1;if(e===Pn||n===sn)return 1;{let t=S_(n),r=S_(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},cA=function(n,e){return n===e?0:n<e?-1:1},Us=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+xe(e))},nd=function(n){if(typeof n!="object"||n===null)return xe(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=xe(e[r]),t+=":",t+=nd(n[e[r]]);return t+="}",t},iy=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function qe(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var sy=function(n){O(!ml(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,u;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let d=c.join(""),m="";for(u=0;u<64;u+=8){let p=parseInt(d.substr(u,8),2).toString(16);p.length===1&&(p="0"+p),m=m+p}return m.toLowerCase()},hA=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},dA=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function fA(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var mA=new RegExp("^-?(0*)\\d{1,10}$"),pA=-2147483648,gA=2147483647,S_=function(n){if(mA.test(n)){let e=Number(n);if(e>=pA&&e<=gA)return e}return null},fi=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw He("Exception was thrown by user callback.",t),e},Math.floor(0))}},_A=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Gs=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var eh=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){He(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var th=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Be("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',He(e)}},Ws=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),ja="5",oy="v",ay="s",ly="r",uy="f",cy=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,hy="ls",dy="p",nh="ac",fy="websocket",my="long_polling";var Ga=class{constructor(e,t,r,i,s=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ur.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ur.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function yA(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function py(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let r;if(e===fy)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===my)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);yA(n)&&(t.ns=n.namespace);let i=[];return qe(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var rh=class{constructor(){this.counters_={}}incrementCounter(e,t=1){_t(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return i_(this.counters_)}};var Gc={},Wc={};function rd(n){let e=n.toString();return Gc[e]||(Gc[e]=new rh),Gc[e]}function vA(n,e){let t=n.toString();return Wc[t]||(Wc[t]=e()),Wc[t]}var ih=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&fi(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var C_="start",wA="close",EA="pLPCommand",IA="pRTLPCB",gy="id",_y="pw",yy="ser",TA="cb",AA="seg",SA="ts",CA="d",bA="dframe",vy=1870,wy=30,RA=vy-wy,PA=25e3,NA=3e4,Qs=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=uo(e),this.stats_=rd(t),this.urlFn=u=>(this.appCheckToken&&(u[nh]=this.appCheckToken),py(t,my,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ih(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(NA)),uA(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sh((...s)=>{let[o,a,u,c,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===C_)this.id=a,this.password=u;else if(o===wA)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[C_]="t",r[yy]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[TA]=this.scriptTagHolder.uniqueCallbackIdentifier),r[oy]=ja,this.transportSessionId&&(r[ay]=this.transportSessionId),this.lastSessionId&&(r[hy]=this.lastSessionId),this.applicationId&&(r[dy]=this.applicationId),this.appCheckToken&&(r[nh]=this.appCheckToken),typeof location<"u"&&location.hostname&&cy.test(location.hostname)&&(r[ly]=uy);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ft()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!hA()&&!dA()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=xe(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=r_(t),i=iy(r,RA);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ft())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[bA]="t",r[gy]=e,r[_y]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=xe(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},sh=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ft())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=ty(),window[EA+this.uniqueCallbackIdentifier]=e,window[IA+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Be("frame writing exception"),a.stack&&Be(a.stack),Be(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Be("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[gy]=this.myID,e[_y]=this.myPW,e[yy]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+wy+r.length<=vy;){let o=this.pendingSegs.shift();r=r+"&"+AA+i+"="+o.seg+"&"+SA+i+"="+o.ts+"&"+CA+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(PA)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Ft()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Be("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var xA=16384,kA=45e3,Wa=null;typeof MozWebSocket<"u"?Wa=MozWebSocket:typeof WebSocket<"u"&&(Wa=WebSocket);var ni=(()=>{class n{constructor(t,r,i,s,o,a,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=uo(this.connId),this.stats_=rd(r),this.connURL=n.connectionURL_(r,a,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[oy]=ja,!Ft()&&typeof location<"u"&&location.hostname&&cy.test(location.hostname)&&(a[ly]=uy),r&&(a[ay]=r),i&&(a[hy]=i),s&&(a[nh]=s),o&&(a[dy]=o),py(t,fy,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ur.set("previous_websocket_failure",!0);try{let i;if(Ft()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${ja}/${ed}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Wa(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Wa!==null&&!n.forceDisallow_}static previouslyFailed(){return ur.isInMemoryStorage||ur.get("previous_websocket_failure")===!0}markConnectionHealthy(){ur.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Oa(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=xe(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=iy(r,xA);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(kA))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Ey=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Qs,ni]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=ni&&ni.isAvailable(),i=r&&!ni.previouslyFailed();if(t.webSocketOnly&&(r||He("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ni];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),DA=6e4,VA=5e3,OA=10*1024,FA=100*1024,zc="t",b_="d",MA="s",R_="r",LA="e",P_="o",N_="a",x_="n",k_="p",UA="h",oh=class{constructor(e,t,r,i,s,o,a,u,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=uo("c:"+this.id+":"),this.transportManager_=new Ey(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Gs(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>FA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>OA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(zc in e){let t=e[zc];t===N_?this.upgradeIfSecondaryHealthy_():t===R_?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===P_&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Us("t",e),r=Us("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:k_,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:N_,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:x_,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Us("t",e),r=Us("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Us(zc,e);if(b_ in e){let r=e[b_];if(t===UA){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===x_){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===MA?this.onConnectionShutdown_(r):t===R_?this.onReset_(r):t===LA?Zc("Server Error: "+r):t===P_?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Zc("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ja!==r&&He("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Gs(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(DA))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Gs(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(VA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:k_,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ur.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var za=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Ka=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var $a=class n extends Ka{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!kc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var D_=32,V_=768,ue=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ue("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Nn(n){return n.pieces_.length-n.pieceNum_}function fe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ue(n.pieces_,e)}function id(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function BA(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Hs(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Iy(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ue(e,0)}function ve(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ue)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new ue(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function tt(n,e){let t=Z(n),r=Z(e);if(t===null)return e;if(t===r)return tt(fe(n),fe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function qA(n,e){let t=Hs(n,0),r=Hs(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=dr(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function sd(n,e){if(Nn(n)!==Nn(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function vt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Nn(n)>Nn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var ah=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Hs(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ns(this.parts_[r]);Ty(this)}};function jA(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ns(e),Ty(n)}function GA(n){let e=n.parts_.pop();n.byteLength_-=Ns(e),n.parts_.length>0&&(n.byteLength_-=1)}function Ty(n){if(n.byteLength_>V_)throw new Error(n.errorPrefix_+"has a key path longer than "+V_+" bytes ("+n.byteLength_+").");if(n.parts_.length>D_)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+D_+") or object contains a cycle "+lr(n))}function lr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var lh=class n extends Ka{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var Bs=1e3,WA=60*5*1e3,O_=30*1e3,zA=1.3,KA=3e4,$A="server_kill",F_=3,od=(()=>{class n extends za{constructor(t,r,i,s,o,a,u,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=uo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Bs,this.maxReconnectDelay_=WA,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ft())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");lh.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&$a.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(xe(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new et,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,d=u.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&_t(t,"w")){let i=In(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();He(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||u_(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=O_)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=l_(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+xe(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Zc("Unrecognized action received from server: "+xe(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>KA&&(this.reconnectDelay_=Bs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*zA)}this.onConnectStatus_(!1)}establishConnection_(){return k(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,i())},d=function(p){O(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:d};let m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[p,y]=yield Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);a?Be("getToken() completed but was canceled"):(Be("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=y&&y.token,u=new oh(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,S=>{He(S+" ("+this.repoInfo_.toString()+")"),this.interrupt($A)},o))}catch(p){this.log_("Failed to get token: "+p),a||(this.repoInfo_.nodeAdmin&&He(p),c())}}})}interrupt(t){Be("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Be("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Fa(this.interruptReasons_)&&(this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>nd(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new ue(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){Be("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=F_&&(this.reconnectDelay_=O_,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Be("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=F_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Ft()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+ed.replace(/\./g,"-")]=1,kc()?t["framework.cordova"]=1:s_()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=$a.getInstance().currentlyOnline();return Fa(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var si=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new te(Pn,e),i=new te(Pn,t);return this.compare(r,i)!==0}minPost(){return te.MIN}};var qa,Qa=class extends si{static get __EMPTY_NODE(){return qa}static set __EMPTY_NODE(e){qa=e}compare(e,t){return dr(e.name,t.name)}isDefinedOn(e){throw Qr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(sn,qa)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,qa)}toString(){return".key"}},Bt=new Qa;var ri=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},bt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??wt.EMPTY_NODE,this.right=o??wt.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return wt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return wt.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),uh=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new bt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},wt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,bt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,bt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ri(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ri(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ri(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ri(this.root_,null,this.comparator_,!0,e)}};wt.EMPTY_NODE=new uh;function QA(n,e){return dr(n.name,e.name)}function ad(n,e){return dr(n,e)}var ch;function HA(n){ch=n}var Ay=function(n){return typeof n=="number"?"number:"+sy(n):"string:"+n},Sy=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&_t(e,".sv"),"Priority must be a string or number.")}else O(n===ch||n.isEmpty(),"priority of unexpected type.");O(n===ch||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var M_,oi=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Sy(this.priorityNode_)}static set __childrenNodeConstructor(t){M_=t}static get __childrenNodeConstructor(){return M_}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=Z(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(O(i!==".priority"||Nn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(fe(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ay(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=sy(this.value_):t+=this.value_,this.lazyHash_=ny(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return O(s>=0,"Unknown leaf type: "+r),O(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Cy,by;function YA(n){Cy=n}function JA(n){by=n}var hh=class extends si{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?dr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(sn,new oi("[PRIORITY-POST]",by))}makePost(e,t){let r=Cy(e);return new te(t,new oi("[PRIORITY-POST]",r))}toString(){return".priority"}},pe=new hh;var XA=Math.log(2),dh=class{constructor(e){let t=s=>parseInt(Math.log(s)/XA,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Ha=function(n,e,t,r){n.sort(e);let i=function(u,c){let d=c-u,m,p;if(d===0)return null;if(d===1)return m=n[u],p=t?t(m):m,new bt(p,m.node,bt.BLACK,null,null);{let y=parseInt(d/2,10)+u,S=i(u,y),N=i(y+1,c);return m=n[y],p=t?t(m):m,new bt(p,m.node,bt.BLACK,S,N)}},s=function(u){let c=null,d=null,m=n.length,p=function(S,N){let x=m-S,q=m;m-=S;let j=i(x+1,q),F=n[x],K=t?t(F):F;y(new bt(K,F.node,N,null,j))},y=function(S){c?(c.left=S,c=S):(d=S,c=S)};for(let S=0;S<u.count;++S){let N=u.nextBitIsOne(),x=Math.pow(2,u.count-(S+1));N?p(x,bt.BLACK):(p(x,bt.BLACK),p(x,bt.RED))}return d},o=new dh(n.length),a=s(o);return new wt(r||e,a)};var Kc,ti={},ai=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(ti&&pe,"ChildrenNode.ts has not been loaded"),Kc=Kc||new n({".priority":ti},{".priority":pe}),Kc}get(e){let t=In(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof wt?t:null}hasIndex(e){return _t(this.indexSet_,e.toString())}addIndex(e,t){O(e!==Bt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=Ha(r,e.getCompare()):a=ti;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let d=Object.assign({},this.indexes_);return d[u]=a,new n(d,c)}addToIndexes(e,t){let r=Ps(this.indexes_,(i,s)=>{let o=In(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),i===ti)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(te.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),Ha(a,o.getCompare())}else return ti;else{let a=t.get(e.name),u=i;return a&&(u=u.remove(new te(e.name,a))),u.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Ps(this.indexes_,i=>{if(i===ti)return i;{let s=t.get(e.name);return s?i.remove(new te(e.name,s)):i}});return new n(r,this.indexSet_)}};var qs,J=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Sy(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return qs||(qs=new n(new wt(ad),null,ai.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||qs}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?qs:r}}getChild(t){let r=Z(t);return r===null?this:this.getImmediateChild(r).getChild(fe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(O(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new te(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?qs:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=Z(t);if(i===null)return r;{O(Z(t)!==".priority"||Nn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(fe(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(pe,(a,u)=>{r[a]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let u in r)a[u]=r[u];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Ay(this.getPriority().val())+":"),this.forEachChild(pe,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":ny(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new te(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new te(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new te(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===co?-1:0}withIndex(t){if(t===Bt||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Bt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(pe),s=r.getIterator(pe),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Bt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),fh=class extends J{constructor(){super(new wt(ad),J.EMPTY_NODE,ai.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return J.EMPTY_NODE}isEmpty(){return!1}},co=new fh;Object.defineProperties(te,{MIN:{value:new te(Pn,J.EMPTY_NODE)},MAX:{value:new te(sn,co)}});Qa.__EMPTY_NODE=J.EMPTY_NODE;oi.__childrenNodeConstructor=J;HA(co);JA(co);var ZA=!0;function Ie(n,e=null){if(n===null)return J.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new oi(t,Ie(e))}if(!(n instanceof Array)&&ZA){let t=[],r=!1;if(qe(n,(o,a)=>{if(o.substring(0,1)!=="."){let u=Ie(a);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),t.push(new te(o,u)))}}),t.length===0)return J.EMPTY_NODE;let s=Ha(t,QA,o=>o.name,ad);if(r){let o=Ha(t,pe.getCompare());return new J(s,Ie(e),new ai({".priority":o},{".priority":pe}))}else return new J(s,Ie(e),ai.Default)}else{let t=J.EMPTY_NODE;return qe(n,(r,i)=>{if(_t(n,r)&&r.substring(0,1)!=="."){let s=Ie(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ie(e))}}YA(Ie);var Ys=class extends si{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?dr(e.name,t.name):s}makePost(e,t){let r=Ie(e),i=J.EMPTY_NODE.updateChild(this.indexPath_,r);return new te(t,i)}maxPost(){let e=J.EMPTY_NODE.updateChild(this.indexPath_,co);return new te(sn,e)}toString(){return Hs(this.indexPath_,0).join("/")}};var mh=class extends si{compare(e,t){let r=e.node.compareTo(t.node);return r===0?dr(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let r=Ie(e);return new te(t,r)}toString(){return".value"}},ld=new mh;function Ry(n){return{type:"value",snapshotNode:n}}function li(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Js(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Xs(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function eS(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Zs=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Js(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(li(t,r)):o.trackChildChange(Xs(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(pe,(i,s)=>{t.hasChild(i)||r.trackChildChange(Js(i,s))}),t.isLeafNode()||t.forEachChild(pe,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Xs(i,s,o))}else r.trackChildChange(li(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?J.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Ya=class n{constructor(e){this.indexedFilter_=new Zs(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new te(t,r))||(r=J.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=J.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(J.EMPTY_NODE);let s=this;return t.forEachChild(pe,(o,a)=>{s.matches(new te(o,a))||(i=i.updateImmediateChild(o,J.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var ph=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ya(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new te(t,r))||(r=J.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=J.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=J.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(J.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,J.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let m=this.index_.getCompare();o=(p,y)=>m(y,p)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let u=new te(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(a.hasChild(t)){let m=a.getImmediateChild(t),p=i.getChildAfterChild(this.index_,c,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);let y=p==null?1:o(p,u);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(Xs(t,r,m)),a.updateImmediateChild(t,r);{s?.trackChildChange(Js(t,m));let N=a.updateImmediateChild(t,J.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(s?.trackChildChange(li(p.name,p.node)),N.updateImmediateChild(p.name,p.node)):N}}else return r.isEmpty()?e:d&&o(c,u)>=0?(s!=null&&(s.trackChildChange(Js(c.name,c.node)),s.trackChildChange(li(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,J.EMPTY_NODE)):e}};var eo=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Pn}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:sn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===pe}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function tS(n){return n.loadsAllData()?new Zs(n.getIndex()):n.hasLimit()?new ph(n):new Ya(n)}function nS(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function rS(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function gh(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function iS(n,e,t){let r;return n.index_===Bt||t?r=gh(n,e,t):r=gh(n,e,sn),r.startAfterSet_=!0,r}function _h(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function sS(n,e,t){let r;return n.index_===Bt||t?r=_h(n,e,t):r=_h(n,e,Pn),r.endBeforeSet_=!0,r}function pl(n,e){let t=n.copy();return t.index_=e,t}function L_(n){let e={};if(n.isDefault())return e;let t;if(n.index_===pe?t="$priority":n.index_===ld?t="$value":n.index_===Bt?t="$key":(O(n.index_ instanceof Ys,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=xe(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=xe(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+xe(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=xe(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+xe(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function U_(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==pe&&(e.i=n.index_.toString()),e}var yh=class n extends za{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=uo("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let u=L_(e._queryParams);this.restRequest_(s+".json",u,(c,d)=>{let m=d;if(c===404&&(m=null,c=null),c===null&&this.onDataUpdate_(s,m,!1,r),In(this.listens_,o)===a){let p;c?c===401?p="permission_denied":p="rest_error:"+c:p="ok",i(p,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=L_(e._queryParams),r=e._path.toString(),i=new et;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+c_(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=Oa(a.responseText)}catch{He("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,u)}else a.status!==401&&a.status!==404&&He("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var vh=class{constructor(){this.rootNode_=J.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Ja(){return{value:null,children:new Map}}function mi(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=Z(e);n.children.has(r)||n.children.set(r,Ja());let i=n.children.get(r);e=fe(e),mi(i,e,t)}}function wh(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(pe,(r,i)=>{mi(n,new ue(r),i)}),wh(n,e)}}else if(n.children.size>0){let t=Z(e);return e=fe(e),n.children.has(t)&&wh(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Eh(n,e,t){n.value!==null?t(e,n.value):oS(n,(r,i)=>{let s=new ue(e.toString()+"/"+r);Eh(i,s,t)})}function oS(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Ih=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&qe(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var B_=10*1e3,aS=30*1e3,lS=5*60*1e3,Th=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ih(e);let r=B_+(aS-B_)*Math.random();Gs(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;qe(e,(i,s)=>{s>0&&_t(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Gs(this.reportStats_.bind(this),Math.floor(Math.random()*2*lS))}};var Ut=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ut||{});function ud(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function cd(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function hd(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Ah=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Ut.ACK_USER_WRITE,this.source=ud()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ue(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(fe(this.path),this.affectedTree,this.revert)}};var Xa=class n{constructor(e,t){this.source=e,this.path=t,this.type=Ut.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,fe(this.path))}};var ui=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Ut.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,fe(this.path),this.snap)}};var to=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Ut.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ue(e));return t.isEmpty()?null:t.value?new ui(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,fe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var jt=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Sh=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function uS(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(eS(o.childName,o.snapshotNode))}),js(n,i,"child_removed",e,r,t),js(n,i,"child_added",e,r,t),js(n,i,"child_moved",s,r,t),js(n,i,"child_changed",e,r,t),js(n,i,"value",e,r,t),i}function js(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,u)=>hS(n,a,u)),o.forEach(a=>{let u=cS(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,n.query_))})})}function cS(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function hS(n,e,t){if(e.childName==null||t.childName==null)throw Qr("Should only compare child_ events.");let r=new te(e.childName,e.snapshotNode),i=new te(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function gl(n,e){return{eventCache:n,serverCache:e}}function zs(n,e,t,r){return gl(new jt(e,t,r),n.serverCache)}function Py(n,e,t,r){return gl(n.eventCache,new jt(e,t,r))}function Za(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function hr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var $c,dS=()=>($c||($c=new wt(cA)),$c),nt=class n{constructor(e,t=dS()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return qe(e,(r,i)=>{t=t.set(new ue(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let r=Z(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(fe(e),t);return s!=null?{path:ve(new ue(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),r=this.children.get(t);return r!==null?r.subtree(fe(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let r=Z(e),s=(this.children.get(r)||new n(null)).set(fe(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),r=this.children.get(t);if(r){let i=r.remove(fe(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),r=this.children.get(t);return r?r.get(fe(e)):null}}setTree(e,t){if(ee(e))return t;{let r=Z(e),s=(this.children.get(r)||new n(null)).setTree(fe(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ve(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(fe(e),ve(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,r){if(ee(e))return this;{this.value&&r(t,this.value);let i=Z(e),s=this.children.get(i);return s?s.foreachOnPath_(fe(e),ve(t,i),r):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(ve(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Rt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new nt(null))}};function Ks(n,e,t){if(ee(e))return new Rt(new nt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=tt(i,e);return s=s.updateChild(o,t),new Rt(n.writeTree_.set(i,s))}else{let i=new nt(t),s=n.writeTree_.setTree(e,i);return new Rt(s)}}}function Ch(n,e,t){let r=n;return qe(t,(i,s)=>{r=Ks(r,ve(e,i),s)}),r}function q_(n,e){if(ee(e))return Rt.empty();{let t=n.writeTree_.setTree(e,new nt(null));return new Rt(t)}}function bh(n,e){return fr(n,e)!=null}function fr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(tt(t.path,e)):null}function j_(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(pe,(r,i)=>{e.push(new te(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new te(r,i.value))}),e}function bn(n,e){if(ee(e))return n;{let t=fr(n,e);return t!=null?new Rt(new nt(t)):new Rt(n.writeTree_.subtree(e))}}function Rh(n){return n.writeTree_.isEmpty()}function ci(n,e){return Ny(le(),n.writeTree_,e)}function Ny(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=Ny(ve(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(ve(n,".priority"),r)),t}}function _l(n,e){return Vy(e,n)}function fS(n,e,t,r,i){O(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Ks(n.visibleWrites,e,t)),n.lastWriteId=r}function mS(n,e,t,r){O(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Ch(n.visibleWrites,e,t),n.lastWriteId=r}function pS(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function gS(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&_S(a,r.path)?i=!1:vt(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return yS(n),!0;if(r.snap)n.visibleWrites=q_(n.visibleWrites,r.path);else{let a=r.children;qe(a,u=>{n.visibleWrites=q_(n.visibleWrites,ve(r.path,u))})}return!0}else return!1}function _S(n,e){if(n.snap)return vt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&vt(ve(n.path,t),e))return!0;return!1}function yS(n){n.visibleWrites=xy(n.allWrites,vS,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function vS(n){return n.visible}function xy(n,e,t){let r=Rt.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)vt(t,o)?(a=tt(t,o),r=Ks(r,a,s.snap)):vt(o,t)&&(a=tt(o,t),r=Ks(r,le(),s.snap.getChild(a)));else if(s.children){if(vt(t,o))a=tt(t,o),r=Ch(r,a,s.children);else if(vt(o,t))if(a=tt(o,t),ee(a))r=Ch(r,le(),s.children);else{let u=In(s.children,Z(a));if(u){let c=u.getChild(fe(a));r=Ks(r,le(),c)}}}else throw Qr("WriteRecord should have .snap or .children")}}return r}function ky(n,e,t,r,i){if(!r&&!i){let s=fr(n.visibleWrites,e);if(s!=null)return s;{let o=bn(n.visibleWrites,e);if(Rh(o))return t;if(t==null&&!bh(o,le()))return null;{let a=t||J.EMPTY_NODE;return ci(o,a)}}}else{let s=bn(n.visibleWrites,e);if(!i&&Rh(s))return t;if(!i&&t==null&&!bh(s,le()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(vt(c.path,e)||vt(e,c.path))},a=xy(n.allWrites,o,e),u=t||J.EMPTY_NODE;return ci(a,u)}}}function wS(n,e,t){let r=J.EMPTY_NODE,i=fr(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(pe,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=bn(n.visibleWrites,e);return t.forEachChild(pe,(o,a)=>{let u=ci(bn(s,new ue(o)),a);r=r.updateImmediateChild(o,u)}),j_(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=bn(n.visibleWrites,e);return j_(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function ES(n,e,t,r,i){O(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=ve(e,t);if(bh(n.visibleWrites,s))return null;{let o=bn(n.visibleWrites,s);return Rh(o)?i.getChild(t):ci(o,i.getChild(t))}}function IS(n,e,t,r){let i=ve(e,t),s=fr(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=bn(n.visibleWrites,i);return ci(o,r.getNode().getImmediateChild(t))}else return null}function TS(n,e){return fr(n.visibleWrites,e)}function AS(n,e,t,r,i,s,o){let a,u=bn(n.visibleWrites,e),c=fr(u,le());if(c!=null)a=c;else if(t!=null)a=ci(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],m=o.getCompare(),p=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),y=p.getNext();for(;y&&d.length<i;)m(y,r)!==0&&d.push(y),y=p.getNext();return d}else return[]}function SS(){return{visibleWrites:Rt.empty(),allWrites:[],lastWriteId:-1}}function el(n,e,t,r){return ky(n.writeTree,n.treePath,e,t,r)}function dd(n,e){return wS(n.writeTree,n.treePath,e)}function G_(n,e,t,r){return ES(n.writeTree,n.treePath,e,t,r)}function tl(n,e){return TS(n.writeTree,ve(n.treePath,e))}function CS(n,e,t,r,i,s){return AS(n.writeTree,n.treePath,e,t,r,i,s)}function fd(n,e,t){return IS(n.writeTree,n.treePath,e,t)}function Dy(n,e){return Vy(ve(n.treePath,e),n.writeTree)}function Vy(n,e){return{treePath:n,writeTree:e}}var Ph=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Xs(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Js(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,li(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Xs(r,e.snapshotNode,i.oldSnap));else throw Qr("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Nh=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},Oy=new Nh,no=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new jt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fd(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:hr(this.viewCache_),s=CS(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function bS(n){return{filter:n}}function RS(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function PS(n,e,t,r,i){let s=new Ph,o,a;if(t.type===Ut.OVERWRITE){let c=t;c.source.fromUser?o=xh(n,e,c.path,c.snap,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!ee(c.path),o=nl(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===Ut.MERGE){let c=t;c.source.fromUser?o=xS(n,e,c.path,c.children,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=kh(n,e,c.path,c.children,r,i,a,s))}else if(t.type===Ut.ACK_USER_WRITE){let c=t;c.revert?o=VS(n,e,c.path,r,i,s):o=kS(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===Ut.LISTEN_COMPLETE)o=DS(n,e,t.path,r,s);else throw Qr("Unknown operation type: "+t.type);let u=s.getChanges();return NS(e,o,u),{viewCache:o,changes:u}}function NS(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Za(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Ry(Za(e)))}}function Fy(n,e,t,r,i,s){let o=e.eventCache;if(tl(r,t)!=null)return e;{let a,u;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=hr(e),d=c instanceof J?c:J.EMPTY_NODE,m=dd(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),m,s)}else{let c=el(r,hr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=Z(t);if(c===".priority"){O(Nn(t)===1,"Can't have a priority with additional path components");let d=o.getNode();u=e.serverCache.getNode();let m=G_(r,t,d,u);m!=null?a=n.filter.updatePriority(d,m):a=o.getNode()}else{let d=fe(t),m;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let p=G_(r,t,o.getNode(),u);p!=null?m=o.getNode().getImmediateChild(c).updateChild(d,p):m=o.getNode().getImmediateChild(c)}else m=fd(r,c,e.serverCache);m!=null?a=n.filter.updateChild(o.getNode(),c,m,d,i,s):a=o.getNode()}}return zs(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function nl(n,e,t,r,i,s,o,a){let u=e.serverCache,c,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))c=d.updateFullNode(u.getNode(),r,null);else if(d.filtersNodes()&&!u.isFiltered()){let y=u.getNode().updateChild(t,r);c=d.updateFullNode(u.getNode(),y,null)}else{let y=Z(t);if(!u.isCompleteForPath(t)&&Nn(t)>1)return e;let S=fe(t),x=u.getNode().getImmediateChild(y).updateChild(S,r);y===".priority"?c=d.updatePriority(u.getNode(),x):c=d.updateChild(u.getNode(),y,x,S,Oy,null)}let m=Py(e,c,u.isFullyInitialized()||ee(t),d.filtersNodes()),p=new no(i,m,s);return Fy(n,m,t,i,p,a)}function xh(n,e,t,r,i,s,o){let a=e.eventCache,u,c,d=new no(i,e,s);if(ee(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),u=zs(e,c,!0,n.filter.filtersNodes());else{let m=Z(t);if(m===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),u=zs(e,c,a.isFullyInitialized(),a.isFiltered());else{let p=fe(t),y=a.getNode().getImmediateChild(m),S;if(ee(p))S=r;else{let N=d.getCompleteChild(m);N!=null?id(p)===".priority"&&N.getChild(Iy(p)).isEmpty()?S=N:S=N.updateChild(p,r):S=J.EMPTY_NODE}if(y.equals(S))u=e;else{let N=n.filter.updateChild(a.getNode(),m,S,p,d,o);u=zs(e,N,a.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function W_(n,e){return n.eventCache.isCompleteForChild(e)}function xS(n,e,t,r,i,s,o){let a=e;return r.foreach((u,c)=>{let d=ve(t,u);W_(e,Z(d))&&(a=xh(n,a,d,c,i,s,o))}),r.foreach((u,c)=>{let d=ve(t,u);W_(e,Z(d))||(a=xh(n,a,d,c,i,s,o))}),a}function z_(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function kh(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;ee(t)?c=r:c=new nt(null).setTree(t,r);let d=e.serverCache.getNode();return c.children.inorderTraversal((m,p)=>{if(d.hasChild(m)){let y=e.serverCache.getNode().getImmediateChild(m),S=z_(n,y,p);u=nl(n,u,new ue(m),S,i,s,o,a)}}),c.children.inorderTraversal((m,p)=>{let y=!e.serverCache.isCompleteForChild(m)&&p.value===null;if(!d.hasChild(m)&&!y){let S=e.serverCache.getNode().getImmediateChild(m),N=z_(n,S,p);u=nl(n,u,new ue(m),N,i,s,o,a)}}),u}function kS(n,e,t,r,i,s,o){if(tl(i,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(ee(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return nl(n,e,t,u.getNode().getChild(t),i,s,a,o);if(ee(t)){let c=new nt(null);return u.getNode().forEachChild(Bt,(d,m)=>{c=c.set(new ue(d),m)}),kh(n,e,t,c,i,s,a,o)}else return e}else{let c=new nt(null);return r.foreach((d,m)=>{let p=ve(t,d);u.isCompleteForPath(p)&&(c=c.set(d,u.getNode().getChild(p)))}),kh(n,e,t,c,i,s,a,o)}}function DS(n,e,t,r,i){let s=e.serverCache,o=Py(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return Fy(n,o,t,r,Oy,i)}function VS(n,e,t,r,i,s){let o;if(tl(r,t)!=null)return e;{let a=new no(r,e,i),u=e.eventCache.getNode(),c;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=el(r,hr(e));else{let m=e.serverCache.getNode();O(m instanceof J,"serverChildren would be complete if leaf node"),d=dd(r,m)}d=d,c=n.filter.updateFullNode(u,d,s)}else{let d=Z(t),m=fd(r,d,e.serverCache);m==null&&e.serverCache.isCompleteForChild(d)&&(m=u.getImmediateChild(d)),m!=null?c=n.filter.updateChild(u,d,m,fe(t),a,s):e.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(u,d,J.EMPTY_NODE,fe(t),a,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=el(r,hr(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||tl(r,le())!=null,zs(e,c,o,n.filter.filtersNodes())}}var Dh=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Zs(r.getIndex()),s=tS(r);this.processor_=bS(s);let o=t.serverCache,a=t.eventCache,u=i.updateFullNode(J.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(J.EMPTY_NODE,a.getNode(),null),d=new jt(u,o.isFullyInitialized(),i.filtersNodes()),m=new jt(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=gl(m,d),this.eventGenerator_=new Sh(this.query_)}get query(){return this.query_}};function OS(n){return n.viewCache_.serverCache.getNode()}function FS(n){return Za(n.viewCache_)}function MS(n,e){let t=hr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function K_(n){return n.eventRegistrations_.length===0}function LS(n,e){n.eventRegistrations_.push(e)}function $_(n,e,t){let r=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function Q_(n,e,t,r){e.type===Ut.MERGE&&e.source.queryId!==null&&(O(hr(n.viewCache_),"We should always have a full cache before handling merges"),O(Za(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=PS(n.processor_,i,e,t,r);return RS(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,My(n,s.changes,s.viewCache.eventCache.getNode(),null)}function US(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(pe,(s,o)=>{r.push(li(s,o))}),t.isFullyInitialized()&&r.push(Ry(t.getNode())),My(n,r,t.getNode(),e)}function My(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return uS(n.eventGenerator_,e,t,i)}var rl,il=class{constructor(){this.views=new Map}};function BS(n){O(!rl,"__referenceConstructor has already been defined"),rl=n}function qS(){return O(rl,"Reference.ts has not been loaded"),rl}function jS(n){return n.views.size===0}function md(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return O(s!=null,"SyncTree gave us an op for an invalid query."),Q_(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(Q_(o,e,t,r));return s}}function Ly(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=el(t,i?r:null),u=!1;a?u=!0:r instanceof J?(a=dd(t,r),u=!1):(a=J.EMPTY_NODE,u=!1);let c=gl(new jt(a,u,!1),new jt(r,i,!1));return new Dh(e,c)}return o}function GS(n,e,t,r,i,s){let o=Ly(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),LS(o,t),US(o,t)}function WS(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=xn(n);if(i==="default")for(let[u,c]of n.views.entries())o=o.concat($_(c,t,r)),K_(c)&&(n.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=n.views.get(i);u&&(o=o.concat($_(u,t,r)),K_(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!xn(n)&&s.push(new(qS())(e._repo,e._path)),{removed:s,events:o}}function Uy(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Rn(n,e){let t=null;for(let r of n.views.values())t=t||MS(r,e);return t}function By(n,e){if(e._queryParams.loadsAllData())return yl(n);{let r=e._queryIdentifier;return n.views.get(r)}}function qy(n,e){return By(n,e)!=null}function xn(n){return yl(n)!=null}function yl(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var sl;function zS(n){O(!sl,"__referenceConstructor has already been defined"),sl=n}function KS(){return O(sl,"Reference.ts has not been loaded"),sl}var $S=1,ol=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new nt(null),this.pendingWriteTree_=SS(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function pd(n,e,t,r,i){return fS(n.pendingWriteTree_,e,t,r,i),i?pi(n,new ui(ud(),e,t)):[]}function QS(n,e,t,r){mS(n.pendingWriteTree_,e,t,r);let i=nt.fromObject(t);return pi(n,new to(ud(),e,i))}function Cn(n,e,t=!1){let r=pS(n.pendingWriteTree_,e);if(gS(n.pendingWriteTree_,e)){let s=new nt(null);return r.snap!=null?s=s.set(le(),!0):qe(r.children,o=>{s=s.set(new ue(o),!0)}),pi(n,new Ah(r.path,s,t))}else return[]}function ho(n,e,t){return pi(n,new ui(cd(),e,t))}function HS(n,e,t){let r=nt.fromObject(t);return pi(n,new to(cd(),e,r))}function YS(n,e){return pi(n,new Xa(cd(),e))}function JS(n,e,t){let r=gd(n,t);if(r){let i=_d(r),s=i.path,o=i.queryId,a=tt(s,e),u=new Xa(hd(o),a);return yd(n,s,u)}else return[]}function al(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||qy(o,e))){let u=WS(o,e,t,r);jS(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=u.removed;if(a=u.events,!i){let d=c.findIndex(p=>p._queryParams.loadsAllData())!==-1,m=n.syncPointTree_.findOnPath(s,(p,y)=>xn(y));if(d&&!m){let p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){let y=eC(p);for(let S=0;S<y.length;++S){let N=y[S],x=N.query,q=zy(n,N);n.listenProvider_.startListening($s(x),ro(n,x),q.hashFn,q.onComplete)}}}!m&&c.length>0&&!r&&(d?n.listenProvider_.stopListening($s(e),null):c.forEach(p=>{let y=n.queryToTagMap.get(wl(p));n.listenProvider_.stopListening($s(p),y)}))}tC(n,c)}return a}function jy(n,e,t,r){let i=gd(n,r);if(i!=null){let s=_d(i),o=s.path,a=s.queryId,u=tt(o,e),c=new ui(hd(a),u,t);return yd(n,o,c)}else return[]}function XS(n,e,t,r){let i=gd(n,r);if(i){let s=_d(i),o=s.path,a=s.queryId,u=tt(o,e),c=nt.fromObject(t),d=new to(hd(a),u,c);return yd(n,o,d)}else return[]}function Vh(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(p,y)=>{let S=tt(p,i);s=s||Rn(y,S),o=o||xn(y)});let a=n.syncPointTree_.get(i);a?(o=o||xn(a),s=s||Rn(a,le())):(a=new il,n.syncPointTree_=n.syncPointTree_.set(i,a));let u;s!=null?u=!0:(u=!1,s=J.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,S)=>{let N=Rn(S,le());N&&(s=s.updateImmediateChild(y,N))}));let c=qy(a,e);if(!c&&!e._queryParams.loadsAllData()){let p=wl(e);O(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");let y=nC();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}let d=_l(n.pendingWriteTree_,i),m=GS(a,e,t,d,s,u);if(!c&&!o&&!r){let p=By(a,e);m=m.concat(rC(n,e,p))}return m}function vl(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let u=tt(o,e),c=Rn(a,u);if(c)return c});return ky(i,e,s,t,!0)}function ZS(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,d)=>{let m=tt(c,t);r=r||Rn(d,m)});let i=n.syncPointTree_.get(t);i?r=r||Rn(i,le()):(i=new il,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new jt(r,!0,!1):null,a=_l(n.pendingWriteTree_,e._path),u=Ly(i,e,a,s?o.getNode():J.EMPTY_NODE,s);return FS(u)}function pi(n,e){return Gy(e,n.syncPointTree_,null,_l(n.pendingWriteTree_,le()))}function Gy(n,e,t,r){if(ee(n.path))return Wy(n,e,t,r);{let i=e.get(le());t==null&&i!=null&&(t=Rn(i,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),u=e.children.get(o);if(u&&a){let c=t?t.getImmediateChild(o):null,d=Dy(r,o);s=s.concat(Gy(a,u,c,d))}return i&&(s=s.concat(md(i,n,r,t))),s}}function Wy(n,e,t,r){let i=e.get(le());t==null&&i!=null&&(t=Rn(i,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,c=Dy(r,o),d=n.operationForChild(o);d&&(s=s.concat(Wy(d,a,u,c)))}),i&&(s=s.concat(md(i,n,r,t))),s}function zy(n,e){let t=e.query,r=ro(n,t);return{hashFn:()=>(OS(e)||J.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?JS(n,t._path,r):YS(n,t._path);{let s=fA(i,t);return al(n,t,null,s)}}}}function ro(n,e){let t=wl(e);return n.queryToTagMap.get(t)}function wl(n){return n._path.toString()+"$"+n._queryIdentifier}function gd(n,e){return n.tagToQueryMap.get(e)}function _d(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ue(n.substr(0,e))}}function yd(n,e,t){let r=n.syncPointTree_.get(e);O(r,"Missing sync point for query tag that we're tracking");let i=_l(n.pendingWriteTree_,e);return md(r,t,i,null)}function eC(n){return n.fold((e,t,r)=>{if(t&&xn(t))return[yl(t)];{let i=[];return t&&(i=Uy(t)),qe(r,(s,o)=>{i=i.concat(o)}),i}})}function $s(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(KS())(n._repo,n._path):n}function tC(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=wl(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function nC(){return $S++}function rC(n,e,t){let r=e._path,i=ro(n,e),s=zy(n,t),o=n.listenProvider_.startListening($s(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)O(!xn(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,d,m)=>{if(!ee(c)&&d&&xn(d))return[yl(d).query];{let p=[];return d&&(p=p.concat(Uy(d).map(y=>y.query))),qe(m,(y,S)=>{p=p.concat(S)}),p}});for(let c=0;c<u.length;++c){let d=u[c];n.listenProvider_.stopListening($s(d),ro(n,d))}}return o}var Oh=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Fh=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ve(this.path_,e);return new n(this.syncTree_,t)}node(){return vl(this.syncTree_,this.path_)}},iC=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},H_=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return sC(n[".sv"],e,t);if(typeof n[".sv"]=="object")return oC(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},sC=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},oC=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&O(!1,"Unexpected increment value: "+r);let i=e.node();if(O(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},Ky=function(n,e,t,r){return wd(e,new Fh(t,n),r)},vd=function(n,e,t){return wd(n,new Oh(e),t)};function wd(n,e,t){let r=n.getPriority().val(),i=H_(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=H_(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new oi(a,Ie(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new oi(i))),o.forEachChild(pe,(a,u)=>{let c=wd(u,e.getImmediateChild(a),t);c!==u&&(s=s.updateImmediateChild(a,c))}),s}}var io=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function El(n,e){let t=e instanceof ue?e:new ue(e),r=n,i=Z(t);for(;i!==null;){let s=In(r.node.children,i)||{children:{},childCount:0};r=new io(i,r,s),t=fe(t),i=Z(t)}return r}function mr(n){return n.node.value}function Ed(n,e){n.node.value=e,Mh(n)}function $y(n){return n.node.childCount>0}function aC(n){return mr(n)===void 0&&!$y(n)}function Il(n,e){qe(n.node.children,(t,r)=>{e(new io(t,n,r))})}function Qy(n,e,t,r){t&&!r&&e(n),Il(n,i=>{Qy(i,e,!0,r)}),t&&r&&e(n)}function lC(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function fo(n){return new ue(n.parent===null?n.name:fo(n.parent)+"/"+n.name)}function Mh(n){n.parent!==null&&uC(n.parent,n.name,n)}function uC(n,e,t){let r=aC(t),i=_t(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,Mh(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Mh(n))}var cC=/[\[\].#$\/\u0000-\u001F\u007F]/,hC=/[\[\].#$\u0000-\u001F\u007F]/,Qc=10*1024*1024,Tl=function(n){return typeof n=="string"&&n.length!==0&&!cC.test(n)},Hy=function(n){return typeof n=="string"&&n.length!==0&&!hC.test(n)},dC=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Hy(n)},so=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!ml(n)||n&&typeof n=="object"&&_t(n,".sv")},Gt=function(n,e,t,r){r&&e===void 0||mo(at(n,"value"),e,t)},mo=function(n,e,t){let r=t instanceof ue?new ah(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+lr(r));if(typeof e=="function")throw new Error(n+"contains a function "+lr(r)+" with contents = "+e.toString());if(ml(e))throw new Error(n+"contains "+e.toString()+" "+lr(r));if(typeof e=="string"&&e.length>Qc/3&&Ns(e)>Qc)throw new Error(n+"contains a string greater than "+Qc+" utf8 bytes "+lr(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(qe(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Tl(o)))throw new Error(n+" contains an invalid key ("+o+") "+lr(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);jA(r,o),mo(n,a,r),GA(r)}),i&&s)throw new Error(n+' contains ".value" child '+lr(r)+" in addition to actual children.")}},fC=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Hs(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Tl(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(qA);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&vt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},Yy=function(n,e,t,r){if(r&&e===void 0)return;let i=at(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];qe(e,(o,a)=>{let u=new ue(o);if(mo(i,a,ve(t,u)),id(u)===".priority"&&!so(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),fC(i,s)},Id=function(n,e,t){if(!(t&&e===void 0)){if(ml(e))throw new Error(at(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!so(e))throw new Error(at(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},po=function(n,e,t,r){if(!(r&&t===void 0)&&!Tl(t))throw new Error(at(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},gi=function(n,e,t,r){if(!(r&&t===void 0)&&!Hy(t))throw new Error(at(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},mC=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),gi(n,e,t,r)},ct=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Jy=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Tl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!dC(t))throw new Error(at(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Lh=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Al(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!sd(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function Xy(n,e,t){Al(n,t),Zy(n,r=>sd(r,e))}function ht(n,e,t){Al(n,t),Zy(n,r=>vt(r,e)||vt(e,r))}function Zy(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(pC(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function pC(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();cr&&Be("event: "+t.toString()),fi(r)}}}var ev="repo_interrupt",gC=25,Uh=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Lh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ja(),this.transactionQueueTree_=new io,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function _C(n,e,t){if(n.stats_=rd(n.repoInfo_),n.forceRestClient_||_A())n.server_=new yh(n.repoInfo_,(r,i,s,o)=>{Y_(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>J_(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{xe(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new od(n.repoInfo_,e,(r,i,s,o)=>{Y_(n,r,i,s,o)},r=>{J_(n,r)},r=>{yC(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=vA(n.repoInfo_,()=>new Th(n.stats_,n.server_)),n.infoData_=new vh,n.infoSyncTree_=new ol({startListening:(r,i,s,o)=>{let a=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(a=ho(n.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Td(n,"connected",!1),n.serverSyncTree_=new ol({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,u)=>{let c=o(a,u);ht(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function tv(n){let t=n.infoData_.getNode(new ue(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function go(n){return iC({timestamp:tv(n)})}function Y_(n,e,t,r,i){n.dataUpdateCount++;let s=new ue(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let u=Ps(t,c=>Ie(c));o=XS(n.serverSyncTree_,s,u,i)}else{let u=Ie(t);o=jy(n.serverSyncTree_,s,u,i)}else if(r){let u=Ps(t,c=>Ie(c));o=HS(n.serverSyncTree_,s,u)}else{let u=Ie(t);o=ho(n.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=hi(n,s)),ht(n.eventQueue_,a,o)}function J_(n,e){Td(n,"connected",e),e===!1&&EC(n)}function yC(n,e){qe(e,(t,r)=>{Td(n,t,r)})}function Td(n,e,t){let r=new ue("/.info/"+e),i=Ie(t);n.infoData_.updateSnapshot(r,i);let s=ho(n.infoSyncTree_,r,i);ht(n.eventQueue_,r,s)}function Sl(n){return n.nextWriteId_++}function vC(n,e,t){let r=ZS(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ie(i).withIndex(e._queryParams.getIndex());Vh(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ho(n.serverSyncTree_,e._path,s);else{let a=ro(n.serverSyncTree_,e);o=jy(n.serverSyncTree_,e._path,s,a)}return ht(n.eventQueue_,e._path,o),al(n.serverSyncTree_,e,t,null,!0),s},i=>(_i(n,"get for query "+xe(e)+" failed: "+i),Promise.reject(new Error(i))))}function Ad(n,e,t,r,i){_i(n,"set",{path:e.toString(),value:t,priority:r});let s=go(n),o=Ie(t,r),a=vl(n.serverSyncTree_,e),u=vd(o,a,s),c=Sl(n),d=pd(n.serverSyncTree_,e,u,c,!0);Al(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(p,y)=>{let S=p==="ok";S||He("set at "+e+" failed: "+p);let N=Cn(n.serverSyncTree_,c,!S);ht(n.eventQueue_,e,N),kn(n,i,p,y)});let m=Cd(n,e);hi(n,m),ht(n.eventQueue_,m,[])}function wC(n,e,t,r){_i(n,"update",{path:e.toString(),value:t});let i=!0,s=go(n),o={};if(qe(t,(a,u)=>{i=!1,o[a]=Ky(ve(e,a),Ie(u),n.serverSyncTree_,s)}),i)Be("update() called with empty data.  Don't do anything."),kn(n,r,"ok",void 0);else{let a=Sl(n),u=QS(n.serverSyncTree_,e,o,a);Al(n.eventQueue_,u),n.server_.merge(e.toString(),t,(c,d)=>{let m=c==="ok";m||He("update at "+e+" failed: "+c);let p=Cn(n.serverSyncTree_,a,!m),y=p.length>0?hi(n,e):e;ht(n.eventQueue_,y,p),kn(n,r,c,d)}),qe(t,c=>{let d=Cd(n,ve(e,c));hi(n,d)}),ht(n.eventQueue_,e,[])}}function EC(n){_i(n,"onDisconnectEvents");let e=go(n),t=Ja();Eh(n.onDisconnect_,le(),(i,s)=>{let o=Ky(i,s,n.serverSyncTree_,e);mi(t,i,o)});let r=[];Eh(t,le(),(i,s)=>{r=r.concat(ho(n.serverSyncTree_,i,s));let o=Cd(n,i);hi(n,o)}),n.onDisconnect_=Ja(),ht(n.eventQueue_,le(),r)}function IC(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&wh(n.onDisconnect_,e),kn(n,t,r,i)})}function X_(n,e,t,r){let i=Ie(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&mi(n.onDisconnect_,e,i),kn(n,r,s,o)})}function TC(n,e,t,r,i){let s=Ie(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&mi(n.onDisconnect_,e,s),kn(n,i,o,a)})}function AC(n,e,t,r){if(Fa(t)){Be("onDisconnect().update() called with empty data.  Don't do anything."),kn(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&qe(t,(o,a)=>{let u=Ie(a);mi(n.onDisconnect_,ve(e,o),u)}),kn(n,r,i,s)})}function SC(n,e,t){let r;Z(e._path)===".info"?r=Vh(n.infoSyncTree_,e,t):r=Vh(n.serverSyncTree_,e,t),Xy(n.eventQueue_,e._path,r)}function Bh(n,e,t){let r;Z(e._path)===".info"?r=al(n.infoSyncTree_,e,t):r=al(n.serverSyncTree_,e,t),Xy(n.eventQueue_,e._path,r)}function nv(n){n.persistentConnection_&&n.persistentConnection_.interrupt(ev)}function CC(n){n.persistentConnection_&&n.persistentConnection_.resume(ev)}function _i(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Be(t,...e)}function kn(n,e,t,r){e&&fi(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function bC(n,e,t,r,i,s){_i(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:ty(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Sd(n,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{mo("transaction failed: Data returned ",u,o.path),o.status=0;let c=El(n.transactionQueueTree_,e),d=mr(c)||[];d.push(o),Ed(c,d);let m;typeof u=="object"&&u!==null&&_t(u,".priority")?(m=In(u,".priority"),O(so(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):m=(vl(n.serverSyncTree_,e)||J.EMPTY_NODE).getPriority().val();let p=go(n),y=Ie(u,m),S=vd(y,a,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=S,o.currentWriteId=Sl(n);let N=pd(n.serverSyncTree_,e,S,o.currentWriteId,o.applyLocally);ht(n.eventQueue_,e,N),Cl(n,n.transactionQueueTree_)}}function Sd(n,e,t){return vl(n.serverSyncTree_,e,t)||J.EMPTY_NODE}function Cl(n,e=n.transactionQueueTree_){if(e||bl(n,e),mr(e)){let t=iv(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&RC(n,fo(e),t)}else $y(e)&&Il(e,t=>{Cl(n,t)})}function RC(n,e,t){let r=t.map(c=>c.currentWriteId),i=Sd(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let d=t[c];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let m=tt(e,d.path);s=s.updateChild(m,d.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;n.server_.put(u.toString(),a,c=>{_i(n,"transaction put response",{path:u.toString(),status:c});let d=[];if(c==="ok"){let m=[];for(let p=0;p<t.length;p++)t[p].status=2,d=d.concat(Cn(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&m.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();bl(n,El(n.transactionQueueTree_,e)),Cl(n,n.transactionQueueTree_),ht(n.eventQueue_,e,d);for(let p=0;p<m.length;p++)fi(m[p])}else{if(c==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{He("transaction at "+u.toString()+" failed: "+c);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=c}hi(n,e)}},o)}function hi(n,e){let t=rv(n,e),r=fo(t),i=iv(n,t);return PC(n,i,r),r}function PC(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=tt(t,u.path),d=!1,m;if(O(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)d=!0,m=u.abortReason,i=i.concat(Cn(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=gC)d=!0,m="maxretry",i=i.concat(Cn(n.serverSyncTree_,u.currentWriteId,!0));else{let p=Sd(n,u.path,o);u.currentInputSnapshot=p;let y=e[a].update(p.val());if(y!==void 0){mo("transaction failed: Data returned ",y,u.path);let S=Ie(y);typeof y=="object"&&y!=null&&_t(y,".priority")||(S=S.updatePriority(p.getPriority()));let x=u.currentWriteId,q=go(n),j=vd(S,p,q);u.currentOutputSnapshotRaw=S,u.currentOutputSnapshotResolved=j,u.currentWriteId=Sl(n),o.splice(o.indexOf(x),1),i=i.concat(pd(n.serverSyncTree_,u.path,j,u.currentWriteId,u.applyLocally)),i=i.concat(Cn(n.serverSyncTree_,x,!0))}else d=!0,m="nodata",i=i.concat(Cn(n.serverSyncTree_,u.currentWriteId,!0))}ht(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(m==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(m),!1,null))))}bl(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)fi(r[a]);Cl(n,n.transactionQueueTree_)}function rv(n,e){let t,r=n.transactionQueueTree_;for(t=Z(e);t!==null&&mr(r)===void 0;)r=El(r,t),e=fe(e),t=Z(e);return r}function iv(n,e){let t=[];return sv(n,e,t),t.sort((r,i)=>r.order-i.order),t}function sv(n,e,t){let r=mr(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Il(e,i=>{sv(n,i,t)})}function bl(n,e){let t=mr(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Ed(e,t.length>0?t:void 0)}Il(e,r=>{bl(n,r)})}function Cd(n,e){let t=fo(rv(n,e)),r=El(n.transactionQueueTree_,e);return lC(r,i=>{Hc(n,i)}),Hc(n,r),Qy(r,i=>{Hc(n,i)}),t}function Hc(n,e){let t=mr(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Cn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Ed(e,void 0):t.length=s+1,ht(n.eventQueue_,fo(e),i);for(let o=0;o<r.length;o++)fi(r[o])}}function NC(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function xC(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):He(`Invalid query segment '${t}' in query '${n}'`)}return e}var qh=function(n,e){let t=kC(n),r=t.namespace;t.domain==="firebase.com"&&qt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&qt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||lA();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ga(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new ue(t.pathString)}},kC=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",u=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let m=n.indexOf("?");m===-1&&(m=n.length),e=n.substring(0,Math.min(d,m)),d<m&&(i=NC(n.substring(d,m)));let p=xC(n.substring(Math.min(n.length,m)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let y=e.slice(0,c);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let S=e.indexOf(".");r=e.substring(0,S).toLowerCase(),t=e.substring(S+1),s=r}"ns"in p&&(s=p.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var Z_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",DC=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=Z_.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Z_.charAt(e[i]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var ll=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+xe(this.snapshot.exportVal())}},ul=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var oo=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var cl=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new et;return IC(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ct("OnDisconnect.remove",this._path);let e=new et;return X_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ct("OnDisconnect.set",this._path),Gt("OnDisconnect.set",e,this._path,!1);let t=new et;return X_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ct("OnDisconnect.setWithPriority",this._path),Gt("OnDisconnect.setWithPriority",e,this._path,!1),Id("OnDisconnect.setWithPriority",t,!1);let r=new et;return TC(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){ct("OnDisconnect.update",this._path),Yy("OnDisconnect.update",e,this._path,!1);let t=new et;return AC(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var rt=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ee(this._path)?null:id(this._path)}get ref(){return new dt(this._repo,this._path)}get _queryIdentifier(){let e=U_(this._queryParams),t=nd(e);return t==="{}"?"default":t}get _queryObject(){return U_(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=sd(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+BA(this._path)}};function Rl(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Vn(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Bt){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Pn)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==sn)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===pe){if(e!=null&&!so(e)||t!=null&&!so(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof Ys||n.getIndex()===ld,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Pl(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var dt=class n extends rt{constructor(e,t){super(e,t,new eo,!1)}get parent(){let e=Iy(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},di=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ue(e),r=Dn(this.ref,e);return new n(this._node.getChild(t),r,pe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,Dn(this.ref,r),pe)))}hasChild(e){let t=new ue(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function bd(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?Dn(n._root,e):n._root}function Rd(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=qh(e,n._repo.repoInfo_.nodeAdmin);Jy("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&qt("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),bd(n,t.path.toString())}function Dn(n,e){return n=ne(n),Z(n._path)===null?mC("child","path",e,!1):gi("child","path",e,!1),new dt(n._repo,ve(n._path,e))}function ov(n,e){n=ne(n),ct("push",n._path),Gt("push",e,n._path,!0);let t=tv(n._repo),r=DC(t),i=Dn(n,r),s=Dn(n,r),o;return e!=null?o=Nl(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function av(n){return ct("remove",n._path),Nl(n,null)}function Nl(n,e){n=ne(n),ct("set",n._path),Gt("set",e,n._path,!1);let t=new et;return Ad(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function lv(n,e){n=ne(n),ct("setPriority",n._path),Id("setPriority",e,!1);let t=new et;return Ad(n._repo,ve(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function uv(n,e,t){if(ct("setWithPriority",n._path),Gt("setWithPriority",e,n._path,!1),Id("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new et;return Ad(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function cv(n,e){Yy("update",e,n._path,!1);let t=new et;return wC(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function hv(n){n=ne(n);let e=new oo(()=>{}),t=new ao(e);return vC(n._repo,n,t).then(r=>new di(r,new dt(n._repo,n._path),n._queryParams.getIndex()))}var ao=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new ll("value",this,new di(e.snapshotNode,new dt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ul(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},hl=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ul(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let r=Dn(new dt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new ll(e.type,this,new di(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function _o(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=t,c=(d,m)=>{Bh(n._repo,n,a),u(d,m)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new oo(t,s||void 0),a=e==="value"?new ao(o):new hl(e,o);return SC(n._repo,n,a),()=>Bh(n._repo,n,a)}function xl(n,e,t,r){return _o(n,"value",e,t,r)}function Pd(n,e,t,r){return _o(n,"child_added",e,t,r)}function Nd(n,e,t,r){return _o(n,"child_changed",e,t,r)}function xd(n,e,t,r){return _o(n,"child_moved",e,t,r)}function kd(n,e,t,r){return _o(n,"child_removed",e,t,r)}function Dd(n,e,t){let r=null,i=t?new oo(t):null;e==="value"?r=new ao(i):e&&(r=new hl(e,i)),Bh(n._repo,n,r)}var ft=class{},dl=class extends ft{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Gt("endAt",this._value,e._path,!0);let t=_h(e._queryParams,this._value,this._key);if(Pl(t),Vn(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rt(e._repo,e._path,t,e._orderByCalled)}};function dv(n,e){return po("endAt","key",e,!0),new dl(n,e)}var jh=class extends ft{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Gt("endBefore",this._value,e._path,!1);let t=sS(e._queryParams,this._value,this._key);if(Pl(t),Vn(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rt(e._repo,e._path,t,e._orderByCalled)}};function fv(n,e){return po("endBefore","key",e,!0),new jh(n,e)}var fl=class extends ft{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Gt("startAt",this._value,e._path,!0);let t=gh(e._queryParams,this._value,this._key);if(Pl(t),Vn(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new rt(e._repo,e._path,t,e._orderByCalled)}};function mv(n=null,e){return po("startAt","key",e,!0),new fl(n,e)}var Gh=class extends ft{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Gt("startAfter",this._value,e._path,!1);let t=iS(e._queryParams,this._value,this._key);if(Pl(t),Vn(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new rt(e._repo,e._path,t,e._orderByCalled)}};function pv(n,e){return po("startAfter","key",e,!0),new Gh(n,e)}var Wh=class extends ft{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new rt(e._repo,e._path,nS(e._queryParams,this._limit),e._orderByCalled)}};function gv(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Wh(n)}var zh=class extends ft{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new rt(e._repo,e._path,rS(e._queryParams,this._limit),e._orderByCalled)}};function _v(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new zh(n)}var Kh=class extends ft{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Rl(e,"orderByChild");let t=new ue(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Ys(t),i=pl(e._queryParams,r);return Vn(i),new rt(e._repo,e._path,i,!0)}};function yv(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return gi("orderByChild","path",n,!1),new Kh(n)}var $h=class extends ft{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Rl(e,"orderByKey");let t=pl(e._queryParams,Bt);return Vn(t),new rt(e._repo,e._path,t,!0)}};function vv(){return new $h}var Qh=class extends ft{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Rl(e,"orderByPriority");let t=pl(e._queryParams,pe);return Vn(t),new rt(e._repo,e._path,t,!0)}};function wv(){return new Qh}var Hh=class extends ft{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Rl(e,"orderByValue");let t=pl(e._queryParams,ld);return Vn(t),new rt(e._repo,e._path,t,!0)}};function Ev(){return new Hh}var Yh=class extends ft{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Gt("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new dl(this._value,this._key)._apply(new fl(this._value,this._key)._apply(e))}};function Iv(n,e){return po("equalTo","key",e,!0),new Yh(n,e)}function Et(n,...e){let t=ne(n);for(let r of e)t=r._apply(t);return t}BS(dt);zS(dt);var VC="FIREBASE_DATABASE_EMULATOR_HOST",Jh={},OC=!1;function FC(n,e,t,r){n.repoInfo_=new Ga(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function Vd(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||qt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Be("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=qh(s,i),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[VC]),c?(u=!0,s=`http://${c}?ns=${a.namespace}`,o=qh(s,i),a=o.repoInfo):u=!o.repoInfo.secure;let d=i&&u?new Ws(Ws.OWNER):new th(n.name,n.options,e);Jy("Invalid Firebase Database URL",o),ee(o.path)||qt("Database URL must point to the root of a Firebase Database (not including a child path).");let m=LC(a,n,d,new eh(n.name,t));return new Xh(m,n)}function MC(n,e){let t=Jh[e];(!t||t[n.key]!==n)&&qt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),nv(n),delete t[n.key]}function LC(n,e,t,r){let i=Jh[e.name];i||(i={},Jh[e.name]=i);let s=i[n.toURLString()];return s&&qt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Uh(n,OC,t,r),i[n.toURLString()]=s,s}var Xh=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(_C(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new dt(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&(MC(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&qt("Cannot call "+e+" on a deleted database.")}};function Tv(){Ey.IS_TRANSPORT_INITIALIZED&&He("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Av(){Tv(),Qs.forceDisallow()}function Sv(){Tv(),ni.forceDisallow(),Qs.forceAllow()}function Cv(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&qt("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&qt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ws(Ws.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Va(r.mockUserToken,n.app.options.projectId);s=new Ws(o)}FC(i,e,t,s)}function bv(n){n=ne(n),n._checkNotDeleted("goOffline"),nv(n._repo)}function Rv(n){n=ne(n),n._checkNotDeleted("goOnline"),CC(n._repo)}function Pv(n,e){ry(n,e)}function UC(n){td(Ua),La(new Mt("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Vd(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Tn(I_,T_,n),Tn(I_,T_,"esm2017")}var BC={".sv":"timestamp"};function Nv(){return BC}function xv(n){return{".sv":{increment:n}}}var Zh=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function kv(n,e,t){var r;if(n=ne(n),ct("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new et,o=(u,c,d)=>{let m=null;u?s.reject(u):(m=new di(d,new dt(n._repo,n._path),pe),s.resolve(new Zh(c,m)))},a=xl(n,()=>{});return bC(n._repo,n._path,e,o,a,i),s.promise}od.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};od.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};UC();var qC="@firebase/database-compat",jC="1.0.7";var GC=new Hr("@firebase/database-compat"),Dv=function(n){let e="FIREBASE WARNING: "+n;GC.warn(e)};var WC=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(at(n,e)+"must be a boolean.")},zC=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(at(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Od=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Me("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Me("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Me("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("OnDisconnect.setWithPriority",2,3,arguments.length),Me("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Dv("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Me("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var Fd=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var pr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),gi("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),gi("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Me("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new on(this._database,this._delegate.ref)}get ref(){return this.getRef()}},kl=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;$("Query.on",2,4,arguments.length),Me("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,d)=>{t.call(o.context,new pr(this.database,c),d)};a.userCallback=t,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return xl(this._delegate,a,u),t;case"child_added":return Pd(this._delegate,a,u),t;case"child_removed":return kd(this._delegate,a,u),t;case"child_changed":return Nd(this._delegate,a,u),t;case"child_moved":return xd(this._delegate,a,u),t;default:throw new Error(at("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if($("Query.off",0,3,arguments.length),zC("Query.off",e,!0),Me("Query.off","callback",t,!0),Oc("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,Dd(this._delegate,e,i)}else Dd(this._delegate,e)}get(){return hv(this._delegate).then(e=>new pr(this.database,e))}once(e,t,r,i){$("Query.once",1,4,arguments.length),Me("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new et,a=(c,d)=>{let m=new pr(this.database,c);t&&t.call(s.context,m,d),o.resolve(m)};a.userCallback=t,a.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":xl(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":Pd(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":kd(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":Nd(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":xd(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(at("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,Et(this._delegate,gv(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,Et(this._delegate,_v(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,Et(this._delegate,yv(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,Et(this._delegate,vv()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,Et(this._delegate,wv()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,Et(this._delegate,Ev()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,Et(this._delegate,mv(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,Et(this._delegate,pv(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,Et(this._delegate,dv(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,Et(this._delegate,fv(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,Et(this._delegate,Iv(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Me(e,"cancel",i.cancel,!0),i.context=r,Oc(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(at(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new on(this.database,new dt(this._delegate._repo,this._delegate._path))}},on=class n extends kl{constructor(e,t){super(e,new rt(t._repo,t._path,new eo,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Dn(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Me("Reference.set","onComplete",t,!0);let r=Nl(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Dv("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("Reference.update",this._delegate._path),Me("Reference.update","onComplete",t,!0);let r=cv(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("Reference.setWithPriority",2,3,arguments.length),Me("Reference.setWithPriority","onComplete",r,!0);let i=uv(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){$("Reference.remove",0,1,arguments.length),Me("Reference.remove","onComplete",e,!0);let t=av(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){$("Reference.transaction",1,3,arguments.length),Me("Reference.transaction","transactionUpdate",e,!1),Me("Reference.transaction","onComplete",t,!0),WC("Reference.transaction","applyLocally",r,!0);let i=kv(this._delegate,e,{applyLocally:r}).then(s=>new Fd(s.committed,new pr(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Me("Reference.setPriority","onComplete",t,!0);let r=lv(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){$("Reference.push",0,2,arguments.length),Me("Reference.push","onComplete",t,!0);let r=ov(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return ct("Reference.onDisconnect",this._delegate._path),new Od(new cl(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var gr=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Av,forceLongPolling:Sv}}useEmulator(e,t,r={}){Cv(this._delegate,e,t,r)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof on){let t=Rd(this._delegate,e.toString());return new on(this,t)}else{let t=bd(this._delegate,e);return new on(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let r=Rd(this._delegate,e);return new on(this,r)}goOffline(){return $("database.goOffline",0,0,arguments.length),bv(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),Rv(this._delegate)}};gr.ServerValue={TIMESTAMP:Nv(),increment:n=>xv(n)};function KC({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){td(t);let a=new Fc("database-standalone"),u=new Ma("auth-internal",a);u.setComponent(new Mt("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new Ma("app-check-internal",a),c.setComponent(new Mt("app-check-internal",()=>i,"PRIVATE"))),{instance:new gr(Vd(n,u,c,e,o),n),namespace:s}}var $C=Object.freeze({__proto__:null,initStandalone:KC});var QC=gr.ServerValue;function HC(n){n.INTERNAL.registerComponent(new Mt("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new gr(i,r)},"PUBLIC").setServiceProps({Reference:on,Query:kl,Database:gr,DataSnapshot:pr,enableLogging:Pv,INTERNAL:$C,ServerValue:QC}).setMultipleInstances(!0)),n.registerVersion(qC,jC)}HC(Lt);function yo(n,e,t="on",r=Ca){return new sr(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(he(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),Jg())}function YC(n){return typeof n=="string"}function JC(n){return typeof n.exportVal=="function"}function Lv(n){return n==null}function Uv(n){return typeof n.set=="function"}function Vv(n,e){return Uv(e)?e:n.ref(e)}function Bv(n,e){if(YC(n))return e.stringCase();if(Uv(n))return e.firebaseCase();if(JC(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function qv(n){return(Lv(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function jv(n,e,t){e=qv(e);let r=e.map(i=>yo(n,i,"on",t));return Cs(...r)}function XC(n,e,t){let r=jv(n,e).pipe(ar((i,s)=>[...i,s],[]));return e0(n,r,t)}function ZC(n,e){return yo(n,"value","on",e).pipe(he(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function e0(n,e,t){return ZC(n,t).pipe(Zg(e),he(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Xg(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),he(i=>i.actions))}function Ov(n,e){return function(r,i){return Bv(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function t0(n){return function(t){return t?Bv(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function n0(n,e,t){return yo(n,"value","once",t).pipe(rn(r=>{let i=[Vt(r)];return e.forEach(s=>i.push(yo(n,s,"on",t))),Cs(...i).pipe(ar(i0,[]))}),Ra())}function Gv(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function r0(n,e){if(Lv(e))return 0;{let t=Gv(n,e);return t===-1?n.length:t+1}}function i0(n,e){let{payload:t,prevKey:r,key:i}=e,s=Gv(n,i),o=r0(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(u=>u.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Fv(n,e,t){return e=qv(e),n0(n,e,t)}function s0(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Ov(r,"update"),set:Ov(r,"set"),push:i=>r.push(i),remove:t0(r),snapshotChanges(i){return Fv(n,i,t).pipe(Ce)},stateChanges(i){return jv(n,i,t).pipe(Ce)},auditTrail(i){return XC(n,i,t).pipe(Ce)},valueChanges(i,s){return Fv(n,i,t).pipe(he(a=>a.map(u=>s&&s.idField?As(Dt({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),Ce)}}}function Mv(n,e){return function(){return yo(n,"value","on",e)}}function o0(n,e){return{query:n,snapshotChanges(){return Mv(n,e.schedulers.outsideAngular)().pipe(Ce)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Mv(n,e.schedulers.outsideAngular)().pipe(Ce,he(r=>r.payload.exists()?r.payload.val():null))}}}var a0=new Ge("angularfire2.realtimeDatabaseURL"),l0=new Ge("angularfire2.database.use-emulator"),Wv=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,u,c,d,m,p,y,S,N,x){this.schedulers=a;let q=u,j=Xr(t,o,r);c&&Ls(j,o,d,p,y,S,m,N),this.database=Zr(`${j.name}.database.${i}`,"AngularFireDatabase",j.name,()=>{let F=o.runOutsideAngular(()=>j.database(i||void 0));return q&&F.useEmulator(...q),F},[q])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>Vv(this.database,t)),s=i;return r&&(s=r(i)),s0(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>Vv(this.database,t));return o0(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(z(Yr),z(Jr,8),z(a0,8),z($r),z(En),z(Sn),z(l0,8),z(ei,8),z(ks,8),z(Ds,8),z(Vs,8),z(Os,8),z(Fs,8),z(Ms,8),z(An,8))};static \u0275prov=Ot({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var zv=(()=>{let e=class e{constructor(r){this.db=r,this.loadingSubject=new or(!0),this.loading$=this.loadingSubject.asObservable(),this.modeSubject=new or("addMode"),this.mode$=this.modeSubject.asObservable(),this.formValueSubject=new or({}),this.formValue$=this.formValueSubject.asObservable(),this.totalRowsSubject=new or(0),this.totalRows$=this.totalRowsSubject.asObservable()}getItemsRef(r){return this.db.list(r)}getItemRef(r,i){return this.db.object(`${r}/${i}`)}createItem(r,i){return this.getItemsRef(r).push(i)}getItemsList(r){return this.getItemsRef(r).snapshotChanges().pipe(he(s=>{let o=s.map(a=>Dt({id:a.payload.key},a.payload.val()));return this.totalRowsSubject.next(o.length),this.loadingSubject.next(!1),o}))}getItem(r,i){return this.getItemRef(r,i).valueChanges()}getItemBy_(r,i,s){return this.db.list(s,o=>o.orderByChild(i).equalTo(r)).snapshotChanges().pipe(he(o=>o.map(a=>Dt({key:a.payload.key},a.payload.val()))))}updateItem(r,i,s){return this.getItemsRef(r).update(i,s)}deleteItem(r,i){return this.getItemsRef(r).remove(i)}deleteAll(r){return this.getItemsRef(r).remove()}getItemsByDateRange(r,i,s,o){return this.db.list(o,a=>a.orderByChild(r).startAt(i.toISOString()).endAt(s.toISOString())).snapshotChanges().pipe(he(a=>a.map(u=>Dt({key:u.payload.key},u.payload.val()))))}};e.\u0275fac=function(i){return new(i||e)(z(Wv))},e.\u0275prov=Ot({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Kv="auth",vo=class{constructor(e){return e}},Md=class{constructor(){return m_(Kv)}};var Ld=new Ge("angularfire2.auth-instances");function ub(n,e){let t=f_(Kv,n,e);return t&&new vo(t)}function cb(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new vo(r)}}var hb={provide:Md,deps:[[new xa,Ld]]},db={provide:vo,useFactory:ub,deps:[[new xa,Ld],p_]};function nx(n,...e){return Tn("angularfire",xs.full,"auth"),e_([db,hb,{provide:Ld,useFactory:cb(n),multi:!0,deps:[En,t_,Sn,g_,[new xa,An],...e]}])}var rx=qc(Bc,!0);var $v=qc(Uc,!0);var Qv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Hv={};var On,Ud;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(I,T,C){for(var v=Array(arguments.length-2),en=2;en<arguments.length;en++)v[en-2]=arguments[en];return _.prototype[T].apply(I,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);var I=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)I[T]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],T=E.g[2];var C=E.g[3],v=_+(C^w&(T^C))+I[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[1]+3905402710&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[2]+606105819&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[3]+3250441966&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[5]+1200080426&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[6]+2821735955&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[7]+4249261313&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[9]+2336552879&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[10]+4294925233&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[11]+2304563134&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[13]+4254626195&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[14]+2792965006&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[15]+1236535329&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(T^C&(w^T))+I[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[6]+3225465664&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[11]+643717713&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[0]+3921069994&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[10]+38016083&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[15]+3634488961&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[4]+3889429448&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[14]+3275163606&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[3]+4107603335&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[8]+1163531501&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[2]+4243563512&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[7]+1735328473&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[12]+2368359562&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(w^T^C)+I[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[8]+2272392833&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[11]+1839030562&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[14]+4259657740&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[4]+1272893353&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[7]+4139469664&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[10]+3200236656&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[0]+3936430074&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[3]+3572445317&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[6]+76029189&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[12]+3873151461&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[15]+530742520&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[2]+3299628645&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(T^(w|~C))+I[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[7]+1126891415&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[14]+2878612391&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[5]+4237533241&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[3]+2399980690&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[10]+4293915773&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[1]+2240044497&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[15]+4264355552&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[6]+2734768916&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[13]+1309151649&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[11]+3174756917&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[2]+718787259&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+C&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,I=this.B,T=this.h,C=0;C<_;){if(T==0)for(;C<=w;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(I[T++]=E.charCodeAt(C++),T==this.blockSize){i(this,I),T=0;break}}else for(;C<_;)if(I[T++]=E[C++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var I=0;32>I;I+=8)E[w++]=this.g[_]>>>I&255;return E};function s(E,_){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],I=!0,T=E.length-1;0<=T;T--){var C=E[T]|0;I&&C==_||(w[T]=C,I=!1)}this.g=w}var a={};function u(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return m;if(0>E)return x(c(-E));for(var _=[],w=1,I=0;E>=w;I++)_[I]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return x(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(_,8)),I=m,T=0;T<E.length;T+=8){var C=Math.min(8,E.length-T),v=parseInt(E.substring(T,T+C),_);8>C?(C=c(Math.pow(_,C)),I=I.j(C).add(c(v))):(I=I.j(w),I=I.add(c(v)))}return I}var m=u(0),p=u(1),y=u(16777216);n=o.prototype,n.m=function(){if(N(this))return-x(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var I=this.i(w);E+=(0<=I?I:4294967296+I)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(N(this))return"-"+x(this).toString(E);for(var _=c(Math.pow(E,6)),w=this,I="";;){var T=K(w,_).g;w=q(w,T.j(_));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=T,S(w))return C+I;for(;6>C.length;)C="0"+C;I=C+I}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function N(E){return E.h==-1}n.l=function(E){return E=q(this,E),N(E)?-1:S(E)?0:1};function x(E){for(var _=E.g.length,w=[],I=0;I<_;I++)w[I]=~E.g[I];return new o(w,~E.h).add(p)}n.abs=function(){return N(this)?x(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0,T=0;T<=_;T++){var C=I+(this.i(T)&65535)+(E.i(T)&65535),v=(C>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);I=v>>>16,C&=65535,v&=65535,w[T]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(E,_){return E.add(x(_))}n.j=function(E){if(S(this)||S(E))return m;if(N(this))return N(E)?x(this).j(x(E)):x(x(this).j(E));if(N(E))return x(this.j(x(E)));if(0>this.l(y)&&0>E.l(y))return c(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],I=0;I<2*_;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<E.g.length;T++){var C=this.i(I)>>>16,v=this.i(I)&65535,en=E.i(T)>>>16,ss=E.i(T)&65535;w[2*I+2*T]+=v*ss,j(w,2*I+2*T),w[2*I+2*T+1]+=C*ss,j(w,2*I+2*T+1),w[2*I+2*T+1]+=v*en,j(w,2*I+2*T+1),w[2*I+2*T+2]+=C*en,j(w,2*I+2*T+2)}for(I=0;I<_;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=_;I<2*_;I++)w[I]=0;return new o(w,0)};function j(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function F(E,_){this.g=E,this.h=_}function K(E,_){if(S(_))throw Error("division by zero");if(S(E))return new F(m,m);if(N(E))return _=K(x(E),_),new F(x(_.g),x(_.h));if(N(_))return _=K(E,x(_)),new F(x(_.g),_.h);if(30<E.g.length){if(N(E)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var w=p,I=_;0>=I.l(E);)w=H(w),I=H(I);var T=Y(w,1),C=Y(I,1);for(I=Y(I,2),w=Y(w,2);!S(I);){var v=C.add(I);0>=v.l(E)&&(T=T.add(w),C=v),I=Y(I,1),w=Y(w,1)}return _=q(E,T.j(_)),new F(T,_)}for(T=m;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),C=c(w),v=C.j(_);N(v)||0<v.l(E);)w-=I,C=c(w),v=C.j(_);S(C)&&(C=p),T=T.add(C),E=q(E,v)}return new F(T,E)}n.A=function(E){return K(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)&E.i(I);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)|E.i(I);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)^E.i(I);return new o(w,this.h^E.h)};function H(E){for(var _=E.g.length+1,w=[],I=0;I<_;I++)w[I]=E.i(I)<<1|E.i(I-1)>>>31;return new o(w,E.h)}function Y(E,_){var w=_>>5;_%=32;for(var I=E.g.length-w,T=[],C=0;C<I;C++)T[C]=0<_?E.i(C+w)>>>_|E.i(C+w+1)<<32-_:E.i(C+w);return new o(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ud=Hv.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,On=Hv.Integer=o}).apply(typeof Qv<"u"?Qv:typeof self<"u"?self:typeof window<"u"?window:{});var Dl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},an={};var Bd,qd,yi,jd,wo,Vl,Gd,Wd,zd;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Dl=="object"&&Dl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(l,h){if(h)e:{var f=r;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in f))break e;f=f[A]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,A={next:function(){if(!g&&f<l.length){var P=f++;return{value:h(P,l[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function c(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function m(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function p(l,h,f){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:m,p.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function S(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,A,P){for(var M=Array(arguments.length-2),de=2;de<arguments.length;de++)M[de-2]=arguments[de];return h.prototype[A].apply(g,M)}}function N(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function x(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(u(g)){let A=l.length||0,P=g.length||0;l.length=A+P;for(let M=0;M<P;M++)l[A+M]=g[M]}else l.push(g)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function F(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function K(l){return K[" "](l),l}K[" "]=function(){};var H=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function Y(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function E(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(l,h){let f,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(f in g)l[f]=g[f];for(let P=0;P<w.length;P++)f=w[P],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function T(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function C(l){a.setTimeout(()=>{throw l},0)}function v(){var l=rc;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class en{constructor(){this.h=this.g=null}add(h,f){let g=ss.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var ss=new q(()=>new RT,l=>l.reset());class RT{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let os,as=!1,rc=new en,Qp=()=>{let l=a.Promise.resolve(void 0);os=()=>{l.then(PT)}};var PT=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){C(f)}var h=ss;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}as=!1};function _n(){this.s=this.s,this.C=this.C}_n.prototype.s=!1,_n.prototype.ma=function(){this.s||(this.s=!0,this.N())},_n.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ze(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var NT=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function ls(l,h){if(ze.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(H){e:{try{K(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:xT[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&ls.aa.h.call(this)}}S(ls,ze);var xT={2:"touch",3:"pen",4:"mouse"};ls.prototype.h=function(){ls.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var us="closure_listenable_"+(1e6*Math.random()|0),kT=0;function DT(l,h,f,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=A,this.key=++kT,this.da=this.fa=!1}function ua(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ca(l){this.src=l,this.g={},this.h=0}ca.prototype.add=function(l,h,f,g,A){var P=l.toString();l=this.g[P],l||(l=this.g[P]=[],this.h++);var M=sc(l,h,g,A);return-1<M?(h=l[M],f||(h.fa=!1)):(h=new DT(h,this.src,P,!!g,A),h.fa=f,l.push(h)),h};function ic(l,h){var f=h.type;if(f in l.g){var g=l.g[f],A=Array.prototype.indexOf.call(g,h,void 0),P;(P=0<=A)&&Array.prototype.splice.call(g,A,1),P&&(ua(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function sc(l,h,f,g){for(var A=0;A<l.length;++A){var P=l[A];if(!P.da&&P.listener==h&&P.capture==!!f&&P.ha==g)return A}return-1}var oc="closure_lm_"+(1e6*Math.random()|0),ac={};function Hp(l,h,f,g,A){if(g&&g.once)return Jp(l,h,f,g,A);if(Array.isArray(h)){for(var P=0;P<h.length;P++)Hp(l,h[P],f,g,A);return null}return f=hc(f),l&&l[us]?l.K(h,f,c(g)?!!g.capture:!!g,A):Yp(l,h,f,!1,g,A)}function Yp(l,h,f,g,A,P){if(!h)throw Error("Invalid event type");var M=c(A)?!!A.capture:!!A,de=uc(l);if(de||(l[oc]=de=new ca(l)),f=de.add(h,f,g,M,P),f.proxy)return f;if(g=VT(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)NT||(A=M),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(Zp(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function VT(){function l(f){return h.call(l.src,l.listener,f)}let h=OT;return l}function Jp(l,h,f,g,A){if(Array.isArray(h)){for(var P=0;P<h.length;P++)Jp(l,h[P],f,g,A);return null}return f=hc(f),l&&l[us]?l.L(h,f,c(g)?!!g.capture:!!g,A):Yp(l,h,f,!0,g,A)}function Xp(l,h,f,g,A){if(Array.isArray(h))for(var P=0;P<h.length;P++)Xp(l,h[P],f,g,A);else g=c(g)?!!g.capture:!!g,f=hc(f),l&&l[us]?(l=l.i,h=String(h).toString(),h in l.g&&(P=l.g[h],f=sc(P,f,g,A),-1<f&&(ua(P[f]),Array.prototype.splice.call(P,f,1),P.length==0&&(delete l.g[h],l.h--)))):l&&(l=uc(l))&&(h=l.g[h.toString()],l=-1,h&&(l=sc(h,f,g,A)),(f=-1<l?h[l]:null)&&lc(f))}function lc(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[us])ic(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(Zp(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=uc(h))?(ic(f,l),f.h==0&&(f.src=null,h[oc]=null)):ua(l)}}}function Zp(l){return l in ac?ac[l]:ac[l]="on"+l}function OT(l,h){if(l.da)l=!0;else{h=new ls(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&lc(l),l=f.call(g,h)}return l}function uc(l){return l=l[oc],l instanceof ca?l:null}var cc="__closure_events_fn_"+(1e9*Math.random()>>>0);function hc(l){return typeof l=="function"?l:(l[cc]||(l[cc]=function(h){return l.handleEvent(h)}),l[cc])}function Ke(){_n.call(this),this.i=new ca(this),this.M=this,this.F=null}S(Ke,_n),Ke.prototype[us]=!0,Ke.prototype.removeEventListener=function(l,h,f,g){Xp(this,l,h,f,g)};function Xe(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new ze(h,l);else if(h instanceof ze)h.target=h.target||l;else{var A=h;h=new ze(g,l),I(h,A)}if(A=!0,f)for(var P=f.length-1;0<=P;P--){var M=h.g=f[P];A=ha(M,g,!0,h)&&A}if(M=h.g=l,A=ha(M,g,!0,h)&&A,A=ha(M,g,!1,h)&&A,f)for(P=0;P<f.length;P++)M=h.g=f[P],A=ha(M,g,!1,h)&&A}Ke.prototype.N=function(){if(Ke.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)ua(f[g]);delete l.g[h],l.h--}}this.F=null},Ke.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},Ke.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function ha(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,P=0;P<h.length;++P){var M=h[P];if(M&&!M.da&&M.capture==f){var de=M.listener,je=M.ha||M.src;M.fa&&ic(l.i,M),A=de.call(je,g)!==!1&&A}}return A&&!g.defaultPrevented}function eg(l,h,f){if(typeof l=="function")f&&(l=p(l,f));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function tg(l){l.g=eg(()=>{l.g=null,l.i&&(l.i=!1,tg(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class FT extends _n{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:tg(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cs(l){_n.call(this),this.h=l,this.g={}}S(cs,_n);var ng=[];function rg(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&lc(h)},l),l.g={}}cs.prototype.N=function(){cs.aa.N.call(this),rg(this)},cs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dc=a.JSON.stringify,MT=a.JSON.parse,LT=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function fc(){}fc.prototype.h=null;function ig(l){return l.h||(l.h=l.i())}function sg(){}var hs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function mc(){ze.call(this,"d")}S(mc,ze);function pc(){ze.call(this,"c")}S(pc,ze);var tr={},og=null;function da(){return og=og||new Ke}tr.La="serverreachability";function ag(l){ze.call(this,tr.La,l)}S(ag,ze);function ds(l){let h=da();Xe(h,new ag(h))}tr.STAT_EVENT="statevent";function lg(l,h){ze.call(this,tr.STAT_EVENT,l),this.stat=h}S(lg,ze);function Ze(l){let h=da();Xe(h,new lg(h,l))}tr.Ma="timingevent";function ug(l,h){ze.call(this,tr.Ma,l),this.size=h}S(ug,ze);function fs(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function ms(){this.g=!0}ms.prototype.xa=function(){this.g=!1};function UT(l,h,f,g,A,P){l.info(function(){if(l.g)if(P)for(var M="",de=P.split("&"),je=0;je<de.length;je++){var ae=de[je].split("=");if(1<ae.length){var $e=ae[0];ae=ae[1];var Qe=$e.split("_");M=2<=Qe.length&&Qe[1]=="type"?M+($e+"="+ae+"&"):M+($e+"=redacted&")}}else M=null;else M=P;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+f+`
`+M})}function BT(l,h,f,g,A,P,M){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+f+`
`+P+" "+M})}function Gr(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+jT(l,f)+(g?" "+g:"")})}function qT(l,h){l.info(function(){return"TIMEOUT: "+h})}ms.prototype.info=function(){};function jT(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var P=A[0];if(P!="noop"&&P!="stop"&&P!="close")for(var M=1;M<A.length;M++)A[M]=""}}}}return dc(f)}catch{return h}}var fa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},cg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gc;function ma(){}S(ma,fc),ma.prototype.g=function(){return new XMLHttpRequest},ma.prototype.i=function(){return{}},gc=new ma;function yn(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new cs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new hg}function hg(){this.i=null,this.g="",this.h=!1}var dg={},_c={};function yc(l,h,f){l.L=1,l.v=ya(tn(h)),l.m=f,l.P=!0,fg(l,null)}function fg(l,h){l.F=Date.now(),pa(l),l.A=tn(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),bg(f.i,"t",g),l.C=0,f=l.j.J,l.h=new hg,l.g=zg(l.j,f?h:null,!l.m),0<l.O&&(l.M=new FT(p(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(ng[0]=A.toString()),A=ng);for(var P=0;P<A.length;P++){var M=Hp(f,A[P],g||h.handleEvent,!1,h.h||h);if(!M)break;h.g[M.key]=M}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),ds(),UT(l.i,l.u,l.A,l.l,l.R,l.m)}yn.prototype.ca=function(l){l=l.target;let h=this.M;h&&nn(l)==3?h.j():this.Y(l)},yn.prototype.Y=function(l){try{if(l==this.g)e:{let Qe=nn(this.g);var h=this.g.Ba();let Kr=this.g.Z();if(!(3>Qe)&&(Qe!=3||this.g&&(this.h.h||this.g.oa()||Vg(this.g)))){this.J||Qe!=4||h==7||(h==8||0>=Kr?ds(3):ds(2)),vc(this);var f=this.g.Z();this.X=f;t:if(mg(this)){var g=Vg(this.g);l="";var A=g.length,P=nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nr(this),ps(this);var M="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(P&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=f==200,BT(this.i,this.u,this.A,this.l,this.R,Qe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var de,je=this.g;if((de=je.g?je.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(de)){var ae=de;break t}}ae=null}if(f=ae)Gr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wc(this,f);else{this.o=!1,this.s=3,Ze(12),nr(this),ps(this);break e}}if(this.P){f=!0;let Ct;for(;!this.J&&this.C<M.length;)if(Ct=GT(this,M),Ct==_c){Qe==4&&(this.s=4,Ze(14),f=!1),Gr(this.i,this.l,null,"[Incomplete Response]");break}else if(Ct==dg){this.s=4,Ze(15),Gr(this.i,this.l,M,"[Invalid Chunk]"),f=!1;break}else Gr(this.i,this.l,Ct,null),wc(this,Ct);if(mg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qe!=4||M.length!=0||this.h.h||(this.s=1,Ze(16),f=!1),this.o=this.o&&f,!f)Gr(this.i,this.l,M,"[Invalid Chunked Response]"),nr(this),ps(this);else if(0<M.length&&!this.W){this.W=!0;var $e=this.j;$e.g==this&&$e.ba&&!$e.M&&($e.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Cc($e),$e.M=!0,Ze(11))}}else Gr(this.i,this.l,M,null),wc(this,M);Qe==4&&nr(this),this.o&&!this.J&&(Qe==4?qg(this.j,this):(this.o=!1,pa(this)))}else oA(this.g),f==400&&0<M.indexOf("Unknown SID")?(this.s=3,Ze(12)):(this.s=0,Ze(13)),nr(this),ps(this)}}}catch{}finally{}};function mg(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function GT(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?_c:(f=Number(h.substring(f,g)),isNaN(f)?dg:(g+=1,g+f>h.length?_c:(h=h.slice(g,g+f),l.C=g+f,h)))}yn.prototype.cancel=function(){this.J=!0,nr(this)};function pa(l){l.S=Date.now()+l.I,pg(l,l.I)}function pg(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=fs(p(l.ba,l),h)}function vc(l){l.B&&(a.clearTimeout(l.B),l.B=null)}yn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(qT(this.i,this.A),this.L!=2&&(ds(),Ze(17)),nr(this),this.s=2,ps(this)):pg(this,this.S-l)};function ps(l){l.j.G==0||l.J||qg(l.j,l)}function nr(l){vc(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,rg(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function wc(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Ec(f.h,l))){if(!l.K&&Ec(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Ta(f),Ea(f);else break e;Sc(f),Ze(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=fs(p(f.Za,f),6e3));if(1>=yg(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else ir(f,11)}else if((l.K||f.g==l)&&Ta(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let $e=ae[3];$e!=null&&(f.la=$e,f.j.info("VER="+f.la));let Qe=ae[4];Qe!=null&&(f.Aa=Qe,f.j.info("SVER="+f.Aa));let Kr=ae[5];Kr!=null&&typeof Kr=="number"&&0<Kr&&(g=1.5*Kr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Ct=l.g;if(Ct){let Sa=Ct.g?Ct.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Sa){var P=g.h;P.g||Sa.indexOf("spdy")==-1&&Sa.indexOf("quic")==-1&&Sa.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ic(P,P.h),P.h=null))}if(g.D){let bc=Ct.g?Ct.g.getResponseHeader("X-HTTP-Session-Id"):null;bc&&(g.ya=bc,_e(g.I,g.D,bc))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var M=l;if(g.qa=Wg(g,g.J?g.ia:null,g.W),M.K){vg(g.h,M);var de=M,je=g.L;je&&(de.I=je),de.B&&(vc(de),pa(de)),g.g=M}else Ug(g);0<f.i.length&&Ia(f)}else ae[0]!="stop"&&ae[0]!="close"||ir(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?ir(f,7):Ac(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}ds(4)}catch{}}var WT=class{constructor(l,h){this.g=l,this.map=h}};function gg(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function _g(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function yg(l){return l.h?1:l.g?l.g.size:0}function Ec(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Ic(l,h){l.g?l.g.add(h):l.h=h}function vg(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}gg.prototype.cancel=function(){if(this.i=wg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function wg(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return N(l.i)}function zT(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function KT(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function Eg(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=KT(l),g=zT(l),A=g.length,P=0;P<A;P++)h.call(void 0,g[P],f&&f[P],l)}var Ig=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $T(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),A=null;if(0<=g){var P=l[f].substring(0,g);A=l[f].substring(g+1)}else P=l[f];h(P,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function rr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof rr){this.h=l.h,ga(this,l.j),this.o=l.o,this.g=l.g,_a(this,l.s),this.l=l.l;var h=l.i,f=new ys;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Tg(this,f),this.m=l.m}else l&&(h=String(l).match(Ig))?(this.h=!1,ga(this,h[1]||"",!0),this.o=gs(h[2]||""),this.g=gs(h[3]||"",!0),_a(this,h[4]),this.l=gs(h[5]||"",!0),Tg(this,h[6]||"",!0),this.m=gs(h[7]||"")):(this.h=!1,this.i=new ys(null,this.h))}rr.prototype.toString=function(){var l=[],h=this.j;h&&l.push(_s(h,Ag,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(_s(h,Ag,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(_s(f,f.charAt(0)=="/"?YT:HT,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",_s(f,XT)),l.join("")};function tn(l){return new rr(l)}function ga(l,h,f){l.j=f?gs(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function _a(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Tg(l,h,f){h instanceof ys?(l.i=h,ZT(l.i,l.h)):(f||(h=_s(h,JT)),l.i=new ys(h,l.h))}function _e(l,h,f){l.i.set(h,f)}function ya(l){return _e(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function gs(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function _s(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,QT),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function QT(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Ag=/[#\/\?@]/g,HT=/[#\?:]/g,YT=/[#\?]/g,JT=/[#\?@]/g,XT=/#/g;function ys(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function vn(l){l.g||(l.g=new Map,l.h=0,l.i&&$T(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=ys.prototype,n.add=function(l,h){vn(this),this.i=null,l=Wr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function Sg(l,h){vn(l),h=Wr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Cg(l,h){return vn(l),h=Wr(l,h),l.g.has(h)}n.forEach=function(l,h){vn(this),this.g.forEach(function(f,g){f.forEach(function(A){l.call(h,A,g,this)},this)},this)},n.na=function(){vn(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let A=l[g];for(let P=0;P<A.length;P++)f.push(h[g])}return f},n.V=function(l){vn(this);let h=[];if(typeof l=="string")Cg(this,l)&&(h=h.concat(this.g.get(Wr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return vn(this),this.i=null,l=Wr(this,l),Cg(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function bg(l,h,f){Sg(l,h),0<f.length&&(l.i=null,l.g.set(Wr(l,h),N(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let P=encodeURIComponent(String(g)),M=this.V(g);for(g=0;g<M.length;g++){var A=P;M[g]!==""&&(A+="="+encodeURIComponent(String(M[g]))),l.push(A)}}return this.i=l.join("&")};function Wr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function ZT(l,h){h&&!l.j&&(vn(l),l.i=null,l.g.forEach(function(f,g){var A=g.toLowerCase();g!=A&&(Sg(this,g),bg(this,A,f))},l)),l.j=h}function eA(l,h){let f=new ms;if(a.Image){let g=new Image;g.onload=y(wn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(wn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(wn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(wn,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function tA(l,h){let f=new ms,g=new AbortController,A=setTimeout(()=>{g.abort(),wn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(P=>{clearTimeout(A),P.ok?wn(f,"TestPingServer: ok",!0,h):wn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),wn(f,"TestPingServer: error",!1,h)})}function wn(l,h,f,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(f)}catch{}}function nA(){this.g=new LT}function rA(l,h,f){let g=f||"";try{Eg(l,function(A,P){let M=A;c(A)&&(M=dc(A)),h.push(g+P+"="+encodeURIComponent(M))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function vs(l){this.l=l.Ub||null,this.j=l.eb||!1}S(vs,fc),vs.prototype.g=function(){return new va(this.l,this.j)},vs.prototype.i=function(l){return function(){return l}}({});function va(l,h){Ke.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(va,Ke),n=va.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Es(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ws(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Es(this)),this.g&&(this.readyState=3,Es(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Rg(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Rg(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?ws(this):Es(this),this.readyState==3&&Rg(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,ws(this))},n.Qa=function(l){this.g&&(this.response=l,ws(this))},n.ga=function(){this.g&&ws(this)};function ws(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Es(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function Es(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(va.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Pg(l){let h="";return Y(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Tc(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=Pg(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):_e(l,h,f))}function Ae(l){Ke.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Ae,Ke);var iA=/^https?$/i,sA=["POST","PUT"];n=Ae.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gc.g(),this.v=this.o?ig(this.o):ig(gc),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(P){Ng(this,P);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)f.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let P of g.keys())f.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(P=>P.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(sA,h,void 0))||g||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,M]of f)this.g.setRequestHeader(P,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Dg(this),this.u=!0,this.g.send(l),this.u=!1}catch(P){Ng(this,P)}};function Ng(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,xg(l),wa(l)}function xg(l){l.A||(l.A=!0,Xe(l,"complete"),Xe(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Xe(this,"complete"),Xe(this,"abort"),wa(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),wa(this,!0)),Ae.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?kg(this):this.bb())},n.bb=function(){kg(this)};function kg(l){if(l.h&&typeof o<"u"&&(!l.v[1]||nn(l)!=4||l.Z()!=2)){if(l.u&&nn(l)==4)eg(l.Ea,0,l);else if(Xe(l,"readystatechange"),nn(l)==4){l.h=!1;try{let M=l.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=M===0){var A=String(l.D).match(Ig)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!iA.test(A?A.toLowerCase():"")}f=g}if(f)Xe(l,"complete"),Xe(l,"success");else{l.m=6;try{var P=2<nn(l)?l.g.statusText:""}catch{P=""}l.l=P+" ["+l.Z()+"]",xg(l)}}finally{wa(l)}}}}function wa(l,h){if(l.g){Dg(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||Xe(l,"ready");try{f.onreadystatechange=g}catch{}}}function Dg(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function nn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),MT(h)}};function Vg(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function oA(l){let h={};l=(l.g&&2<=nn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(j(l[g]))continue;var f=T(l[g]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let P=h[A]||[];h[A]=P,P.push(f)}E(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function Og(l){this.Aa=0,this.i=[],this.j=new ms,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Is("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Is("baseRetryDelayMs",5e3,l),this.cb=Is("retryDelaySeedMs",1e4,l),this.Wa=Is("forwardChannelMaxRetries",2,l),this.wa=Is("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new gg(l&&l.concurrentRequestLimit),this.Da=new nA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Og.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){Ze(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=Wg(this,null,this.W),Ia(this)};function Ac(l){if(Fg(l),l.G==3){var h=l.U++,f=tn(l.I);if(_e(f,"SID",l.K),_e(f,"RID",h),_e(f,"TYPE","terminate"),Ts(l,f),h=new yn(l,l.j,h),h.L=2,h.v=ya(tn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=zg(h.j,null),h.g.ea(h.v)),h.F=Date.now(),pa(h)}Gg(l)}function Ea(l){l.g&&(Cc(l),l.g.cancel(),l.g=null)}function Fg(l){Ea(l),l.u&&(a.clearTimeout(l.u),l.u=null),Ta(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Ia(l){if(!_g(l.h)&&!l.s){l.s=!0;var h=l.Ga;os||Qp(),as||(os(),as=!0),rc.add(h,l),l.B=0}}function aA(l,h){return yg(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=fs(p(l.Ga,l,h),jg(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new yn(this,this.j,l),P=this.o;if(this.S&&(P?(P=_(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(A.H=P,P=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=Lg(this,A,h),f=tn(this.I),_e(f,"RID",l),_e(f,"CVER",22),this.D&&_e(f,"X-HTTP-Session-Id",this.D),Ts(this,f),P&&(this.O?h="headers="+encodeURIComponent(String(Pg(P)))+"&"+h:this.m&&Tc(f,this.m,P)),Ic(this.h,A),this.Ua&&_e(f,"TYPE","init"),this.P?(_e(f,"$req",h),_e(f,"SID","null"),A.T=!0,yc(A,f,null)):yc(A,f,h),this.G=2}}else this.G==3&&(l?Mg(this,l):this.i.length==0||_g(this.h)||Mg(this))};function Mg(l,h){var f;h?f=h.l:f=l.U++;let g=tn(l.I);_e(g,"SID",l.K),_e(g,"RID",f),_e(g,"AID",l.T),Ts(l,g),l.m&&l.o&&Tc(g,l.m,l.o),f=new yn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Lg(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Ic(l.h,f),yc(f,g,h)}function Ts(l,h){l.H&&Y(l.H,function(f,g){_e(h,g,f)}),l.l&&Eg({},function(f,g){_e(h,g,f)})}function Lg(l,h,f){f=Math.min(l.i.length,f);var g=l.l?p(l.l.Na,l.l,l):null;e:{var A=l.i;let P=-1;for(;;){let M=["count="+f];P==-1?0<f?(P=A[0].g,M.push("ofs="+P)):P=0:M.push("ofs="+P);let de=!0;for(let je=0;je<f;je++){let ae=A[je].g,$e=A[je].map;if(ae-=P,0>ae)P=Math.max(0,A[je].g-100),de=!1;else try{rA($e,M,"req"+ae+"_")}catch{g&&g($e)}}if(de){g=M.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function Ug(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;os||Qp(),as||(os(),as=!0),rc.add(h,l),l.v=0}}function Sc(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=fs(p(l.Fa,l),jg(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,Bg(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=fs(p(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ze(10),Ea(this),Bg(this))};function Cc(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Bg(l){l.g=new yn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=tn(l.qa);_e(h,"RID","rpc"),_e(h,"SID",l.K),_e(h,"AID",l.T),_e(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&_e(h,"TO",l.ja),_e(h,"TYPE","xmlhttp"),Ts(l,h),l.m&&l.o&&Tc(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=ya(tn(h)),f.m=null,f.P=!0,fg(f,l)}n.Za=function(){this.C!=null&&(this.C=null,Ea(this),Sc(this),Ze(19))};function Ta(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function qg(l,h){var f=null;if(l.g==h){Ta(l),Cc(l),l.g=null;var g=2}else if(Ec(l.h,h))f=h.D,vg(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=da(),Xe(g,new ug(g,f)),Ia(l)}else Ug(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&aA(l,h)||g==2&&Sc(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:ir(l,5);break;case 4:ir(l,10);break;case 3:ir(l,6);break;default:ir(l,2)}}}function jg(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function ir(l,h){if(l.j.info("Error code "+h),h==2){var f=p(l.fb,l),g=l.Xa;let A=!g;g=new rr(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ga(g,"https"),ya(g),A?eA(g.toString(),f):tA(g.toString(),f)}else Ze(2);l.G=0,l.l&&l.l.sa(h),Gg(l),Fg(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))};function Gg(l){if(l.G=0,l.ka=[],l.l){let h=wg(l.h);(h.length!=0||l.i.length!=0)&&(x(l.ka,h),x(l.ka,l.i),l.h.i.length=0,N(l.i),l.i.length=0),l.l.ra()}}function Wg(l,h,f){var g=f instanceof rr?tn(f):new rr(f);if(g.g!="")h&&(g.g=h+"."+g.g),_a(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var P=new rr(null);g&&ga(P,g),h&&(P.g=h),A&&_a(P,A),f&&(P.l=f),g=P}return f=l.D,h=l.ya,f&&h&&_e(g,f,h),_e(g,"VER",l.la),Ts(l,g),g}function zg(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ae(new vs({eb:f})):new Ae(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Kg(){}n=Kg.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Aa(){}Aa.prototype.g=function(l,h){return new ut(l,h)};function ut(l,h){Ke.call(this),this.g=new Og(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new zr(this)}S(ut,Ke),ut.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ut.prototype.close=function(){Ac(this.g)},ut.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=dc(l),l=f);h.i.push(new WT(h.Ya++,l)),h.G==3&&Ia(h)},ut.prototype.N=function(){this.g.l=null,delete this.j,Ac(this.g),delete this.g,ut.aa.N.call(this)};function $g(l){mc.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}S($g,mc);function Qg(){pc.call(this),this.status=1}S(Qg,pc);function zr(l){this.g=l}S(zr,Kg),zr.prototype.ua=function(){Xe(this.g,"a")},zr.prototype.ta=function(l){Xe(this.g,new $g(l))},zr.prototype.sa=function(l){Xe(this.g,new Qg)},zr.prototype.ra=function(){Xe(this.g,"b")},Aa.prototype.createWebChannel=Aa.prototype.g,ut.prototype.send=ut.prototype.o,ut.prototype.open=ut.prototype.m,ut.prototype.close=ut.prototype.close,zd=an.createWebChannelTransport=function(){return new Aa},Wd=an.getStatEventTarget=function(){return da()},Gd=an.Event=tr,Vl=an.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fa.NO_ERROR=0,fa.TIMEOUT=8,fa.HTTP_ERROR=6,wo=an.ErrorCode=fa,cg.COMPLETE="complete",jd=an.EventType=cg,sg.EventType=hs,hs.OPEN="a",hs.CLOSE="b",hs.ERROR="c",hs.MESSAGE="d",Ke.prototype.listen=Ke.prototype.K,yi=an.WebChannel=sg,qd=an.FetchXmlHttpFactory=vs,Ae.prototype.listenOnce=Ae.prototype.L,Ae.prototype.getLastError=Ae.prototype.Ka,Ae.prototype.getLastErrorCode=Ae.prototype.Ba,Ae.prototype.getStatus=Ae.prototype.Z,Ae.prototype.getResponseJson=Ae.prototype.Oa,Ae.prototype.getResponseText=Ae.prototype.oa,Ae.prototype.send=Ae.prototype.ea,Ae.prototype.setWithCredentials=Ae.prototype.Ha,Bd=an.XhrIo=Ae}).apply(typeof Dl<"u"?Dl:typeof self<"u"?self:typeof window<"u"?window:{});var Yv="@firebase/firestore";var Ve=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ve.UNAUTHENTICATED=new Ve(null),Ve.GOOGLE_CREDENTIALS=new Ve("google-credentials-uid"),Ve.FIRST_PARTY=new Ve("first-party-uid"),Ve.MOCK_USER=new Ve("mock-user");var Hi="10.13.0";var jn=new Hr("@firebase/firestore");function Ti(){return jn.logLevel}function Xw(n){jn.setLogLevel(n)}function V(n,...e){if(jn.logLevel<=yt.DEBUG){let t=e.map(Jm);jn.debug(`Firestore (${Hi}): ${n}`,...t)}}function be(n,...e){if(jn.logLevel<=yt.ERROR){let t=e.map(Jm);jn.error(`Firestore (${Hi}): ${n}`,...t)}}function Tt(n,...e){if(jn.logLevel<=yt.WARN){let t=e.map(Jm);jn.warn(`Firestore (${Hi}): ${n}`,...t)}}function Jm(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${Hi}) INTERNAL ASSERTION FAILED: `+n;throw be(e),new Error(e)}function G(n,e){n||B()}function Zw(n,e){n||B()}function L(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends a_{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Oe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var zl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Yd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ve.UNAUTHENTICATED))}shutdown(){}},Jd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Xd=class{constructor(e){this.t=e,this.currentUser=Ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Oe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Oe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>k(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Oe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(G(typeof r.accessToken=="string"),new zl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Ve(e)}},Zd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ef=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Zd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}},tf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},nf=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new tf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function fb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Kl=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=fb(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function Q(n,e){return n<e?-1:n>e?1:0}function ki(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function eE(n){return n+"\0"}var Te=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var W=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Te(0,0))}static max(){return new n(new Te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var $l=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends $l{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},mb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Re=class n extends $l{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return mb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new D(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new D(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new D(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Di=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function rf(n){return n.fields.find(e=>e.kind===2)}function yr(n){return n.fields.filter(e=>e.kind!==2)}Di.UNKNOWN_ID=-1;var Pi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ko=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,At.min())}};function tE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=W.fromTimestamp(r===1e9?new Te(t+1,0):new Te(t,r));return new At(i,U.empty(),e)}function nE(n){return new At(n.readTime,n.key,-1)}var At=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(W.min(),U.empty(),-1)}static max(){return new n(W.max(),U.empty(),-1)}};function Xm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var rE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ql=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Xn(n){return k(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==rE)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(d=>{o[c]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Hl=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Oe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ar(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Zm(r.target.error);this.V.reject(new Ar(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Ar(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new of(t)}},Gn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(Rs())===12.2&&be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),vr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!o_())return!1;if(n.v())return!0;let e=Rs(),t=n.S(e),r=0<t&&t<10,i=iE(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return k(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Ar(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new D(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ar(e,o))},i.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return k(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Hl.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),b.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function iE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var sf=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return vr(this.B.delete())}},Ar=class extends D{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Zn(n){return n.name==="IndexedDbTransactionError"}var of=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),vr(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),vr(this.store.add(e))}get(e){return vr(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),vr(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),vr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((r,i)=>{t.onerror=s=>{let o=Zm(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new b((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new sf(a),c=t(a.primaryKey,a.value,u);if(c instanceof b){let d=c.catch(m=>(u.done(),b.reject(m)));r.push(d)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>b.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function vr(n){return new b((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Zm(r.target.error);t(i)}})}var Jv=!1;function Zm(n){let e=Gn.S(Rs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jv||(Jv=!0,setTimeout(()=>{throw r},0)),r}}return n}var af=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>k(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Zn(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Xn(t)}yield this.X(6e4)}))}},lf=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return k(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=nE(s);Xm(o,r)>0&&(r=o)}),new At(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var mt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ta(n){return n==null}function Do(n){return n===0&&1/n==-1/0}function sE(n){return typeof n=="number"&&Number.isInteger(n)&&!Do(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function it(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Xv(e)),e=pb(n.get(t),e);return Xv(e)}function pb(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Xv(n){return n+""}function Wt(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),se.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:B()}s=o+2}return new se(r)}var Zv=["userId","batchId"];function Ul(n,e){return[n,it(e)]}function oE(n,e,t){return[n,it(e),t]}var gb={},_b=["prefixPath","collectionGroup","readTime","documentId"],yb=["prefixPath","collectionGroup","documentId"],vb=["collectionGroup","readTime","prefixPath","documentId"],wb=["canonicalId","targetId"],Eb=["targetId","path"],Ib=["path","targetId"],Tb=["collectionId","parent"],Ab=["indexId","uid"],Sb=["uid","sequenceNumber"],Cb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],bb=["indexId","uid","orderedDocumentKey"],Rb=["userId","collectionPath","documentId"],Pb=["userId","collectionPath","largestBatchId"],Nb=["userId","collectionGroup","largestBatchId"],aE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],xb=[...aE,"documentOverlays"],lE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],uE=lE,ep=[...uE,"indexConfiguration","indexState","indexEntries"],kb=ep,Db=[...ep,"globals"];var Vo=class extends Ql{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Le(n,e){let t=L(n);return Gn.F(t._e,e)}function ew(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Fr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function cE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ye=class n{constructor(e,t){this.comparator=e,this.root=t||Kt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ri(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ri(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ri(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ri(this.root,e,this.comparator,!0)}},Ri=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Kt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};Kt.EMPTY=null,Kt.RED=!0,Kt.BLACK=!1;Kt.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Kt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var me=class n{constructor(e){this.comparator=e,this.data=new ye(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Yl(this.data.getIterator())}getIteratorFrom(e){return new Yl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Yl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function vi(n){return n.hasNext()?n.getNext():void 0}var pt=class n{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new n([])}unionWith(e){let t=new me(Re.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ki(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Jl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function hE(){return typeof atob<"u"}var Ne=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Jl("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ne.EMPTY_BYTE_STRING=new Ne("");var Vb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cn(n){if(G(!!n),typeof n=="string"){let e=0,t=Vb.exec(n);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Wn(n){return typeof n=="string"?Ne.fromBase64String(n):Ne.fromUint8Array(n)}function qu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function tp(n){let e=n.mapValue.fields.__previous_value__;return qu(e)?tp(e):e}function Oo(n){let e=cn(n.mapValue.fields.__local_write_time__.timestampValue);return new Te(e.seconds,e.nanos)}var uf=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},zn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Bn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Bl={nullValue:"NULL_VALUE"};function Sr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qu(n)?4:dE(n)?9007199254740991:ju(n)?10:11:B()}function Ht(n,e){if(n===e)return!0;let t=Sr(n);if(t!==Sr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Oo(n).isEqual(Oo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=cn(i.timestampValue),a=cn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Wn(i.bytesValue).isEqual(Wn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return we(i.geoPointValue.latitude)===we(s.geoPointValue.latitude)&&we(i.geoPointValue.longitude)===we(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return we(i.integerValue)===we(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=we(i.doubleValue),a=we(s.doubleValue);return o===a?Do(o)===Do(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ki(n.arrayValue.values||[],e.arrayValue.values||[],Ht);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(ew(o)!==ew(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Ht(o[u],a[u])))return!1;return!0}(n,e);default:return B()}}function Fo(n,e){return(n.values||[]).find(t=>Ht(t,e))!==void 0}function Kn(n,e){if(n===e)return 0;let t=Sr(n),r=Sr(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=we(s.integerValue||s.doubleValue),u=we(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return tw(n.timestampValue,e.timestampValue);case 4:return tw(Oo(n),Oo(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Wn(s),u=Wn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let d=Q(a[c],u[c]);if(d!==0)return d}return Q(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Q(we(s.latitude),we(o.latitude));return a!==0?a:Q(we(s.longitude),we(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return nw(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,u,c,d;let m=s.fields||{},p=o.fields||{},y=(a=m.value)===null||a===void 0?void 0:a.arrayValue,S=(u=p.value)===null||u===void 0?void 0:u.arrayValue,N=Q(((c=y?.values)===null||c===void 0?void 0:c.length)||0,((d=S?.values)===null||d===void 0?void 0:d.length)||0);return N!==0?N:nw(y,S)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Bn.mapValue&&o===Bn.mapValue)return 0;if(s===Bn.mapValue)return 1;if(o===Bn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){let p=Q(u[m],d[m]);if(p!==0)return p;let y=Kn(a[u[m]],c[d[m]]);if(y!==0)return y}return Q(u.length,d.length)}(n.mapValue,e.mapValue);default:throw B()}}function tw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=cn(n),r=cn(e),i=Q(t.seconds,r.seconds);return i!==0?i:Q(t.nanos,r.nanos)}function nw(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Kn(t[i],r[i]);if(s)return s}return Q(t.length,r.length)}function Vi(n){return cf(n)}function cf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=cn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Wn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=cf(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${cf(t.fields[o])}`;return i+"}"}(n.mapValue):B()}function Cr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function hf(n){return!!n&&"integerValue"in n}function Mo(n){return!!n&&"arrayValue"in n}function rw(n){return!!n&&"nullValue"in n}function iw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ql(n){return!!n&&"mapValue"in n}function ju(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function bo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Fr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=bo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=bo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function dE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var fE={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Ob(n){return"nullValue"in n?Bl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Cr(zn.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ju(n)?fE:{mapValue:{}}:B()}function Fb(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Cr(zn.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?fE:"mapValue"in n?ju(n)?{mapValue:{}}:Bn:B()}function sw(n,e){let t=Kn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ow(n,e){let t=Kn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Je=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ql(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bo(t)}setAll(e){let t=Re.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=bo(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ql(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ht(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ql(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Fr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(bo(this.value))}};function mE(n){let e=[];return Fr(n.fields,(t,r)=>{let i=new Re([t]);if(ql(r)){let s=mE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new pt(e)}var Fe=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,W.min(),W.min(),W.min(),Je.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,W.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,W.min(),W.min(),Je.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,W.min(),W.min(),Je.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Je.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Je.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yt=class{constructor(e,t){this.position=e,this.inclusive=t}};function aw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=U.comparator(U.fromName(o.referenceValue),t.key):r=Kn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function lw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ht(n.position[t],e.position[t]))return!1;return!0}var br=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Mb(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Xl=class{},re=class n extends Xl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new mf(e,t,r):t==="array-contains"?new _f(e,r):t==="in"?new Zl(e,r):t==="not-in"?new yf(e,r):t==="array-contains-any"?new vf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new pf(e,r):new gf(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Kn(t,this.value)):t!==null&&Sr(this.value)===Sr(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ce=class n extends Xl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Oi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Oi(n){return n.op==="and"}function df(n){return n.op==="or"}function np(n){return pE(n)&&Oi(n)}function pE(n){for(let e of n.filters)if(e instanceof ce)return!1;return!0}function ff(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+Vi(n.value);if(np(n))return n.filters.map(e=>ff(e)).join(",");{let e=n.filters.map(t=>ff(t)).join(",");return`${n.op}(${e})`}}function gE(n,e){return n instanceof re?function(r,i){return i instanceof re&&r.op===i.op&&r.field.isEqual(i.field)&&Ht(r.value,i.value)}(n,e):n instanceof ce?function(r,i){return i instanceof ce&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&gE(o,i.filters[a]),!0):!1}(n,e):void B()}function _E(n,e){let t=n.filters.concat(e);return ce.create(t,n.op)}function yE(n){return n instanceof re?function(t){return`${t.field.canonicalString()} ${t.op} ${Vi(t.value)}`}(n):n instanceof ce?function(t){return t.op.toString()+" {"+t.getFilters().map(yE).join(" ,")+"}"}(n):"Filter"}var mf=class extends re{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},pf=class extends re{constructor(e,t){super(e,"in",t),this.keys=vE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gf=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=vE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function vE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var _f=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Mo(t)&&Fo(t.arrayValue,this.value)}},Zl=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Fo(this.value.arrayValue,t)}},yf=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Fo(this.value.arrayValue,t)}},vf=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Mo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fo(this.value.arrayValue,r))}};var wf=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Ef(n,e=null,t=[],r=[],i=null,s=null,o=null){return new wf(n,e,t,r,i,s,o)}function Rr(n){let e=L(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ff(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ta(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Vi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Vi(r)).join(",")),e.ue=t}return e.ue}function na(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Mb(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!gE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lw(n.startAt,e.startAt)&&lw(n.endAt,e.endAt)}function eu(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function tu(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function uw(n,e,t){let r=Bl,i=!0;for(let s of tu(n,e)){let o=Bl,a=!0;switch(s.op){case"<":case"<=":o=Ob(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Bl}sw({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];sw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function cw(n,e,t){let r=Bn,i=!0;for(let s of tu(n,e)){let o=Bn,a=!0;switch(s.op){case">=":case">":o=Fb(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Bn}ow({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];ow({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Pt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function wE(n,e,t,r,i,s,o,a){return new Pt(n,e,t,r,i,s,o,a)}function Yi(n){return new Pt(n)}function hw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function rp(n){return n.collectionGroup!==null}function Ni(n){let e=L(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new me(Re.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new br(s,r))}),t.has(Re.keyField().canonicalString())||e.ce.push(new br(Re.keyField(),r))}return e.ce}function st(n){let e=L(n);return e.le||(e.le=Lb(e,Ni(n))),e.le}function Lb(n,e){if(n.limitType==="F")return Ef(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new br(i.field,s)});let t=n.endAt?new Yt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yt(n.startAt.position,n.startAt.inclusive):null;return Ef(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function If(n,e){let t=n.filters.concat([e]);return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function nu(n,e,t){return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ra(n,e){return na(st(n),st(e))&&n.limitType===e.limitType}function EE(n){return`${Rr(st(n))}|lt:${n.limitType}`}function Ai(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>yE(i)).join(", ")}]`),ta(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Vi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Vi(i)).join(",")),`Target(${r})`}(st(n))}; limitType=${n.limitType})`}function ia(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):U.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Ni(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=aw(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Ni(r),i)||r.endAt&&!function(o,a,u){let c=aw(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Ni(r),i))}(n,e)}function IE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function TE(n){return(e,t)=>{let r=!1;for(let i of Ni(n)){let s=Ub(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Ub(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Kn(u,c):B()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var Jt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Fr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return cE(this.inner)}size(){return this.innerSize}};var Bb=new ye(U.comparator);function lt(){return Bb}var AE=new ye(U.comparator);function So(...n){let e=AE;for(let t of n)e=e.insert(t.key,t);return e}function SE(n){let e=AE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zt(){return Ro()}function CE(){return Ro()}function Ro(){return new Jt(n=>n.toString(),(n,e)=>n.isEqual(e))}var qb=new ye(U.comparator),jb=new me(U.comparator);function X(...n){let e=jb;for(let t of n)e=e.add(t);return e}var Gb=new me(Q);function ip(){return Gb}function sp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Do(e)?"-0":e}}function bE(n){return{integerValue:""+n}}function RE(n,e){return sE(e)?bE(e):sp(n,e)}var Fi=class{constructor(){this._=void 0}};function Wb(n,e,t){return n instanceof $n?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&qu(s)&&(s=tp(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof hn?NE(n,e):n instanceof dn?xE(n,e):function(i,s){let o=PE(i,s),a=dw(o)+dw(i.Pe);return hf(o)&&hf(i.Pe)?bE(a):sp(i.serializer,a)}(n,e)}function zb(n,e,t){return n instanceof hn?NE(n,e):n instanceof dn?xE(n,e):t}function PE(n,e){return n instanceof Qn?function(r){return hf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var $n=class extends Fi{},hn=class extends Fi{constructor(e){super(),this.elements=e}};function NE(n,e){let t=kE(e);for(let r of n.elements)t.some(i=>Ht(i,r))||t.push(r);return{arrayValue:{values:t}}}var dn=class extends Fi{constructor(e){super(),this.elements=e}};function xE(n,e){let t=kE(e);for(let r of n.elements)t=t.filter(i=>!Ht(i,r));return{arrayValue:{values:t}}}var Qn=class extends Fi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function dw(n){return we(n.integerValue||n.doubleValue)}function kE(n){return Mo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Pr=class{constructor(e,t){this.field=e,this.transform=t}};function Kb(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof hn&&i instanceof hn||r instanceof dn&&i instanceof dn?ki(r.elements,i.elements,Ht):r instanceof Qn&&i instanceof Qn?Ht(r.Pe,i.Pe):r instanceof $n&&i instanceof $n}(n.transform,e.transform)}var Tf=class{constructor(e,t){this.version=e,this.transformResults=t}},Se=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function jl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Mi=class{};function DE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Yn(n.key,Se.none()):new Hn(n.key,n.data,Se.none());{let t=n.data,r=Je.empty(),i=new me(Re.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Nt(n.key,r,new pt(i.toArray()),Se.none())}}function $b(n,e,t){n instanceof Hn?function(i,s,o){let a=i.value.clone(),u=mw(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Nt?function(i,s,o){if(!jl(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=mw(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(VE(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Po(n,e,t,r){return n instanceof Hn?function(s,o,a,u){if(!jl(s.precondition,o))return a;let c=s.value.clone(),d=pw(s.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Nt?function(s,o,a,u){if(!jl(s.precondition,o))return a;let c=pw(s.fieldTransforms,u,o),d=o.data;return d.setAll(VE(s)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,o,a){return jl(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Qb(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=PE(r.transform,i||null);s!=null&&(t===null&&(t=Je.empty()),t.set(r.field,s))}return t||null}function fw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ki(r,i,(s,o)=>Kb(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Hn=class extends Mi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Nt=class extends Mi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function VE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function mw(n,e,t){let r=new Map;G(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,zb(o,a,t[i]))}return r}function pw(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Wb(s,o,e))}return r}var Yn=class extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Lo=class extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Uo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&$b(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Po(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Po(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=CE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=DE(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(W.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&ki(this.mutations,e.mutations,(t,r)=>fw(t,r))&&ki(this.baseMutations,e.baseMutations,(t,r)=>fw(t,r))}},Af=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){G(e.mutations.length===r.length);let i=function(){return qb}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Bo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Sf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ke,ie;function OE(n){switch(n){default:return B();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function FE(n){if(n===void 0)return be("GRPC error has no .code"),R.UNKNOWN;switch(n){case ke.OK:return R.OK;case ke.CANCELLED:return R.CANCELLED;case ke.UNKNOWN:return R.UNKNOWN;case ke.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case ke.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case ke.INTERNAL:return R.INTERNAL;case ke.UNAVAILABLE:return R.UNAVAILABLE;case ke.UNAUTHENTICATED:return R.UNAUTHENTICATED;case ke.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case ke.NOT_FOUND:return R.NOT_FOUND;case ke.ALREADY_EXISTS:return R.ALREADY_EXISTS;case ke.PERMISSION_DENIED:return R.PERMISSION_DENIED;case ke.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case ke.ABORTED:return R.ABORTED;case ke.OUT_OF_RANGE:return R.OUT_OF_RANGE;case ke.UNIMPLEMENTED:return R.UNIMPLEMENTED;case ke.DATA_LOSS:return R.DATA_LOSS;default:return B()}}(ie=ke||(ke={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";var gw=null;function ME(){return new TextEncoder}var Hb=new On([4294967295,4294967295],0);function _w(n){let e=ME().encode(n),t=new Ud;return t.update(e),new Uint8Array(t.digest())}function yw(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new On([t,r],0),new On([i,s],0)]}var Cf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Tr(`Invalid padding: ${t}`);if(r<0)throw new Tr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Tr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Tr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=On.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(On.fromNumber(r)));return i.compare(Hb)===1&&(i=new On([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=_w(e),[r,i]=yw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=_w(e),[r,i]=yw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Tr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var qo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,jo.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(W.min(),i,new ye(Q),lt(),X())}},jo=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,X(),X(),X())}};var xi=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},ru=class{constructor(e,t){this.targetId=e,this.me=t}},iu=class{constructor(e,t,r=Ne.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},su=class{constructor(){this.fe=0,this.ge=ww(),this.pe=Ne.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),r=X();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new jo(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=ww()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},bf=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=lt(),this.qe=vw(),this.Qe=new ye(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(eu(s))if(r===0){let o=new U(s.path);this.Ue(t,o,Fe.newNoDocument(o,W.min()))}else G(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}gw?.et(function(d,m,p,y,S){var N,x,q,j,F,K;let H={localCacheCount:d,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},Y=m.unchangedNames;return Y&&(H.bloomFilter={applied:S===0,hashCount:(N=Y?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(j=(q=(x=Y?.bits)===null||x===void 0?void 0:x.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(K=(F=Y?.bits)===null||F===void 0?void 0:F.padding)!==null&&K!==void 0?K:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),H}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Wn(r).toUint8Array()}catch(u){if(u instanceof Jl)return Tt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Cf(o,i,s)}catch(u){return Tt(u instanceof Tr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&eu(a.target)){let u=new U(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Fe.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=X();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new qo(e,t,this.Qe,this.ke,r);return this.ke=lt(),this.qe=vw(),this.Qe=new ye(Q),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new su,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new me(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new su),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function vw(){return new ye(U.comparator)}function ww(){return new ye(U.comparator)}var Yb={asc:"ASCENDING",desc:"DESCENDING"},Jb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xb={and:"AND",or:"OR"},Rf=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Pf(n,e){return n.useProto3Json||ta(e)?e:{value:e}}function Li(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function LE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Zb(n,e){return Li(n,e.toTimestamp())}function Pe(n){return G(!!n),W.fromTimestamp(function(t){let r=cn(t);return new Te(r.seconds,r.nanos)}(n))}function op(n,e){return Nf(n,e).canonicalString()}function Nf(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function UE(n){let e=se.fromString(n);return G(HE(e)),e}function Go(n,e){return op(n.databaseId,e.path)}function $t(n,e){let t=UE(e);if(t.get(1)!==n.databaseId.projectId)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(jE(t))}function BE(n,e){return op(n.databaseId,e)}function qE(n){let e=UE(n);return e.length===4?se.emptyPath():jE(e)}function xf(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jE(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Ew(n,e,t){return{name:Go(n,e),fields:t.value.mapValue.fields}}function GE(n,e,t){let r=$t(n,e.name),i=Pe(e.updateTime),s=e.createTime?Pe(e.createTime):W.min(),o=new Je({mapValue:{fields:e.fields}}),a=Fe.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function eR(n,e){return"found"in e?function(r,i){G(!!i.found),i.found.name,i.found.updateTime;let s=$t(r,i.found.name),o=Pe(i.found.updateTime),a=i.found.createTime?Pe(i.found.createTime):W.min(),u=new Je({mapValue:{fields:i.found.fields}});return Fe.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){G(!!i.missing),G(!!i.readTime);let s=$t(r,i.missing),o=Pe(i.readTime);return Fe.newNoDocument(s,o)}(n,e):B()}function tR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,d){return c.useProto3Json?(G(d===void 0||typeof d=="string"),Ne.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ne.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let d=c.code===void 0?R.UNKNOWN:FE(c.code);return new D(d,c.message||"")}(o);t=new iu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=$t(n,r.document.name),s=Pe(r.document.updateTime),o=r.document.createTime?Pe(r.document.createTime):W.min(),a=new Je({mapValue:{fields:r.document.fields}}),u=Fe.newFoundDocument(i,s,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new xi(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=$t(n,r.document),s=r.readTime?Pe(r.readTime):W.min(),o=Fe.newNoDocument(i,s),a=r.removedTargetIds||[];t=new xi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=$t(n,r.document),s=r.removedTargetIds||[];t=new xi([],s,i,null)}else{if(!("filter"in e))return B();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Sf(i,s),a=r.targetId;t=new ru(a,o)}}return t}function Wo(n,e){let t;if(e instanceof Hn)t={update:Ew(n,e.key,e.value)};else if(e instanceof Yn)t={delete:Go(n,e.key)};else if(e instanceof Nt)t={update:Ew(n,e.key,e.data),updateMask:aR(e.fieldMask)};else{if(!(e instanceof Lo))return B();t={verify:Go(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof $n)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof dn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Qn)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw B()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Zb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function kf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Se.updateTime(Pe(s.updateTime)):s.exists!==void 0?Se.exists(s.exists):Se.none()}(e.currentDocument):Se.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),u=new $n;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];u=new hn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];u=new dn(d)}else"increment"in a?u=new Qn(o,a.increment):B();let c=Re.fromServerFormat(a.fieldPath);return new Pr(c,u)}(n,i)):[];if(e.update){e.update.name;let i=$t(n,e.update.name),s=new Je({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new pt(c.map(d=>Re.fromServerFormat(d)))}(e.updateMask);return new Nt(i,s,o,t,r)}return new Hn(i,s,t,r)}if(e.delete){let i=$t(n,e.delete);return new Yn(i,t)}if(e.verify){let i=$t(n,e.verify);return new Lo(i,t)}return B()}function nR(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Pe(i.updateTime):Pe(s);return o.isEqual(W.min())&&(o=Pe(s)),new Tf(o,i.transformResults||[])}(t,e))):[]}function WE(n,e){return{documents:[BE(n,e.path)]}}function zE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=BE(n,i);let s=function(c){if(c.length!==0)return QE(ce.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(d=>function(p){return{field:Si(p.field),direction:iR(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Pf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function KE(n){let e=qE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){G(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){let p=$E(m);return p instanceof ce&&np(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(p=>function(S){return new br(Ci(S.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(m){let p;return p=typeof m=="object"?m.value:m,ta(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(m){let p=!!m.before,y=m.values||[];return new Yt(y,p)}(t.startAt));let c=null;return t.endAt&&(c=function(m){let p=!m.before,y=m.values||[];return new Yt(y,p)}(t.endAt)),wE(e,i,o,s,a,"F",u,c)}function rR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function $E(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Ci(t.unaryFilter.field);return re.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Ci(t.unaryFilter.field);return re.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Ci(t.unaryFilter.field);return re.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Ci(t.unaryFilter.field);return re.create(o,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return re.create(Ci(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ce.create(t.compositeFilter.filters.map(r=>$E(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function iR(n){return Yb[n]}function sR(n){return Jb[n]}function oR(n){return Xb[n]}function Si(n){return{fieldPath:n.canonicalString()}}function Ci(n){return Re.fromServerFormat(n.fieldPath)}function QE(n){return n instanceof re?function(t){if(t.op==="=="){if(iw(t.value))return{unaryFilter:{field:Si(t.field),op:"IS_NAN"}};if(rw(t.value))return{unaryFilter:{field:Si(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(iw(t.value))return{unaryFilter:{field:Si(t.field),op:"IS_NOT_NAN"}};if(rw(t.value))return{unaryFilter:{field:Si(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Si(t.field),op:sR(t.op),value:t.value}}}(n):n instanceof ce?function(t){let r=t.getFilters().map(i=>QE(i));return r.length===1?r[0]:{compositeFilter:{op:oR(t.op),filters:r}}}(n):B()}function aR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function HE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ui=class n{constructor(e,t,r,i,s=W.min(),o=W.min(),a=Ne.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var ou=class{constructor(e){this.ct=e}};function lR(n,e){let t;if(e.document)t=GE(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=xr(e.noDocument.readTime);t=Fe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{let r=U.fromSegments(e.unknownDocument.path),i=xr(e.unknownDocument.version);t=Fe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Te(i[0],i[1]);return W.fromTimestamp(s)}(e.readTime)),t}function Iw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:au(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Go(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Li(s,o.version.toTimestamp()),createTime:Li(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Nr(e.version)};else{if(!e.isUnknownDocument())return B();r.unknownDocument={path:t.path.toArray(),version:Nr(e.version)}}return r}function au(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Nr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function xr(n){let e=new Te(n.seconds,n.nanoseconds);return W.fromTimestamp(e)}function wr(n,e){let t=(e.baseMutations||[]).map(s=>kf(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>kf(n.ct,s)),i=Te.fromMillis(e.localWriteTimeMs);return new Uo(e.batchId,i,t,r)}function Co(n){let e=xr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?xr(n.lastLimboFreeSnapshotVersion):W.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),st(Yi(qE(s.documents[0])))}(n.query):function(s){return st(KE(s))}(n.query),new Ui(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ne.fromBase64String(n.resumeToken))}function YE(n,e){let t=Nr(e.snapshotVersion),r=Nr(e.lastLimboFreeSnapshotVersion),i;i=eu(e.target)?WE(n.ct,e.target):zE(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Rr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ap(n){let e=KE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?nu(e,e.limit,"L"):e}function Kd(n,e){return new Bo(e.largestBatchId,kf(n.ct,e.overlayMutation))}function Tw(n,e){let t=e.path.lastSegment();return[n,it(e.path.popLast()),t]}function Aw(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Nr(r.readTime),documentKey:it(r.documentKey.path),largestBatchId:r.largestBatchId}}var Df=class{getBundleMetadata(e,t){return Sw(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:xr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Sw(e).put(function(i){return{bundleId:i.id,createTime:Nr(Pe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Cw(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:ap(s.bundledQuery),readTime:xr(s.readTime)}}(r)})}saveNamedQuery(e,t){return Cw(e).put(function(i){return{name:i.name,readTime:Nr(Pe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Sw(n){return Le(n,"bundles")}function Cw(n){return Le(n,"namedQueries")}var lu=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Eo(e).get(Tw(this.userId,t)).next(r=>r?Kd(this.serializer,r):null)}getOverlays(e,t){let r=zt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Bo(t,o);i.push(this.ht(e,a))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(it(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Eo(e).j("collectionPathOverlayIndex",a))}),b.waitFor(s)}getOverlaysForCollection(e,t,r){let i=zt(),s=it(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Eo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Kd(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=zt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Eo(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{let m=Kd(this.serializer,c);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return Eo(e).put(function(i,s,o){let[a,u,c]=Tw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Wo(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Eo(n){return Le(n,"documentOverlays")}var Vf=class{Pt(e){return Le(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?Ne.fromUint8Array(r):Ne.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var ln=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(we(e.integerValue));else if("doubleValue"in e){let r=we(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Do(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=cn(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Wn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?dE(e)?this.dt(t,Number.MAX_SAFE_INTEGER):ju(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(we(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};ln.vt=new ln;function uR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function bw(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=uR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Of=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=bw(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=bw(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Ff=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Mf=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Er=class{constructor(){this.jt=new Of,this.Ht=new Ff(this.jt),this.Jt=new Mf(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Ir=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Fn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Rw(n.arrayValue,e.arrayValue),t!==0?t:(t=Rw(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function Rw(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var uu=class{constructor(e){this.Xt=new me((t,r)=>Re.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=rf(e);if(t!==void 0&&!this.sn(t))return!1;let r=yr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new me(Re.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Pi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Pi(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Pi(r.field,r.dir==="asc"?0:1)));return new Di(Di.UNKNOWN_ID,this.collectionId,t,ko.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function JE(n){var e,t;if(G(n instanceof re||n instanceof ce),n instanceof re){if(n instanceof Zl){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return ce.create(i,"or")}return n}let r=n.filters.map(i=>JE(i));return ce.create(r,n.op)}function cR(n){if(n.getFilters().length===0)return[];let e=Bf(JE(n));return G(XE(e)),Lf(e)||Uf(e)?[e]:e.getFilters()}function Lf(n){return n instanceof re}function Uf(n){return n instanceof ce&&np(n)}function XE(n){return Lf(n)||Uf(n)||function(t){if(t instanceof ce&&df(t)){for(let r of t.getFilters())if(!Lf(r)&&!Uf(r))return!1;return!0}return!1}(n)}function Bf(n){if(G(n instanceof re||n instanceof ce),n instanceof re)return n;if(n.filters.length===1)return Bf(n.filters[0]);let e=n.filters.map(r=>Bf(r)),t=ce.create(e,n.op);return t=cu(t),XE(t)?t:(G(t instanceof ce),G(Oi(t)),G(t.filters.length>1),t.filters.reduce((r,i)=>lp(r,i)))}function lp(n,e){let t;return G(n instanceof re||n instanceof ce),G(e instanceof re||e instanceof ce),t=n instanceof re?e instanceof re?function(i,s){return ce.create([i,s],"and")}(n,e):Pw(n,e):e instanceof re?Pw(e,n):function(i,s){if(G(i.filters.length>0&&s.filters.length>0),Oi(i)&&Oi(s))return _E(i,s.getFilters());let o=df(i)?i:s,a=df(i)?s:i,u=o.filters.map(c=>lp(c,a));return ce.create(u,"or")}(n,e),cu(t)}function Pw(n,e){if(Oi(e))return _E(e,n.getFilters());{let t=e.filters.map(r=>lp(n,r));return ce.create(t,"or")}}function cu(n){if(G(n instanceof re||n instanceof ce),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return cu(e[0]);if(pE(n))return n;let t=e.map(i=>cu(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof ce&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ce.create(r,n.op)}var qf=class{constructor(){this.un=new zo}addToCollectionParentIndex(e,t){return this.un.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(At.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(At.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},zo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new me(se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new me(se.comparator)).toArray()}};var Ol=new Uint8Array(0),jf=class{constructor(e,t){this.databaseId=t,this.cn=new zo,this.ln=new Jt(r=>Rr(r),(r,i)=>na(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:it(i)};return Nw(e).put(s)}return b.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[eE(t),""],!1,!0);return Nw(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Wt(o.parent))}return r})}addFieldIndex(e,t){let r=Io(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ei(e);return s.next(a=>{o.put(Aw(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Io(e),i=Ei(e),s=wi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Io(e),r=wi(e),i=Ei(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new uu(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=wi(e),i=!0,s=new Map;return b.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=X(),a=[];return b.forEach(s,(u,c)=>{V("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(u)} to execute ${Rr(t)}`);let d=function(F,K){let H=rf(K);if(H===void 0)return null;for(let Y of tu(F,H.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(c,u),m=function(F,K){let H=new Map;for(let Y of yr(K))for(let E of tu(F,Y.fieldPath))switch(E.op){case"==":case"in":H.set(Y.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return H.set(Y.fieldPath.canonicalString(),E.value),Array.from(H.values())}return null}(c,u),p=function(F,K){let H=[],Y=!0;for(let E of yr(K)){let _=E.kind===0?uw(F,E.fieldPath,F.startAt):cw(F,E.fieldPath,F.startAt);H.push(_.value),Y&&(Y=_.inclusive)}return new Yt(H,Y)}(c,u),y=function(F,K){let H=[],Y=!0;for(let E of yr(K)){let _=E.kind===0?cw(F,E.fieldPath,F.endAt):uw(F,E.fieldPath,F.endAt);H.push(_.value),Y&&(Y=_.inclusive)}return new Yt(H,Y)}(c,u),S=this.In(u,c,p),N=this.In(u,c,y),x=this.Tn(u,c,m),q=this.En(u.indexId,d,S,p.inclusive,N,y.inclusive,x);return b.forEach(q,j=>r.G(j,t.limit).next(F=>{F.forEach(K=>{let H=U.fromSegments(K.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return b.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=cR(ce.create(e.filters,"and")).map(r=>Ef(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),d=[];for(let m=0;m<u;++m){let p=t?this.dn(t[m/c]):Ol,y=this.An(e,p,r[m%c],i),S=this.Rn(e,p,s[m%c],o),N=a.map(x=>this.An(e,p,x,!0));d.push(...this.createRange(y,S,N))}return d}An(e,t,r,i){let s=new Ir(e,U.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new Ir(e,U.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new uu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return b.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new me(Re.comparator),d=!1;for(let m of u.filters)for(let p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:c=c.add(p.field));for(let m of u.orderBy)m.field.isKeyField()||(c=c.add(m.field));return c.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new Er;for(let i of yr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);ln.vt.It(s,o)}return r.zt()}dn(e){let t=new Er;return ln.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new Er;return ln.vt.It(Cr(this.databaseId,t),r.Yt(function(s){let o=yr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new Er);let s=0;for(let o of yr(e)){let a=r[s++];for(let u of i)if(this.fn(t,o.fieldPath)&&Mo(a))i=this.gn(i,o,a);else{let c=u.Yt(o.kind);ln.vt.It(a,c)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Er;u.seed(a.zt()),ln.vt.It(o,u.Yt(t.kind)),s.push(u)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Io(e),i=Ei(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return b.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(d,m){let p=m?new ko(m.sequenceNumber,new At(xr(m.readTime),new U(Wt(m.documentKey)),m.largestBatchId)):ko.empty(),y=d.fields.map(([S,N])=>new Pi(Re.fromServerFormat(S),N));return new Di(d.indexId,d.collectionGroup,y,p)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Q(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Io(e),s=Ei(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,u=>s.put(Aw(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return b.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),b.forEach(a,u=>this.wn(e,i,u).next(c=>{let d=this.Sn(s,u);return c.isEqual(d)?b.resolve():this.bn(e,s,u,c,d)}))))})}Dn(e,t,r,i){return wi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return wi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=wi(e),s=new me(Fn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new Ir(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new me(Fn),i=this.Vn(t,e);if(i==null)return r;let s=rf(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Mo(o))for(let a of o.arrayValue.values||[])r=r.add(new Ir(t.indexId,e.key,this.dn(a),i))}else r=r.add(new Ir(t.indexId,e.key,Ol,i));return r}bn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,d,m,p){let y=u.getIterator(),S=c.getIterator(),N=vi(y),x=vi(S);for(;N||x;){let q=!1,j=!1;if(N&&x){let F=d(N,x);F<0?j=!0:F>0&&(q=!0)}else N!=null?j=!0:q=!0;q?(m(x),x=vi(S)):j?(p(N),N=vi(y)):(N=vi(y),x=vi(S))}}(i,s,Fn,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),b.waitFor(o)}yn(e){let t=1;return Ei(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Fn(o,a)).filter((o,a,u)=>!a||Fn(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Fn(o,e),u=Fn(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&u<0)i.push(o),i.push(o.Zt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ol,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ol,[]];s.push(IDBKeyRange.bound(a,u))}return s}Cn(e,t){return Fn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xw)}getMinOffset(e,t){return b.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||B())).next(xw)}};function Nw(n){return Le(n,"collectionParents")}function wi(n){return Le(n,"indexEntries")}function Io(n){return Le(n,"indexConfiguration")}function Ei(n){return Le(n,"indexState")}function xw(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Xm(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new At(e.readTime,e.documentKey,t)}var kw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},It=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function ZE(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(d,m,p)=>(a++,p.delete()));s.push(u.next(()=>{G(a===1)}));let c=[];for(let d of t.mutations){let m=oE(e,d.key.path,t.batchId);s.push(i.delete(m)),c.push(d.key)}return b.waitFor(s).next(()=>c)}function hu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}It.DEFAULT_COLLECTION_PERCENTILE=10,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,It.DEFAULT=new It(41943040,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),It.DISABLED=new It(-1,0,0);var du=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=bi(e),o=Mn(e);return o.add({}).next(a=>{G(typeof a=="number");let u=new Uo(a,t,r,i),c=function(y,S,N){let x=N.baseMutations.map(j=>Wo(y.ct,j)),q=N.mutations.map(j=>Wo(y.ct,j));return{userId:S,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:x,mutations:q}}(this.serializer,this.userId,u),d=[],m=new me((p,y)=>Q(p.canonicalString(),y.canonicalString()));for(let p of i){let y=oE(this.userId,p.key.path,a);m=m.add(p.key.path.popLast()),d.push(o.put(c)),d.push(s.put(y,gb))}return m.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),b.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return Mn(e).get(t).next(r=>r?(G(r.userId===this.userId),wr(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?b.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Mn(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(G(a.batchId>=r),s=wr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Mn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).U("userMutationsIndex",t).next(r=>r.map(i=>wr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ul(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return bi(e).J({range:i},(o,a,u)=>{let[c,d,m]=o,p=Wt(d);if(c===this.userId&&t.path.isEqual(p))return Mn(e).get(m).next(y=>{if(!y)throw B();G(y.userId===this.userId),s.push(wr(this.serializer,y))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new me(Q),i=[];return t.forEach(s=>{let o=Ul(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=bi(e).J({range:a},(c,d,m)=>{let[p,y,S]=c,N=Wt(y);p===this.userId&&s.path.isEqual(N)?r=r.add(S):m.done()});i.push(u)}),b.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ul(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new me(Q);return bi(e).J({range:o},(u,c,d)=>{let[m,p,y]=u,S=Wt(p);m===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Mn(e).get(s).next(o=>{if(o===null)throw B();G(o.userId===this.userId),r.push(wr(this.serializer,o))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return ZE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return bi(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=Wt(s[1]);i.push(u)}else a.done()}).next(()=>{G(i.length===0)})})}containsKey(e,t){return eI(e,this.userId,t)}Nn(e){return tI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function eI(n,e,t){let r=Ul(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return bi(n).J({range:s,H:!0},(a,u,c)=>{let[d,m,p]=a;d===e&&m===i&&(o=!0),c.done()}).next(()=>o)}function Mn(n){return Le(n,"mutations")}function bi(n){return Le(n,"documentMutations")}function tI(n){return Le(n,"mutationQueues")}var Bi=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Gf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new Bi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>W.fromTimestamp(new Te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ii(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(G(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ii(e).J((o,a)=>{let u=Co(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ii(e).J((r,i)=>{let s=Co(i);t(s)})}qn(e){return Dw(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return Dw(e).put("targetGlobalKey",t)}Kn(e,t){return Ii(e).put(YE(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Rr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ii(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=Co(a);na(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Ln(e);return t.forEach(o=>{let a=it(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),b.waitFor(i)}removeMatchingKeys(e,t,r){let i=Ln(e);return b.forEach(t,s=>{let o=it(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Ln(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ln(e),s=X();return i.J({range:r,H:!0},(o,a,u)=>{let c=Wt(o[1]),d=new U(c);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=it(t.path),i=IDBKeyRange.bound([r],[eE(r)],!1,!0),s=0;return Ln(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return Ii(e).get(t).next(r=>r?Co(r):null)}};function Ii(n){return Le(n,"targets")}function Dw(n){return Le(n,"targetGlobal")}function Ln(n){return Le(n,"targetDocuments")}function Vw([n,e],[t,r]){let i=Q(n,t);return i===0?Q(e,r):i}var Wf=class{constructor(e){this.Un=e,this.buffer=new me(Vw),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Vw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},zf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>k(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Zn(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Xn(t)}yield this.Hn(3e5)}))}},Kf=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return b.resolve(mt.oe);let r=new Wf(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(kw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kw):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,u,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(c=Date.now(),Ti()<=yt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${m} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function hR(n,e){return new Kf(n,e)}var $f=class{constructor(e,t){this.db=e,this.garbageCollector=hR(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return Fl(e,r)}removeReference(e,t,r){return Fl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Fl(e,t)}nr(e,t){return function(i,s){let o=!1;return tI(i).Y(a=>eI(i,a,s).next(u=>(u&&(o=!0),b.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let u=this.nr(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,W.min()),Ln(e).delete(function(m){return[0,it(m.path)]}(o))))});i.push(u)}}).next(()=>b.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Fl(e,t)}tr(e,t){let r=Ln(e),i,s=mt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==mt.oe&&t(new U(Wt(i)),s),s=c,i=u):s=mt.oe}).next(()=>{s!==mt.oe&&t(new U(Wt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Fl(n,e){return Ln(n).put(function(r,i){return{targetId:0,path:it(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var fu=class{constructor(){this.changes=new Jt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Qf=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return _r(e).put(r)}removeEntry(e,t,r){return _r(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],au(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Fe.newInvalidDocument(t);return _r(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(To(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Fe.newInvalidDocument(t)};return _r(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(To(t))},(i,s)=>{r={document:this.ir(t,s),size:hu(s)}}).next(()=>r)}getEntries(e,t){let r=lt();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=lt(),i=new ye(U.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,hu(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return b.resolve();let i=new me(Mw);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(To(i.first()),To(i.last())),o=i.getIterator(),a=o.getNext();return _r(e).J({index:"documentKeyIndex",range:s},(u,c,d)=>{let m=U.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Mw(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(To(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),au(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _r(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let d=lt();for(let m of c){let p=this.ir(U.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(ia(t,p)||i.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=lt(),o=Fw(t,r),a=Fw(t,At.max());return _r(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{let m=this.ir(U.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(m.key,m),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Hf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ow(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return Ow(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=lR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(W.min())))return r}return Fe.newInvalidDocument(e)}};function nI(n){return new Qf(n)}var Hf=class extends fu{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Jt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new me((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=Iw(this.cr.serializer,o);i=i.add(s.path.popLast());let c=hu(u);r+=c-a.size,t.push(this.cr.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=Iw(this.cr.serializer,o.convertToNoDocument(W.min()));t.push(this.cr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Ow(n){return Le(n,"remoteDocumentGlobal")}function _r(n){return Le(n,"remoteDocumentsV14")}function To(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Fw(n,e){let t=e.documentKey.path.toArray();return[n,au(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Mw(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Q(t[s],r[s]),i)return i;return i=Q(t.length,r.length),i||(i=Q(t[t.length-2],r[r.length-2]),i||Q(t[t.length-1],r[r.length-1]))}var Yf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var mu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Po(r.mutation,i,pt.empty(),Te.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){let i=zt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=So();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=zt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=lt(),o=Ro(),a=function(){return Ro()}();return t.forEach((u,c)=>{let d=r.get(c.key);i.has(c.key)&&(d===void 0||d.mutation instanceof Nt)?s=s.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Po(d.mutation,c,d.mutation.getFieldMask(),Te.now())):o.set(c.key,pt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var m;return a.set(c,new Yf(d,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Ro(),i=new ye((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let d=r.get(u)||pt.empty();d=a.applyToLocalView(c,d),r.set(u,d);let m=(i.get(a.batchId)||X()).add(u);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,d=u.value,m=CE();d.forEach(p=>{if(!s.has(p)){let y=DE(t.get(p),r.get(p));y!==null&&m.set(p,y),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return b.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(zt()),a=-1,u=s;return o.next(c=>b.forEach(c,(d,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(d)?b.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,X())).next(d=>({batchId:a,changes:SE(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=So();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=So();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,u=>{let c=function(m,p){return new Pt(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(d=>{d.forEach((m,p)=>{o=o.insert(m,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let d=c.getKey();o.get(d)===null&&(o=o.insert(d,Fe.newInvalidDocument(d)))});let a=So();return o.forEach((u,c)=>{let d=s.get(u);d!==void 0&&Po(d.mutation,c,pt.empty(),Te.now()),ia(t,c)&&(a=a.insert(u,c))}),a})}};var Jf=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return b.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Pe(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:ap(i.bundledQuery),readTime:Pe(i.readTime)}}(t)),b.resolve()}};var Xf=class{constructor(){this.overlays=new ye(U.comparator),this.Ir=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let r=zt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){let i=zt(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ye((c,d)=>c-d),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=s.get(c.largestBatchId);d===null&&(d=zt(),s=s.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let a=zt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=i)););return b.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Bo(t,r));let s=this.Ir.get(t);s===void 0&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Zf=class{constructor(){this.sessionToken=Ne.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var Ko=class{constructor(){this.Tr=new me(De.Er),this.dr=new me(De.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new De(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new De(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new U(new se([])),r=new De(t,e),i=new De(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new se([])),r=new De(t,e),i=new De(t,e+1),s=X();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new De(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},De=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||U.comparator(e.key,t.key)}};var em=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new me(De.Er)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Uo(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new De(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new De(t,0),i=new De(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new me(Q);return t.forEach(i=>{let s=new De(i,0),o=new De(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),b.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new De(new U(s),0),a=new me(Q);return this.br.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.wr)),!0)},o),b.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return b.forEach(t.mutations,i=>{let s=new De(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new De(t,0),i=this.br.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var tm=class{constructor(e){this.Mr=e,this.docs=function(){return new ye(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Fe.newInvalidDocument(t))}getEntries(e,t){let r=lt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Fe.newInvalidDocument(i))}),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=lt(),o=t.path,a=new U(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Xm(nE(d),r)<=0||(i.has(d.key)||ia(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}Or(e,t){return b.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new nm(this)}getSize(e){return b.resolve(this.size)}},nm=class extends fu{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),b.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var rm=class{constructor(e){this.persistence=e,this.Nr=new Jt(t=>Rr(t),na),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ko,this.targetCount=0,this.kr=Bi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),b.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Bi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Kn(t),b.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.Br.containsKey(t))}};var pu=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new mt(0),this.Kr=!1,this.Kr=!0,this.$r=new Zf,this.referenceDelegate=e(this),this.Ur=new rm(this),this.indexManager=new qf,this.remoteDocumentCache=function(i){return new tm(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new ou(t),this.Gr=new Jf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Xf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new em(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new im(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return b.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},im=class extends Ql{constructor(e){super(),this.currentSequenceNumber=e}},gu=class n{constructor(e){this.persistence=e,this.Jr=new Ko,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),b.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,r=>{let i=U.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,W.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return b.or([()=>b.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var sm=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Hl("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0}),u.createObjectStore("documentMutations")}(e),Lw(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Lw(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:W.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0});let m=c.store("mutations"),p=d.map(y=>m.put(y));return b.waitFor(p)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:Rb});c.createIndex("collectionPathOverlayIndex",Pb,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Nb,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:_b});c.createIndex("documentKeyIndex",yb),c.createIndex("collectionGroupIndex",vb)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Ab}).createIndex("sequenceNumberIndex",Sb,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Cb}).createIndex("documentKeyIndex",bb,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=hu(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>b.forEach(a,u=>{G(u.userId===s.userId);let c=wr(this.serializer,u);return ZE(e,s.userId,c).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new se(o),c=function(m){return[0,it(m)]}(u);s.push(t.get(c).next(d=>d?b.resolve():(m=>t.put({targetId:0,path:it(m),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>b.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Tb});let r=t.store("collectionParents"),i=new zo,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:it(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new se(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let d=Wt(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Co(i),o=YE(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(m){return m.document?new U(se.fromString(m.document.name).popFirst(5)):m.noDocument?U.fromSegments(m.noDocument.path):m.unknownDocument?U.fromSegments(m.unknownDocument.path):B()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>b.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=nI(this.serializer),s=new pu(gu.Zr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let d=(c=a.get(u.userId))!==null&&c!==void 0?c:X();wr(this.serializer,u).keys().forEach(m=>d=d.add(m)),a.set(u.userId,d)}),b.forEach(a,(u,c)=>{let d=new Ve(c),m=lu.lt(this.serializer,d),p=s.getIndexManager(d),y=du.lt(d,this.serializer,p,s.referenceDelegate);return new mu(i,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Vo(t,mt.oe),u).next()})})}};function Lw(n){n.createObjectStore("targetDocuments",{keyPath:Eb}).createIndex("documentTargetsIndex",Ib,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",wb,{unique:!0}),n.createObjectStore("targetGlobal")}var $d="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",om=class n{constructor(e,t,r,i,s,o,a,u,c,d,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!n.D())throw new D(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $f(this,i),this.Ai=t+"main",this.serializer=new ou(u),this.Ri=new Gn(this.Ai,this.hi,new sm(this.serializer)),this.$r=new Vf,this.Ur=new Gf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nI(this.serializer),this.Gr=new Df,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&be("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,$d);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new mt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>k(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>k(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>k(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ml(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Zn(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ao(e).get("owner").next(t=>b.resolve(this.vi(t)))}Ci(e){return Ml(e).delete(this.clientId)}Fi(){return k(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Le(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?b.resolve(!0):Ao(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,$d);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ml(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return k(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Vo(e,mt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Ml(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return du.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new jf(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lu.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?Db:u===16?kb:u===15?ep:u===14?uE:u===13?lE:u===12?xb:u===11?aE:void B()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new Vo(a,this.Qr?this.Qr.next():mt.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(R.FAILED_PRECONDITION,rE);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Ao(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(R.FAILED_PRECONDITION,$d)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ao(e).put("owner",t)}static D(){return Gn.D()}bi(e){let t=Ao(e);return t.get("owner").next(r=>this.vi(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(be(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;Dc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return be("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){be("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ao(n){return Le(n,"owner")}function Ml(n){return Le(n,"clientMetadata")}function up(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var am=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=X(),i=X();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var lm=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var _u=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Dc()?8:iE(Rs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new lm;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Ti()<=yt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Ai(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(Ti()<=yt.DEBUG&&V("QueryEngine","Query:",Ai(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Ti()<=yt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Ai(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,st(t))):b.resolve())}Yi(e,t){if(hw(t))return b.resolve(null);let r=st(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=nu(t,null,"F"),r=st(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=X(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,nu(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,r,i){return hw(t)||i.isEqual(W.min())?b.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?b.resolve(null):(Ti()<=yt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ai(t)),this.rs(e,o,t,tE(i,-1)).next(a=>a))})}ts(e,t){let r=new me(TE(e));return t.forEach((i,s)=>{ia(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Ti()<=yt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Ai(t)),this.Ji.getDocumentsMatchingQuery(e,t,At.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var um=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new ye(Q),this._s=new Jt(s=>Rr(s),na),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mu(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function rI(n,e,t,r){return new um(n,e,t,r)}function iI(n,e){return k(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=X();for(let c of i){o.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}for(let c of s){a.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})})}function dR(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){let m=c.batch,p=m.keys(),y=b.resolve();return p.forEach(S=>{y=y.next(()=>d.getEntry(u,S)).next(N=>{let x=c.docVersions.get(S);G(x!==null),N.version.compareTo(x)<0&&(m.applyToRemoteDocument(N,c),N.isValidDocument()&&(N.setReadTime(c.commitVersion),d.addEntry(N)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(u,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=X();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function sI(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function fR(n,e){let t=L(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((d,m)=>{let p=i.get(m);if(!p)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,m)));let y=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Ne.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(m,y),function(N,x,q){return N.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(p,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let u=lt(),c=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(oI(s,o,e.documentUpdates).next(d=>{u=d.Ps,c=d.Is})),!r.isEqual(W.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.os=i,s))}function oI(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=lt();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(W.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function mR(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function qi(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,b.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new Ui(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function ji(n,e,t){return k(this,null,function*(){let r=L(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Zn(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function yu(n,e,t){let r=L(n),i=W.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){let m=L(u),p=m._s.get(d);return p!==void 0?b.resolve(m.os.get(p)):m.Ur.getTargetData(c,d)}(r,o,st(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:W.min(),t?s:X())).next(a=>(uI(r,IE(e),a),{documents:a,Ts:s})))}function aI(n,e){let t=L(n),r=L(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function lI(n,e){let t=L(n),r=t.us.get(e)||W.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,tE(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(uI(t,e,i),i))}function uI(n,e,t){let r=n.us.get(e)||W.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function pR(n,e,t,r){return k(this,null,function*(){let i=L(n),s=X(),o=lt();for(let c of t){let d=e.Es(c.metadata.name);c.document&&(s=s.add(d));let m=e.ds(c);m.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,m)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),u=yield qi(i,function(d){return st(Yi(se.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>oI(c,a,o).next(d=>(a.apply(c),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Ur.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))})}function gR(r,i){return k(this,arguments,function*(n,e,t=X()){let s=yield qi(n,st(ap(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=Pe(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(a,e);let c=s.withResumeToken(Ne.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(c.targetId,c),o.Ur.updateTargetData(a,c).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function Uw(n,e){return`firestore_clients_${n}_${e}`}function Bw(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Qd(n,e){return`firestore_targets_${n}_${e}`}var vu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new D(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(be("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},No=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new D(r.error.code,r.error.message))),s?new n(e,r.state,i):(be("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},wu=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=ip();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=sE(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(be("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},cm=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(be("SharedClientState",`Failed to parse online state: ${e}`),null)}},$o=class{constructor(){this.activeTargetIds=ip()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},xo=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ye(Q),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Uw(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new $o),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return k(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(Uw(this.persistenceKey,r));if(i){let s=wu.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Qd(this.persistenceKey,e));if(r){let i=No.Rs(e,r);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Qd(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void be("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>k(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=mt.oe;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){be("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==mt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new vu(this.currentUser,e,t,r),s=Bw(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=Bw(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=Qd(this.persistenceKey,e),s=new No(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return wu.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return vu.Rs(new Ve(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return No.Rs(i,t)}Ls(e){return cm.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return k(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=ip();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Eu=class{constructor(){this.so=new $o,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new $o,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var hm=class{_o(e){}shutdown(){}};var Iu=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ll=null;function Hd(){return Ll===null?Ll=function(){return 268435456+Math.round(2147483648*Math.random())}():Ll++,"0x"+Ll.toString(16)}var _R={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var dm=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ye="WebChannelConnection",fm=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=Hd(),u=this.xo(t,r.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,s,o),this.No(t,u,c,i).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Tt("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",i),d})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Hi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=_R[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=Hd();return new Promise((o,a)=>{let u=new Bd;u.setWithCredentials(!0),u.listenOnce(jd.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case wo.NO_ERROR:let d=u.getResponseJson();V(Ye,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case wo.TIMEOUT:V(Ye,`RPC '${e}' ${s} timed out`),a(new D(R.DEADLINE_EXCEEDED,"Request time out"));break;case wo.HTTP_ERROR:let m=u.getStatus();if(V(Ye,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);let y=p?.error;if(y&&y.status&&y.message){let S=function(x){let q=x.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(q)>=0?q:R.UNKNOWN}(y.status);a(new D(S,y.message))}else a(new D(R.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new D(R.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(Ye,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);V(Ye,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Bo(e,t,r){let i=Hd(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zd(),a=Wd(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new qd({})),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=s.join("");V(Ye,`Creating RPC '${e}' stream ${i}: ${d}`,u);let m=o.createWebChannel(d,u),p=!1,y=!1,S=new dm({Io:x=>{y?V(Ye,`Not sending because RPC '${e}' stream ${i} is closed:`,x):(p||(V(Ye,`Opening RPC '${e}' stream ${i} transport.`),m.open(),p=!0),V(Ye,`RPC '${e}' stream ${i} sending:`,x),m.send(x))},To:()=>m.close()}),N=(x,q,j)=>{x.listen(q,F=>{try{j(F)}catch(K){setTimeout(()=>{throw K},0)}})};return N(m,yi.EventType.OPEN,()=>{y||(V(Ye,`RPC '${e}' stream ${i} transport opened.`),S.yo())}),N(m,yi.EventType.CLOSE,()=>{y||(y=!0,V(Ye,`RPC '${e}' stream ${i} transport closed`),S.So())}),N(m,yi.EventType.ERROR,x=>{y||(y=!0,Tt(Ye,`RPC '${e}' stream ${i} transport errored:`,x),S.So(new D(R.UNAVAILABLE,"The operation could not be completed")))}),N(m,yi.EventType.MESSAGE,x=>{var q;if(!y){let j=x.data[0];G(!!j);let F=j,K=F.error||((q=F[0])===null||q===void 0?void 0:q.error);if(K){V(Ye,`RPC '${e}' stream ${i} received error:`,K);let H=K.status,Y=function(w){let I=ke[w];if(I!==void 0)return FE(I)}(H),E=K.message;Y===void 0&&(Y=R.INTERNAL,E="Unknown error status: "+H+" with message "+K.message),y=!0,S.So(new D(Y,E)),m.close()}else V(Ye,`RPC '${e}' stream ${i} received:`,j),S.bo(j)}}),N(a,Gd.STAT_EVENT,x=>{x.stat===Vl.PROXY?V(Ye,`RPC '${e}' stream ${i} detected buffering proxy`):x.stat===Vl.NOPROXY&&V(Ye,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}};function cI(){return typeof window<"u"?window:null}function Gl(){return typeof document<"u"?document:null}function sa(n){return new Rf(n,!0)}var Qo=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Tu=class{constructor(e,t,r,i,s,o,a,u){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Qo(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return k(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return k(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return k(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(be(t.toString()),be("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new D(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>k(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},mm=class extends Tu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=tR(this.serializer,e),r=function(s){if(!("targetChange"in s))return W.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?W.min():o.readTime?Pe(o.readTime):W.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=xf(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=eu(u)?{documents:WE(s,u)}:{query:zE(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=LE(s,o.resumeToken);let c=Pf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(W.min())>0){a.readTime=Li(s,o.snapshotVersion.toTimestamp());let c=Pf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=rR(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=xf(this.serializer),t.removeTarget=e,this.a_(t)}},pm=class extends Tu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=nR(e.writeResults,e.commitTime),r=Pe(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=xf(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Wo(this.serializer,r))};this.a_(t)}};var gm=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Nf(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(R.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Nf(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(R.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},_m=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(be(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var ym=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>k(this,null,function*(){er(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(u){return k(this,null,function*(){let c=L(u);c.L_.add(4),yield Ji(c),c.q_.set("Unknown"),c.L_.delete(4),yield oa(c)})}(this))}))}),this.q_=new _m(r,i)}};function oa(n){return k(this,null,function*(){if(er(n))for(let e of n.B_)yield e(!0)})}function Ji(n){return k(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Gu(n,e){let t=L(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),dp(t)?hp(t):Zi(t).r_()&&cp(t,e))}function Gi(n,e){let t=L(n),r=Zi(t);t.N_.delete(e),r.r_()&&hI(t,e),t.N_.size===0&&(r.r_()?r.o_():er(t)&&t.q_.set("Unknown"))}function cp(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Zi(n).A_(e)}function hI(n,e){n.Q_.xe(e),Zi(n).R_(e)}function hp(n){n.Q_=new bf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Zi(n).start(),n.q_.v_()}function dp(n){return er(n)&&!Zi(n).n_()&&n.N_.size>0}function er(n){return L(n).L_.size===0}function dI(n){n.Q_=void 0}function yR(n){return k(this,null,function*(){n.q_.set("Online")})}function vR(n){return k(this,null,function*(){n.N_.forEach((e,t)=>{cp(n,e)})})}function wR(n,e){return k(this,null,function*(){dI(n),dp(n)?(n.q_.M_(e),hp(n)):n.q_.set("Unknown")})}function ER(n,e,t){return k(this,null,function*(){if(n.q_.set("Online"),e instanceof iu&&e.state===2&&e.cause)try{yield function(i,s){return k(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Au(n,r)}else if(e instanceof xi?n.Q_.Ke(e):e instanceof ru?n.Q_.He(e):n.Q_.We(e),!t.isEqual(W.min()))try{let r=yield sI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.N_.get(c);d&&s.N_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let d=s.N_.get(u);if(!d)return;s.N_.set(u,d.withResumeToken(Ne.EMPTY_BYTE_STRING,d.snapshotVersion)),hI(s,u);let m=new Ui(d.target,u,c,d.sequenceNumber);cp(s,m)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield Au(n,r)}})}function Au(n,e,t){return k(this,null,function*(){if(!Zn(e))throw e;n.L_.add(1),yield Ji(n),n.q_.set("Offline"),t||(t=()=>sI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>k(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield oa(n)}))})}function fI(n,e){return e().catch(t=>Au(n,t,e))}function Xi(n){return k(this,null,function*(){let e=L(n),t=Jn(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;IR(e);)try{let i=yield mR(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,TR(e,i)}catch(i){yield Au(e,i)}mI(e)&&pI(e)})}function IR(n){return er(n)&&n.O_.length<10}function TR(n,e){n.O_.push(e);let t=Jn(n);t.r_()&&t.V_&&t.m_(e.mutations)}function mI(n){return er(n)&&!Jn(n).n_()&&n.O_.length>0}function pI(n){Jn(n).start()}function AR(n){return k(this,null,function*(){Jn(n).p_()})}function SR(n){return k(this,null,function*(){let e=Jn(n);for(let t of n.O_)e.m_(t.mutations)})}function CR(n,e,t){return k(this,null,function*(){let r=n.O_.shift(),i=Af.from(r,e,t);yield fI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Xi(n)})}function bR(n,e){return k(this,null,function*(){e&&Jn(n).V_&&(yield function(r,i){return k(this,null,function*(){if(function(o){return OE(o)&&o!==R.ABORTED}(i.code)){let s=r.O_.shift();Jn(r).s_(),yield fI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Xi(r)}})}(n,e)),mI(n)&&pI(n)})}function qw(n,e){return k(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=er(t);t.L_.add(3),yield Ji(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield oa(t)})}function vm(n,e){return k(this,null,function*(){let t=L(n);e?(t.L_.delete(2),yield oa(t)):e||(t.L_.add(2),yield Ji(t),t.q_.set("Unknown"))})}function Zi(n){return n.K_||(n.K_=function(t,r,i){let s=L(t);return s.w_(),new mm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:yR.bind(null,n),Ro:vR.bind(null,n),mo:wR.bind(null,n),d_:ER.bind(null,n)}),n.B_.push(e=>k(this,null,function*(){e?(n.K_.s_(),dp(n)?hp(n):n.q_.set("Unknown")):(yield n.K_.stop(),dI(n))}))),n.K_}function Jn(n){return n.U_||(n.U_=function(t,r,i){let s=L(t);return s.w_(),new pm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:AR.bind(null,n),mo:bR.bind(null,n),f_:SR.bind(null,n),g_:CR.bind(null,n)}),n.B_.push(e=>k(this,null,function*(){e?(n.U_.s_(),yield Xi(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var wm=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Oe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function es(n,e){if(be("AsyncQueue",`${e}: ${n}`),Zn(n))return new D(R.UNAVAILABLE,`${e}: ${n}`);throw n}var Su=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=So(),this.sortedSet=new ye(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Cu=class{constructor(){this.W_=new ye(U.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},Wi=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Su.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ra(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Em=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Im=class{constructor(){this.queries=jw(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=L(t),s=i.queries;i.queries=jw(),s.forEach((o,a)=>{for(let u of a.j_)u.onError(r)})})(this,new D(R.ABORTED,"Firestore shutting down"))}};function jw(){return new Jt(n=>EE(n),ra)}function fp(n,e){return k(this,null,function*(){let t=L(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Em,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=es(o,`Initialization of query '${Ai(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&pp(t)})}function mp(n,e){return k(this,null,function*(){let t=L(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function RR(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&pp(t)}function PR(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function pp(n){n.Y_.forEach(e=>{e.next()})}var Tm,Gw;(Gw=Tm||(Tm={})).ea="default",Gw.Cache="cache";var Ho=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Wi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Wi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Tm.Cache}};var Am=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var bu=class{constructor(e){this.serializer=e}Es(e){return $t(this.serializer,e)}ds(e){return e.metadata.exists?GE(this.serializer,e.document,!1):Fe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Pe(e)}},Sm=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=gI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=se.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new bu(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){return k(this,null,function*(){let e=yield pR(this.localStore,new bu(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield gR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function gI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Ru=class{constructor(e){this.key=e}},Pu=class{constructor(e){this.key=e}},Nu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=TE(e),this.Ra=new Su(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new Cu,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{let p=i.get(d),y=ia(this.query,m)?m:null,S=!!p&&this.mutatedKeys.has(p.key),N=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),x=!1;p&&y?p.data.isEqual(y.data)?S!==N&&(r.track({type:3,doc:y}),x=!0):this.ga(p,y)||(r.track({type:2,doc:y}),x=!0,(u&&this.Aa(y,u)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!p&&y?(r.track({type:0,doc:y}),x=!0):p&&!y&&(r.track({type:1,doc:p}),x=!0,(u||c)&&(a=!0)),x&&(y?(o=o.add(y),s=N?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,m)=>function(y,S){let N=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return N(y)-N(S)}(d.type,m.type)||this.Aa(d.doc,m.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new Wi(this.query,e.Ra,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Cu,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=X(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Pu(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Ru(r))}),t}ba(e){this.Ta=e.Ts,this.da=X();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Wi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Cm=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},bm=class{constructor(e){this.key=e,this.va=!1}},Rm=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Jt(a=>EE(a),ra),this.Ma=new Map,this.xa=new Set,this.Oa=new ye(U.comparator),this.Na=new Map,this.La=new Ko,this.Ba={},this.ka=new Map,this.qa=Bi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function NR(n,e,t=!0){return k(this,null,function*(){let r=Wu(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield _I(r,e,t,!0),i})}function xR(n,e){return k(this,null,function*(){let t=Wu(n);yield _I(t,e,!0,!1)})}function _I(n,e,t,r){return k(this,null,function*(){let i=yield qi(n.localStore,st(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield gp(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Gu(n.remoteStore,i),a})}function gp(n,e,t,r,i){return k(this,null,function*(){n.Ka=(m,p,y)=>function(N,x,q,j){return k(this,null,function*(){let F=x.view.ma(q);F.ns&&(F=yield yu(N.localStore,x.query,!1).then(({documents:E})=>x.view.ma(E,F)));let K=j&&j.targetChanges.get(x.targetId),H=j&&j.targetMismatches.get(x.targetId)!=null,Y=x.view.applyChanges(F,N.isPrimaryClient,K,H);return Pm(N,x.targetId,Y.wa),Y.snapshot})}(n,m,p,y);let s=yield yu(n.localStore,e,!0),o=new Nu(e,s.Ts),a=o.ma(s.documents),u=jo.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Pm(n,t,c.wa);let d=new Cm(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot})}function kR(n,e,t){return k(this,null,function*(){let r=L(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!ra(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ji(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Gi(r.remoteStore,i.targetId),zi(r,i.targetId)}).catch(Xn))):(zi(r,i.targetId),yield ji(r.localStore,i.targetId,!0))})}function DR(n,e){return k(this,null,function*(){let t=L(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Gi(t.remoteStore,r.targetId))})}function VR(n,e,t){return k(this,null,function*(){let r=wp(n);try{let i=yield function(o,a){let u=L(o),c=Te.now(),d=a.reduce((y,S)=>y.add(S.key),X()),m,p;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let S=lt(),N=X();return u.cs.getEntries(y,d).next(x=>{S=x,S.forEach((q,j)=>{j.isValidDocument()||(N=N.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,S)).next(x=>{m=x;let q=[];for(let j of a){let F=Qb(j,m.get(j.key).overlayedDocument);F!=null&&q.push(new Nt(j.key,F,mE(F.value.mapValue),Se.exists(!0)))}return u.mutationQueue.addMutationBatch(y,c,q,a)}).next(x=>{p=x;let q=x.applyToLocalDocumentSet(m,N);return u.documentOverlayCache.saveOverlays(y,x.batchId,q)})}).then(()=>({batchId:p.batchId,changes:SE(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new ye(Q)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(r,i.batchId,t),yield pn(r,i.changes),yield Xi(r.remoteStore)}catch(i){let s=es(i,"Failed to persist write");t.reject(s)}})}function yI(n,e){return k(this,null,function*(){let t=L(n);try{let r=yield fR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?G(o.va):i.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield pn(t,r,e)}catch(r){yield Xn(r)}})}function Ww(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=L(o);u.onlineState=a;let c=!1;u.queries.forEach((d,m)=>{for(let p of m.j_)p.Z_(a)&&(c=!0)}),c&&pp(u)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function OR(n,e,t){return k(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new ye(U.comparator);o=o.insert(s,Fe.newNoDocument(s,W.min()));let a=X().add(s),u=new qo(W.min(),new Map,new ye(Q),o,a);yield yI(r,u),r.Oa=r.Oa.remove(s),r.Na.delete(e),vp(r)}else yield ji(r.localStore,e,!1).then(()=>zi(r,e,t)).catch(Xn)})}function FR(n,e){return k(this,null,function*(){let t=L(n),r=e.batch.batchId;try{let i=yield dR(t.localStore,e);yp(t,r,null),_p(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield pn(t,i)}catch(i){yield Xn(i)}})}function MR(n,e,t){return k(this,null,function*(){let r=L(n);try{let i=yield function(o,a){let u=L(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(m=>(G(m!==null),d=m.keys(),u.mutationQueue.removeMutationBatch(c,m))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(r.localStore,e);yp(r,e,t),_p(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield pn(r,i)}catch(i){yield Xn(i)}})}function LR(n,e){return k(this,null,function*(){let t=L(n);er(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=es(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function _p(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function yp(n,e,t){let r=L(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function zi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||vI(n,r)})}function vI(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Gi(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),vp(n))}function Pm(n,e,t){for(let r of t)r instanceof Ru?(n.La.addReference(r.key,e),UR(n,r)):r instanceof Pu?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||vI(n,r.key)):B()}function UR(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(r),vp(n))}function vp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new U(se.fromString(e)),r=n.qa.next();n.Na.set(r,new bm(t)),n.Oa=n.Oa.insert(t,r),Gu(n.remoteStore,new Ui(st(Yi(t.path)),r,"TargetPurposeLimboResolution",mt.oe))}}function pn(n,e,t){return k(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,u)=>{o.push(r.Ka(u,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){let m=c?!c.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(c){i.push(c);let m=am.Wi(u.targetId,c);s.push(m)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(u,c){return k(this,null,function*(){let d=L(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>b.forEach(c,p=>b.forEach(p.$i,y=>d.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>b.forEach(p.Ui,y=>d.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!Zn(m))throw m;V("LocalStore","Failed to update sequence numbers: "+m)}for(let m of c){let p=m.targetId;if(!m.fromCache){let y=d.os.get(p),S=y.snapshotVersion,N=y.withLastLimboFreeSnapshotVersion(S);d.os=d.os.insert(p,N)}}})}(r.localStore,s))})}function BR(n,e){return k(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let r=yield iI(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(u=>{u.reject(new D(R.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield pn(t,r.hs)}})}function qR(n,e){let t=L(n),r=t.Na.get(e);if(r&&r.va)return X().add(r.key);{let i=X(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function jR(n,e){return k(this,null,function*(){let t=L(n),r=yield yu(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&Pm(t,e.targetId,i.wa),i})}function GR(n,e){return k(this,null,function*(){let t=L(n);return lI(t.localStore,e).then(r=>pn(t,r))})}function WR(n,e,t,r){return k(this,null,function*(){let i=L(n),s=yield function(a,u){let c=L(a),d=L(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",m=>d.Mn(m,u).next(p=>p?c.localDocuments.getDocuments(m,p):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Xi(i.remoteStore):t==="acknowledged"||t==="rejected"?(yp(i,e,r||null),_p(i,e),function(a,u){L(L(a).mutationQueue).On(u)}(i.localStore,e)):B(),yield pn(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function zR(n,e){return k(this,null,function*(){let t=L(n);if(Wu(t),wp(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield zw(t,r.toArray());t.Qa=!0,yield vm(t.remoteStore,!0);for(let s of i)Gu(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(zi(t,o),ji(t.localStore,o,!0))),Gi(t.remoteStore,o)}),yield i,yield zw(t,r),function(o){let a=L(o);a.Na.forEach((u,c)=>{Gi(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new ye(U.comparator)}(t),t.Qa=!1,yield vm(t.remoteStore,!1)}})}function zw(n,e,t){return k(this,null,function*(){let r=L(n),i=[],s=[];for(let o of e){let a,u=r.Ma.get(o);if(u&&u.length!==0){a=yield qi(r.localStore,st(u[0]));for(let c of u){let d=r.Fa.get(c),m=yield jR(r,d);m.snapshot&&s.push(m.snapshot)}}else{let c=yield aI(r.localStore,o);a=yield qi(r.localStore,c),yield gp(r,wI(c),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i})}function wI(n){return wE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function KR(n){return function(t){return L(L(t).persistence).Qi()}(L(n).localStore)}function $R(n,e,t,r){return k(this,null,function*(){let i=L(n);if(i.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield lI(i.localStore,IE(s[0])),a=qo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ne.EMPTY_BYTE_STRING);yield pn(i,o,a);break}case"rejected":yield ji(i.localStore,e,!0),zi(i,e,r);break;default:B()}})}function QR(n,e,t){return k(this,null,function*(){let r=Wu(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V("SyncEngine","Adding an already active target "+i);continue}let s=yield aI(r.localStore,i),o=yield qi(r.localStore,s);yield gp(r,wI(s),o.targetId,!1,o.resumeToken),Gu(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield ji(r.localStore,i,!1).then(()=>{Gi(r.remoteStore,i),zi(r,i)}).catch(Xn))}})}function Wu(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OR.bind(null,e),e.Ca.d_=RR.bind(null,e.eventManager),e.Ca.$a=PR.bind(null,e.eventManager),e}function wp(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=FR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=MR.bind(null,e),e}function HR(n,e,t){let r=L(n);(function(s,o,a){return k(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(y,S){let N=L(y),x=Pe(S.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",q=>N.Gr.getBundleMetadata(q,S.id)).then(q=>!!q&&q.createTime.compareTo(x)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(gI(u));let c=new Sm(u,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let p=yield c.la(d);p&&a._updateProgress(p),d=yield o.Ua()}let m=yield c.complete();return yield pn(s,m.Ia,void 0),yield function(y,S){let N=L(y);return N.persistence.runTransaction("Save bundle","readwrite",x=>N.Gr.saveBundleMetadata(x,S))}(s.localStore,u),a._completeWith(m.progress),Promise.resolve(m.Pa)}catch(u){return Tt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Yo=class{constructor(){this.synchronizeTabs=!1}initialize(e){return k(this,null,function*(){this.serializer=sa(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return rI(this.persistence,new _u,e.initialUser,this.serializer)}createPersistence(e){return new pu(gu.Zr,this.serializer)}createSharedClientState(e){return new Eu}terminate(){return k(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var xu=class n extends Yo{constructor(e,t,r){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return k(this,null,function*(){yield Rc(n.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield wp(this.Wa.syncEngine),yield Xi(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return rI(this.persistence,new _u,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new zf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new lf(t,this.persistence);return new af(e.asyncQueue,r)}createPersistence(e){let t=up(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new om(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,cI(),Gl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Eu}},Nm=class n extends xu{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return k(this,null,function*(){yield Rc(n.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof xo&&(this.sharedClientState.syncEngine={no:WR.bind(null,t),ro:$R.bind(null,t),io:QR.bind(null,t),Qi:KR.bind(null,t),eo:GR.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>k(this,null,function*(){yield zR(this.Wa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=cI();if(!xo.D(t))throw new D(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=up(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new xo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Jo=class{initialize(e,t){return k(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ww(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=BR.bind(null,this.syncEngine),yield vm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Im}()}createDatastore(e){let t=sa(e.databaseInfo.databaseId),r=function(s){return new fm(s)}(e.databaseInfo);return function(s,o,a,u){return new gm(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new ym(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Ww(this.syncEngine,t,0),function(){return Iu.D()?new Iu:new hm}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,d){let m=new Rm(i,s,o,a,u,c);return d&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return k(this,null,function*(){var e,t;yield function(i){return k(this,null,function*(){let s=L(i);V("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Ji(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function Kw(n,e=10240){let t=0;return{read(){return k(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return k(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Ki=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):be("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var xm=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Oe,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.ja.cancel()}getMetadata(){return k(this,null,function*(){return this.metadata.promise})}Ua(){return k(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return k(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),r=Number(t);isNaN(r)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(r);return new Am(JSON.parse(i),e.length+r)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return k(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return k(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return k(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var km=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return k(this,null,function*(){let o=L(i),a={documents:s.map(m=>Go(o.serializer,m))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),c=new Map;u.forEach(m=>{let p=eR(o.serializer,m);c.set(p.key.toString(),p)});let d=[];return s.forEach(m=>{let p=c.get(m.toString());G(!!p),d.push(p)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Yn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new Lo(i,this.precondition(i)))}),yield function(r,i){return k(this,null,function*(){let s=L(r),o={writes:i.map(a=>Wo(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=W.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(W.min())?Se.exists(!1):Se.updateTime(t):Se.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(W.min()))throw new D(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Se.updateTime(t)}return Se.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Dm=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.nu=r.maxAttempts,this.t_=new Qo(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>k(this,null,function*(){let e=new km(this.datastore),t=this.su(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ou(i)}))}).catch(r=>{this.ou(r)})}))}su(e){try{let t=this.updateFunction(e);return!ta(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!OE(t)}return!1}};var Vm=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ve.UNAUTHENTICATED,this.clientId=Kl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>k(this,null,function*(){V("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(V("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Oe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=es(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Wl(n,e){return k(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>k(this,null,function*(){r.isEqual(i)||(yield iI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Om(n,e){return k(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Ep(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>qw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>qw(e.remoteStore,i)),n._onlineComponents=e})}function EI(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Ep(n){return k(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Wl(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!EI(t))throw t;Tt("Error using user provided cache. Falling back to memory cache: "+t),yield Wl(n,new Yo)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Wl(n,new Yo);return n._offlineComponents})}function zu(n){return k(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Om(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Om(n,new Jo))),n._onlineComponents})}function II(n){return Ep(n).then(e=>e.persistence)}function Ip(n){return Ep(n).then(e=>e.localStore)}function TI(n){return zu(n).then(e=>e.remoteStore)}function Tp(n){return zu(n).then(e=>e.syncEngine)}function YR(n){return zu(n).then(e=>e.datastore)}function $i(n){return k(this,null,function*(){let e=yield zu(n),t=e.eventManager;return t.onListen=NR.bind(null,e.syncEngine),t.onUnlisten=kR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=DR.bind(null,e.syncEngine),t})}function JR(n){return n.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield II(n),t=yield TI(n);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.L_.delete(0),oa(s)}(t)}))}function XR(n){return n.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield II(n),t=yield TI(n);return e.setNetworkEnabled(!1),function(i){return k(this,null,function*(){let s=L(i);s.L_.add(0),yield Ji(s),s.q_.set("Offline")})}(t)}))}function ZR(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s,o){return k(this,null,function*(){try{let a=yield function(c,d){let m=L(c);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=es(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Ip(n),e,t)})),t.promise}function AI(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,a,u,c){let d=new Ki({next:p=>{o.enqueueAndForget(()=>mp(s,m));let y=p.docs.has(a);!y&&p.fromCache?c.reject(new D(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&u&&u.source==="server"?c.reject(new D(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Ho(Yi(a.path),d,{includeMetadataChanges:!0,_a:!0});return fp(s,m)}(yield $i(n),n.asyncQueue,e,t,r)})),r.promise}function eP(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s,o){return k(this,null,function*(){try{let a=yield yu(i,s,!0),u=new Nu(s,a.Ts),c=u.ma(a.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){let u=es(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Ip(n),e,t)})),t.promise}function SI(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,a,u,c){let d=new Ki({next:p=>{o.enqueueAndForget(()=>mp(s,m)),p.fromCache&&u.source==="server"?c.reject(new D(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Ho(a,d,{includeMetadataChanges:!0,_a:!0});return fp(s,m)}(yield $i(n),n.asyncQueue,e,t,r)})),r.promise}function tP(n,e){let t=new Ki(e);return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s){L(i).Y_.add(s),s.next()}(yield $i(n),t)})),()=>{t.za(),n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(i,s){L(i).Y_.delete(s)}(yield $i(n),t)}))}}function nP(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?ME().encode(o):o,function(d,m){return new xm(d,m)}(function(d,m){if(d instanceof Uint8Array)return Kw(d,m);if(d instanceof ArrayBuffer)return Kw(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,sa(e));n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){HR(yield Tp(n),i,r)}))}function rP(n,e){return n.asyncQueue.enqueue(()=>k(this,null,function*(){return function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield Ip(n),e)}))}function CI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var $w=new Map;function Ap(n,e,t){if(!t)throw new D(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Sp(n,e,t,r){if(e===!0&&r===!0)throw new D(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Qw(n){if(!U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Hw(n){if(U.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ku(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ku(n);throw new D(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function bI(n,e){if(e<=0)throw new D(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var ku=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new D(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Sp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=CI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},kr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ku({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new D(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ku(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Yd;switch(r.type){case"firstParty":return new ef(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=$w.get(t);r&&(V("ComponentProvider","Removing Datastore"),$w.delete(t),r.terminate())}(this),Promise.resolve()}};function Cp(n,e,t,r={}){var i;let s=(n=oe(n,kr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Tt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Ve.MOCK_USER;else{a=Va(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new D(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ve(c)}n._authCredentials=new Jd(new zl(a,u))}}var We=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ge=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Qt=class n extends We{constructor(e,t,r){super(e,t,Yi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ge(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function bp(n,e,...t){if(n=ne(n),Ap("collection","path",e),n instanceof kr){let r=se.fromString(e,...t);return Hw(r),new Qt(n,null,r)}{if(!(n instanceof ge||n instanceof Qt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return Hw(r),new Qt(n.firestore,null,r)}}function RI(n,e){if(n=oe(n,kr),Ap("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new We(n,null,function(r){return new Pt(se.emptyPath(),r)}(e))}function aa(n,e,...t){if(n=ne(n),arguments.length===1&&(e=Kl.newId()),Ap("doc","path",e),n instanceof kr){let r=se.fromString(e,...t);return Qw(r),new ge(n,null,new U(r))}{if(!(n instanceof ge||n instanceof Qt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return Qw(r),new ge(n.firestore,n instanceof Qt?n.converter:null,new U(r))}}function Rp(n,e){return n=ne(n),e=ne(e),(n instanceof ge||n instanceof Qt)&&(e instanceof ge||e instanceof Qt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Pp(n,e){return n=ne(n),e=ne(e),n instanceof We&&e instanceof We&&n.firestore===e.firestore&&ra(n._query,e._query)&&n.converter===e.converter}var Fm=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Qo(this,"async_queue_retry"),this.Eu=()=>{let t=Gl();t&&V("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=Gl();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=Gl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new Oe;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return k(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Zn(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(r=>{this.hu=r,this.Pu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=t,t}enqueueAfterDelay(e,t,r){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=wm.createAndSchedule(this,e,t,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&B()}verifyOperationInProgress(){}mu(){return k(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function Mm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Lm=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Oe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var PI=-1,Ee=class extends kr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Fm}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||NI(this),this._firestoreClient.terminate()}};function wx(n,e){let t=typeof n=="object"?n:Lc(),r=typeof n=="string"?n:e||"(default)",i=Mc(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=xc("firestore");s&&Cp(i,...s)}return i}function Ue(n){return n._firestoreClient||NI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function NI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,d){return new uf(a,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,CI(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Vm(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function xI(n,e){BI(n=oe(n,Ee));let t=Ue(n);if(t._uninitializedComponentsProvider)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");Tt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Jo;return DI(t,i,new xu(i,r.cacheSizeBytes,e?.forceOwnership))}function kI(n){BI(n=oe(n,Ee));let e=Ue(n);if(e._uninitializedComponentsProvider)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");Tt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Jo;return DI(e,r,new Nm(r,t.cacheSizeBytes))}function DI(n,e,t){let r=new Oe;return n.asyncQueue.enqueue(()=>k(this,null,function*(){try{yield Wl(n,t),yield Om(n,e),r.resolve()}catch(i){let s=i;if(!EI(s))throw s;Tt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function VI(n){if(n._initialized&&!n._terminated)throw new D(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Oe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{yield function(r){return k(this,null,function*(){if(!Gn.D())return Promise.resolve();let i=r+"main";yield Gn.delete(i)})}(up(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function OI(n){return function(t){let r=new Oe;return t.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return LR(yield Tp(t),r)})),r.promise}(Ue(n=oe(n,Ee)))}function FI(n){return JR(Ue(n=oe(n,Ee)))}function MI(n){return XR(Ue(n=oe(n,Ee)))}function LI(n,e){let t=Ue(n=oe(n,Ee)),r=new Lm;return nP(t,n._databaseId,e,r),r}function UI(n,e){return rP(Ue(n=oe(n,Ee)),e).then(t=>t?new We(n,null,t.query):null)}function BI(n){if(n._initialized||n._terminated)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Xt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ne.fromBase64String(e))}catch(t){throw new D(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var xt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var fn=class{constructor(e){this._methodName=e}};var Dr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var Xo=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var iP=/^__.*__$/,Um=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Hn(e,this.data,t,this.fieldTransforms)}},Du=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function qI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var Vu=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.vu(e),i}Cu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Ou(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(qI(this.wu)&&iP.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},Bm=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sa(e)}Nu(e,t,r,i=!1){return new Vu({wu:e,methodName:t,Ou:r,path:Re.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Mr(n){let e=n._freezeSettings(),t=sa(n._databaseId);return new Bm(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $u(n,e,t,r,i,s={}){let o=n.Nu(s.merge||s.mergeFields?2:0,e,t,i);kp("Data must be an object, but it was:",o,r);let a=WI(r,o),u,c;if(s.merge)u=new pt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let m of s.mergeFields){let p=zm(e,m,t);if(!o.contains(p))throw new D(R.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);KI(d,p)||d.push(p)}u=new pt(d),c=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,c=o.fieldTransforms;return new Um(new Je(a),u,c)}var Zo=class n extends fn{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function jI(n,e,t){return new Vu({wu:3,Ou:e.settings.Ou,methodName:n._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var qm=class n extends fn{_toFieldTransform(e){return new Pr(e.path,new $n)}isEqual(e){return e instanceof n}},jm=class n extends fn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=jI(this,e,!0),r=this.Lu.map(s=>Lr(s,t)),i=new hn(r);return new Pr(e.path,i)}isEqual(e){return e instanceof n&&Vc(this.Lu,e.Lu)}},Gm=class n extends fn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=jI(this,e,!0),r=this.Lu.map(s=>Lr(s,t)),i=new dn(r);return new Pr(e.path,i)}isEqual(e){return e instanceof n&&Vc(this.Lu,e.Lu)}},Wm=class n extends fn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new Qn(e.serializer,RE(e.serializer,this.Bu));return new Pr(e.path,t)}isEqual(e){return e instanceof n&&this.Bu===e.Bu}};function Np(n,e,t,r){let i=n.Nu(1,e,t);kp("Data must be an object, but it was:",i,r);let s=[],o=Je.empty();Fr(r,(u,c)=>{let d=Dp(e,u,t);c=ne(c);let m=i.Cu(d);if(c instanceof Zo)s.push(d);else{let p=Lr(c,m);p!=null&&(s.push(d),o.set(d,p))}});let a=new pt(s);return new Du(o,a,i.fieldTransforms)}function xp(n,e,t,r,i,s){let o=n.Nu(1,e,t),a=[zm(e,r,t)],u=[i];if(s.length%2!=0)throw new D(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)a.push(zm(e,s[p])),u.push(s[p+1]);let c=[],d=Je.empty();for(let p=a.length-1;p>=0;--p)if(!KI(c,a[p])){let y=a[p],S=u[p];S=ne(S);let N=o.Cu(y);if(S instanceof Zo)c.push(y);else{let x=Lr(S,N);x!=null&&(c.push(y),d.set(y,x))}}let m=new pt(c);return new Du(d,m,o.fieldTransforms)}function GI(n,e,t,r=!1){return Lr(t,n.Nu(r?4:3,e))}function Lr(n,e){if(zI(n=ne(n)))return kp("Unsupported field value:",e,n),WI(n,e);if(n instanceof fn)return function(r,i){if(!qI(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Lr(a,i.Fu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return RE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Te.fromDate(r);return{timestampValue:Li(i.serializer,s)}}if(r instanceof Te){let s=new Te(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Li(i.serializer,s)}}if(r instanceof Dr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xt)return{bytesValue:LE(i.serializer,r._byteString)};if(r instanceof ge){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:op(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Xo)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Mu("VectorValues must only contain numeric values.");return sp(a.serializer,u)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${Ku(r)}`)}(n,e)}function WI(n,e){let t={};return cE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fr(n,(r,i)=>{let s=Lr(i,e.bu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function zI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Te||n instanceof Dr||n instanceof Xt||n instanceof ge||n instanceof fn||n instanceof Xo)}function kp(n,e,t){if(!zI(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Ku(t);throw r==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+r)}}function zm(n,e,t){if((e=ne(e))instanceof xt)return e._internalPath;if(typeof e=="string")return Dp(n,e);throw Ou("Field path arguments must be of type string or ",n,!1,void 0,t)}var sP=new RegExp("[~\\*/\\[\\]]");function Dp(n,e,t){if(e.search(sP)>=0)throw Ou(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new xt(...e.split("."))._internalPath}catch{throw Ou(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ou(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new D(R.INVALID_ARGUMENT,a+n+u)}function KI(n,e){return n.some(t=>t.isEqual(e))}var Vr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ge(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Km(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Qu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Km=class extends Vr{data(){return super.data()}};function Qu(n,e){return typeof e=="string"?Dp(n,e):e instanceof xt?e._internalPath:e._delegate._internalPath}function $I(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ea=class{},Or=class extends ea{};function gn(n,e,...t){let r=[];e instanceof ea&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof $m).length,a=s.filter(u=>u instanceof Fu).length;if(o>1||o>0&&a>0)throw new D(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Fu=class n extends Or{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return rT(e._query,t),new We(e.firestore,e.converter,If(e._query,t))}_parse(e){let t=Mr(e.firestore);return function(s,o,a,u,c,d,m){let p;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Jw(m,d);let y=[];for(let S of m)y.push(Yw(u,s,S));p={arrayValue:{values:y}}}else p=Yw(u,s,m)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Jw(m,d),p=GI(a,o,m,d==="in"||d==="not-in");return re.create(c,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function QI(n,e,t){let r=e,i=Qu("where",n);return Fu._create(i,r,t)}var $m=class n extends ea{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ce.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)rT(o,u),o=If(o,u)}(e._query,t),new We(e.firestore,e.converter,If(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Qm=class n extends Or{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new br(s,o)}(e._query,this._field,this._direction);return new We(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Pt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function HI(n,e="asc"){let t=e,r=Qu("orderBy",n);return Qm._create(r,t)}var Mu=class n extends Or{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new We(e.firestore,e.converter,nu(e._query,this._limit,this._limitType))}};function YI(n){return bI("limit",n),Mu._create("limit",n,"F")}function JI(n){return bI("limitToLast",n),Mu._create("limitToLast",n,"L")}var Lu=class n extends Or{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=nT(e,this.type,this._docOrFields,this._inclusive);return new We(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function XI(...n){return Lu._create("startAt",n,!0)}function ZI(...n){return Lu._create("startAfter",n,!1)}var Uu=class n extends Or{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=nT(e,this.type,this._docOrFields,this._inclusive);return new We(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function eT(...n){return Uu._create("endBefore",n,!1)}function tT(...n){return Uu._create("endAt",n,!0)}function nT(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof Vr)return function(s,o,a,u,c){if(!u)throw new D(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let m of Ni(s))if(m.field.isKeyField())d.push(Cr(o,u.key));else{let p=u.data.field(m.field);if(qu(p))throw new D(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){let y=m.field.canonicalString();throw new D(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(p)}return new Yt(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Mr(n.firestore);return function(o,a,u,c,d,m){let p=o.explicitOrderBy;if(d.length>p.length)throw new D(R.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let S=0;S<d.length;S++){let N=d[S];if(p[S].field.isKeyField()){if(typeof N!="string")throw new D(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof N}`);if(!rp(o)&&N.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${N}' contains a slash.`);let x=o.path.child(se.fromString(N));if(!U.isDocumentKey(x))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);let q=new U(x);y.push(Cr(a,q))}else{let x=GI(u,c,N);y.push(x)}}return new Yt(y,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Yw(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rp(e)&&t.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(se.fromString(t));if(!U.isDocumentKey(r))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Cr(n,new U(r))}if(t instanceof ge)return Cr(n,t._key);throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ku(t)}.`)}function Jw(n,e){if(!Array.isArray(n)||n.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function rT(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Qi=class{convertValue(e,t="none"){switch(Sr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Fr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>we(o.doubleValue));return new Xo(s)}convertGeoPoint(e){return new Dr(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=tp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Oo(e));default:return null}}convertTimestamp(e){let t=cn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);G(HE(r));let i=new zn(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Hu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Hm=class extends Qi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ge(this.firestore,null,t)}};var un=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},St=class extends Vr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new qn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Qu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},qn=class extends St{data(e={}){return super.data(e)}},kt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new un(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qn(this._firestore,this._userDataWriter,r.key,r,new un(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new qn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new un(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new qn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new un(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:oP(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function oP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function Vp(n,e){return n instanceof St&&e instanceof St?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof kt&&e instanceof kt&&n._firestore===e._firestore&&Pp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function iT(n){n=oe(n,ge);let e=oe(n.firestore,Ee);return AI(Ue(e),n._key).then(t=>Lp(e,n,t))}var mn=class extends Qi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ge(this.firestore,null,t)}};function sT(n){n=oe(n,ge);let e=oe(n.firestore,Ee),t=Ue(e),r=new mn(e);return ZR(t,n._key).then(i=>new St(e,r,n._key,i,new un(i!==null&&i.hasLocalMutations,!0),n.converter))}function oT(n){n=oe(n,ge);let e=oe(n.firestore,Ee);return AI(Ue(e),n._key,{source:"server"}).then(t=>Lp(e,n,t))}function aT(n){n=oe(n,We);let e=oe(n.firestore,Ee),t=Ue(e),r=new mn(e);return $I(n._query),SI(t,n._query).then(i=>new kt(e,r,n,i))}function lT(n){n=oe(n,We);let e=oe(n.firestore,Ee),t=Ue(e),r=new mn(e);return eP(t,n._query).then(i=>new kt(e,r,n,i))}function uT(n){n=oe(n,We);let e=oe(n.firestore,Ee),t=Ue(e),r=new mn(e);return SI(t,n._query,{source:"server"}).then(i=>new kt(e,r,n,i))}function Op(n,e,t){n=oe(n,ge);let r=oe(n.firestore,Ee),i=Hu(n.converter,e,t);return ts(r,[$u(Mr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Se.none())])}function Fp(n,e,t,...r){n=oe(n,ge);let i=oe(n.firestore,Ee),s=Mr(i),o;return o=typeof(e=ne(e))=="string"||e instanceof xt?xp(s,"updateDoc",n._key,e,t,r):Np(s,"updateDoc",n._key,e),ts(i,[o.toMutation(n._key,Se.exists(!0))])}function cT(n){return ts(oe(n.firestore,Ee),[new Yn(n._key,Se.none())])}function hT(n,e){let t=oe(n.firestore,Ee),r=aa(n),i=Hu(n.converter,e);return ts(t,[$u(Mr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Se.exists(!1))]).then(()=>r)}function Mp(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Mm(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Mm(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,c,d;if(n instanceof ge)c=oe(n.firestore,Ee),d=Yi(n._key.path),u={next:m=>{e[o]&&e[o](Lp(c,n,m))},error:e[o+1],complete:e[o+2]};else{let m=oe(n,We);c=oe(m.firestore,Ee),d=m._query;let p=new mn(c);u={next:y=>{e[o]&&e[o](new kt(c,p,m,y))},error:e[o+1],complete:e[o+2]},$I(n._query)}return function(p,y,S,N){let x=new Ki(N),q=new Ho(y,x,S);return p.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return fp(yield $i(p),q)})),()=>{x.za(),p.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return mp(yield $i(p),q)}))}}(Ue(c),d,a,u)}function dT(n,e){return tP(Ue(n=oe(n,Ee)),Mm(e)?e:{next:e})}function ts(n,e){return function(r,i){let s=new Oe;return r.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return VR(yield Tp(r),i,s)})),s.promise}(Ue(n),e)}function Lp(n,e,t){let r=t.docs.get(e._key),i=new mn(n);return new St(n,i,e._key,r,new un(t.hasPendingWrites,t.fromCache),e.converter)}var aP={maxAttempts:5};var Bu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Mr(e)}set(e,t,r){this._verifyNotCommitted();let i=Un(e,this._firestore),s=Hu(i.converter,t,r),o=$u(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Se.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Un(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof xt?xp(this._dataReader,"WriteBatch.update",s._key,t,r,i):Np(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Se.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Un(e,this._firestore);return this._mutations=this._mutations.concat(new Yn(t._key,Se.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Un(n,e){if((n=ne(n)).firestore!==e)throw new D(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Ym=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Mr(t)}get(t){let r=Un(t,this._firestore),i=new Hm(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return B();let o=s[0];if(o.isFoundDocument())return new Vr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Vr(this._firestore,i,r._key,null,r.converter);throw B()})}set(t,r,i){let s=Un(t,this._firestore),o=Hu(s.converter,r,i),a=$u(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Un(t,this._firestore),a;return a=typeof(r=ne(r))=="string"||r instanceof xt?xp(this._dataReader,"Transaction.update",o._key,r,i,s):Np(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Un(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Un(e,this._firestore),r=new mn(this._firestore);return super.get(e).then(i=>new St(this._firestore,r,t._key,i._document,new un(!1,!1),t.converter))}};function fT(n,e,t){n=oe(n,Ee);let r=Object.assign(Object.assign({},aP),t);return function(s){if(s.maxAttempts<1)throw new D(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Oe;return s.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){let c=yield YR(s);new Dm(s.asyncQueue,c,a,o,u).ru()})),u.promise}(Ue(n),i=>e(new Ym(n,i)),r)}function mT(){return new Zo("deleteField")}function pT(){return new qm("serverTimestamp")}function gT(...n){return new jm("arrayUnion",n)}function _T(...n){return new Gm("arrayRemove",n)}function yT(n){return new Wm("increment",n)}(function(e,t=!0){(function(i){Hi=i})(Ua),La(new Mt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Ee(new Xd(r.getProvider("auth-internal")),new nf(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new D(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zn(c.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Tn(Yv,"4.7.0",e),Tn(Yv,"4.7.0","esm2017")})();var lP="@firebase/firestore-compat",uP="0.3.35";function Wp(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function vT(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function wT(){if(!hE())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Yu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return wT(),new n(Xt.fromBase64String(e))}static fromUint8Array(e){return vT(),new n(Xt.fromUint8Array(e))}toBase64(){return wT(),this._delegate.toBase64()}toUint8Array(){return vT(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Up(n){return cP(n,["next","error","complete"])}function cP(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Bp=class{enableIndexedDbPersistence(e,t){return xI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return kI(e._delegate)}clearIndexedDbPersistence(e){return VI(e._delegate)}},Ju=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof zn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Tt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){Cp(this._delegate,e,t,r)}enableNetwork(){return FI(this._delegate)}disableNetwork(){return MI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Sp("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return OI(this._delegate)}onSnapshotsInSync(e){return dT(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new is(this,bp(this._delegate,e))}catch(t){throw ot(t,"collection()","Firestore.collection()")}}doc(e){try{return new Zt(this,aa(this._delegate,e))}catch(t){throw ot(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new jr(this,RI(this._delegate,e))}catch(t){throw ot(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return fT(this._delegate,t=>e(new Xu(this,t)))}batch(){return Ue(this._delegate),new Zu(new Bu(this._delegate,e=>ts(this._delegate,e)))}loadBundle(e){return LI(this._delegate,e)}namedQuery(e){return UI(this._delegate,e).then(t=>t?new jr(this,t):null)}},ns=class extends Qi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yu(new Xt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Zt.forKey(t,this.firestore,null)}};function hP(n){Xw(n)}var Xu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ns(e)}get(e){let t=Ur(e);return this._delegate.get(t).then(r=>new Br(this._firestore,new St(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Ur(e);return r?(Wp("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ur(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ur(e);return this._delegate.delete(t),this}},Zu=class{constructor(e){this._delegate=e}set(e,t,r){let i=Ur(e);return r?(Wp("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ur(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ur(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},rs=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new qn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ns(e),t),i.set(t,s)),s}};rs.INSTANCES=new WeakMap;var Zt=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ns(e)}static forPath(e,t,r){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ge(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new ge(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new is(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new is(this.firestore,bp(this._delegate,e))}catch(t){throw ot(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof ge?Rp(this._delegate,e):!1}set(e,t){t=Wp("DocumentReference.set",t);try{return t?Op(this._delegate,e,t):Op(this._delegate,e)}catch(r){throw ot(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Fp(this._delegate,e):Fp(this._delegate,e,t,...r)}catch(i){throw ot(i,"updateDoc()","DocumentReference.update()")}}delete(){return cT(this._delegate)}onSnapshot(...e){let t=ET(e),r=IT(e,i=>new Br(this.firestore,new St(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Mp(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=sT(this._delegate):e?.source==="server"?t=oT(this._delegate):t=iT(this._delegate),t.then(r=>new Br(this.firestore,new St(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(rs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ot(n,e,t){return n.message=n.message.replace(e,t),n}function ET(n){for(let e of n)if(typeof e=="object"&&!Up(e))return e;return{}}function IT(n,e){var t,r;let i;return Up(n[0])?i=n[0]:Up(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Br=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Zt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Vp(this._delegate,e._delegate)}},qr=class extends Br{data(e){let t=this._delegate.data(e);return this._delegate._converter||Zw(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},jr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ns(e)}where(e,t,r){try{return new n(this.firestore,gn(this._delegate,QI(e,t,r)))}catch(i){throw ot(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,gn(this._delegate,HI(e,t)))}catch(r){throw ot(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,gn(this._delegate,YI(e)))}catch(t){throw ot(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,gn(this._delegate,JI(e)))}catch(t){throw ot(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,gn(this._delegate,XI(...e)))}catch(t){throw ot(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,gn(this._delegate,ZI(...e)))}catch(t){throw ot(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,gn(this._delegate,eT(...e)))}catch(t){throw ot(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,gn(this._delegate,tT(...e)))}catch(t){throw ot(t,"endAt()","Query.endAt()")}}isEqual(e){return Pp(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=lT(this._delegate):e?.source==="server"?t=uT(this._delegate):t=aT(this._delegate),t.then(r=>new la(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=ET(e),r=IT(e,i=>new la(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Mp(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(rs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},qp=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},la=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new jr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new qp(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new qr(this._firestore,r))})}isEqual(e){return Vp(this._delegate,e._delegate)}},is=class n extends jr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Zt(this.firestore,e):null}doc(e){try{return e===void 0?new Zt(this.firestore,aa(this._delegate)):new Zt(this.firestore,aa(this._delegate,e))}catch(t){throw ot(t,"doc()","CollectionReference.doc()")}}add(e){return hT(this._delegate,e).then(t=>new Zt(this.firestore,t))}isEqual(e){return Rp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(rs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ur(n){return oe(n,ge)}var jp=class n{constructor(...e){this._delegate=new xt(...e)}static documentId(){return new n(Re.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof xt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Gp=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=pT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=mT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=gT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=_T(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=yT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var dP={Firestore:Ju,GeoPoint:Dr,Timestamp:Te,Blob:Yu,Transaction:Xu,WriteBatch:Zu,DocumentReference:Zt,DocumentSnapshot:Br,Query:jr,QueryDocumentSnapshot:qr,QuerySnapshot:la,CollectionReference:is,FieldPath:jp,FieldValue:Gp,setLogLevel:hP,CACHE_SIZE_UNLIMITED:PI};function fP(n,e){n.INTERNAL.registerComponent(new Mt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},dP)))}function mP(n){fP(n,(e,t)=>new Ju(e,t,new Bp)),n.registerVersion(lP,uP)}mP(Lt);function pP(n,e=Ca){return new sr(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function TT(n,e){return pP(n,e)}function gP(n,e){return TT(n,e).pipe(Na(void 0),Pa(),he(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function $p(n,e){return TT(n,e).pipe(he(t=>({payload:t,type:"query"})))}var ec=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=CT(r,t);return new nc(i,s,this.afs)}snapshotChanges(){return gP(this.ref,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return this.snapshotChanges().pipe(he(({payload:t})=>e.idField?As(Dt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return gt(this.ref.get(e)).pipe(Ce)}};function tc(n,e){return $p(n,e).pipe(Na(void 0),Pa(),he(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(m=>m.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(m=>m.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function AT(n,e,t){return tc(n,t).pipe(ar((r,i)=>_P(r,i.map(s=>s.payload),e),[]),Ra(),he(r=>r.map(i=>({type:i.type,payload:i}))))}function _P(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=yP(n,r))}),n}function zp(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function yP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return zp(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return zp(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return zp(n,e.oldIndex,1);break}return n}function ST(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var nc=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=tc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(he(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Na(void 0),Pa(),bs(([r,i])=>i.length>0||!r),he(([,r])=>r),Ce)}auditTrail(e){return this.stateChanges(e).pipe(ar((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=ST(e);return AT(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return $p(this.query,this.afs.schedulers.outsideAngular).pipe(he(t=>t.payload.docs.map(r=>e.idField?As(Dt({},r.data()),{[e.idField]:r.id}):r.data())),Ce)}get(e){return gt(this.query.get(e)).pipe(Ce)}add(e){return this.ref.add(e)}doc(e){return new ec(this.ref.doc(e),this.afs)}},Kp=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?tc(this.query,this.afs.schedulers.outsideAngular).pipe(Ce):tc(this.query,this.afs.schedulers.outsideAngular).pipe(he(t=>t.filter(r=>e.indexOf(r.type)>-1)),bs(t=>t.length>0),Ce)}auditTrail(e){return this.stateChanges(e).pipe(ar((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=ST(e);return AT(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce)}valueChanges(e={}){return $p(this.query,this.afs.schedulers.outsideAngular).pipe(he(r=>r.payload.docs.map(i=>e.idField?Dt({[e.idField]:i.id},i.data()):i.data())),Ce)}get(e){return gt(this.query.get(e)).pipe(Ce)}},vP=new Ge("angularfire2.enableFirestorePersistence"),wP=new Ge("angularfire2.firestore.persistenceSettings"),EP=new Ge("angularfire2.firestore.settings"),IP=new Ge("angularfire2.firestore.use-emulator");function CT(n,e=t=>t){return{query:e(n),ref:n}}var bT=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,d,m,p,y,S,N,x,q,j){this.schedulers=u;let F=Xr(t,a,r),K=d;m&&Ls(F,a,p,S,N,x,y,q),[this.firestore,this.persistenceEnabled$]=Zr(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let H=a.runOutsideAngular(()=>F.firestore());if(s&&H.settings(s),K&&H.useEmulator(...K),i&&!ka(o)){let Y=()=>{try{return gt(H.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),Vt(!1)}};return[H,a.runOutsideAngular(Y)]}else return[H,Vt(!1)]},[s,K,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=CT(i,r),a=this.schedulers.ngZone.run(()=>s);return new nc(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new Kp(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new ec(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(z(Yr),z(Jr,8),z(vP,8),z(EP,8),z($r),z(En),z(Sn),z(wP,8),z(IP,8),z(ei,8),z(ks,8),z(Ds,8),z(Vs,8),z(Os,8),z(Fs,8),z(Ms,8),z(An,8))};static \u0275prov=Ot({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Jx=(()=>{let e=class e{constructor(r,i,s){this.afAuth=r,this.firestore=i,this.crudService=s,this.user=null,this.userSubject=new or(null),this.$user=this.userSubject.asObservable(),this.afAuth.authState.subscribe(o=>{this.user=o,this.resetTimeout()})}loginWithGoogle(){return gt(this.afAuth.signInWithPopup(new Lt.auth.GoogleAuthProvider))}loginWithFacebook(){return gt(this.afAuth.signInWithPopup(new Lt.auth.FacebookAuthProvider))}login(r,i){return gt(this.afAuth.signInWithEmailAndPassword(r,i))}logout(){this.afAuth.signOut().then(r=>{localStorage.removeItem("remind-me"),window.location.reload()})}SendVerificationMail(){return this.afAuth.currentUser.then(r=>r.sendEmailVerification()).then(()=>{})}isLoggedIn(){return this.afAuth.authState.pipe(he(r=>!!r))}getCurrentUser(){return this.afAuth.authState.subscribe(i=>{if(i)try{this.crudService.getItemBy_(i.uid,"uid",Da.USERS).subscribe(s=>{this.userSubject.next(s[0])})}catch(s){console.log(s)}}),this.afAuth.authState}getIdToken(){return this.afAuth.idToken}getUserRole(r){return this.crudService.getItem(Da.USERS,r)}getUserInfo(r){return this.firestore.collection(Da.USERS).doc(r).valueChanges()}updateProfilePicture(r){this.user&&$v(this.user,{photoURL:r}).then(()=>{console.log("Profile picture updated successfully")}).catch(i=>{console.error("Error updating profile picture:",i)})}sendPasswordReset(r){return this.afAuth.sendPasswordResetEmail(r)}resetTimeout(){clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.logout()},15*60*1e3)}};e.\u0275fac=function(i){return new(i||e)(z(ei),z(bT),z(zv))},e.\u0275prov=Ot({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{wx as a,Md as b,nx as c,rx as d,ei as e,zv as f,Jx as g};
